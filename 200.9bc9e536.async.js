"use strict";(self.webpackChunkspeedform_docs=self.webpackChunkspeedform_docs||[]).push([[200],{43200:function(Rt,Oe,d){d.r(Oe),d.d(Oe,{$:function(){return w.$},ComputedObjects:function(){return Ve},ComputedScopeRef:function(){return E},OBJECT_PATH_DELIMITER:function(){return m},SKIP_COMPUTED:function(){return te},WatchObject:function(){return Ue},WatchObjects:function(){return Ge},asyncComputedObject:function(){return ct},computed:function(){return fe},createAsyncComputedMutate:function(){return ie},createComputedMutate:function(){return re},createObject:function(){return w.share},createStore:function(){return Ke},createUseWatch:function(){return Me},createWatch:function(){return de},getSnap:function(){return w.getSnap},getVal:function(){return R},getValueByPath:function(){return T},installComputed:function(){return se},installWatch:function(){return pe},isIncludePath:function(){return Je},isSkipComputed:function(){return Ae},markRaw:function(){return w.markRaw},setAsyncComputedObject:function(){return it},setVal:function(){return k},skipComputed:function(){return G},useStore:function(){return Et},watch:function(){return Ot}});var E=function(t){return t.Root="root",t.Current="current",t.Parent="parent",t.Depends="depends",t.Self="self",t}({});function W(t){return(t||["ROOT"]).map(function(e){return Array.isArray(e)?e.join("."):e}).join("_")}function we(t,e){var n="";return e.id?n=e.id:n=W(t),n}function Fe(t){return t instanceof Error?t:new Error(t)}var m=".",te=Symbol("SKIP_COMPUTED");function Ae(t){return t[te]===!0}var ze=d(79664),j=d.n(ze);function ne(t,e,n){if(!Array.isArray(t))throw new Error("curPath must be an array");return e==="self"?t:e==="root"?[]:e==="parent"?t.slice(0,-2):e==="current"?t.slice(0,-1):typeof e=="string"?e.startsWith("./")?[].concat(j()(t.slice(0,-1)),j()(e.slice(2).split(m))):e.startsWith("../")?ne(t.slice(0,-1),e.slice(3),!0):e.startsWith("/")?(e=e.replace(/^(\/)*/,""),e.split(m)):n?[].concat(j()(t.slice(0,-1)),j()(e.split(m))):j()(e.split(m)):Array.isArray(e)?e:t}function je(t,e){var n=t.get(e);if(n!==void 0)return n;var r=t.get(Number(e)||e);if(r!==void 0)return r}function Se(t){return toString.call(t)==="[object Map]"}function R(t,e){if(e.length===0)return t;var n,r=t;return e.forEach(function(a){n=Se(r)?je(r,a):r[a],r=n}),n}function Be(t,e,n){return t.map(function(r){return R(e,ne(n,r))})}function ke(t){return(t||[]).map(function(e){return Array.isArray(e)?e:typeof e=="string"?["/","./","../"].some(function(n){return e.startsWith(n)})?e:e.includes(m)?e.split(m):e.split("."):[]})}var Le=d(26851),z=d.n(Le);function Tt(t){return _typeof(t)=="object"&&t.hasOwnProperty("__COMPUTED__")&&["async","sync"].includes(t.__COMPUTED__)&&t.hasOwnProperty("fn")&&typeof t.fn=="function"&&t.hasOwnProperty("options")&&_typeof(t.options)=="object"}function Dt(t){return _typeof(t)=="object"&&["result","loading","timeout","retry","run"].every(function(e){return t.hasOwnProperty(e)})}function Je(t,e){return t.length>e.length?!1:t.every(function(n,r){return n===e[r]})}function Ye(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log",n=typeof t=="function"?t():t instanceof Error?t.stack:t;try{var r;(r=console)[e].apply(r,["[@speedform/reactive] "].concat(j()(Array.isArray(n)?n:[n])))}catch(a){}}function k(t,e,n){var r=t,a=e.length-1;e.forEach(function(i,u){var s=Se(r);if(u===a){s?r.set(i,n):r[i]=n;return}var c=s?je(r,i):r[i];r=c})}function G(t){return t[te]=!0,t}function T(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:m,r=[];try{return typeof e=="function"&&(e=e.call(t,t)),r=Array.isArray(e)?e:typeof e=="string"?e.split(n):[],r.length>0?R(t,r):t}catch(a){return t}}function Ze(t,e){function n(r,a){for(var i in r){var u=r[i];typeof e=="function"&&e({value:u,key:i,parent:r,path:a.concat(i)}),z()(u)==="object"&&n(u,a.concat(i))}}n(t,[])}function Qe(t,e,n){var r=e==null?n:e;if(typeof r=="function")try{r=r.call(t,t)}catch(a){}return r==null?n==null?E.Root:n:r}function Ee(t,e,n){var r=n.draft,a=n.dependValues,i=n.valuePath,u=n.computedType,s=r;if(typeof t.options.onComputedDraft=="function"){var c=t.options.onComputedDraft.call(r,r,{computedType:u,valuePath:i});c!==void 0&&(s=c)}var l=i.length>=1?i.slice(0,i.length-1):[],o=Qe(r,e.scope,t.options.scope&&t.options.scope(u));try{if(o===E.Current)return T(r,l);if(o===E.Parent)return T(r,i.slice(0,i.length-2));if(o===E.Root)return s;if(o===E.Depends)return Array.isArray(a)?a.map(function(v){return typeof v=="function"?v():v}):[];if(typeof o=="string")return T(r,ne(i,o));if(Array.isArray(o))if(o.length>0&&o[0].startsWith("@")){var f=T(r,[].concat(j()(o[0].substring(1).split(m)),j()(o.slice(1))));return T(r,f)}else return T(r,o);else if(typeof o=="number"){var p=o>i.length-2?i.length-o-1:0;return T(r,i.slice(0,p))}else return r}catch(v){return r}}var Xe=d(77937),K=d.n(Xe),qe=d(41176),N=d.n(qe),_e=d(79862),$=d.n(_e),Re=function(){function t(e,n,r,a){K()(this,t),$()(this,"options",void 0),this.store=e,this.selfReactiveable=n,this.path=r,this.options=Object.assign({},a)}return N()(t,[{key:"id",get:function(){return this.options.id}},{key:"enable",get:function(){return this.options.enable},set:function(n){this.options.enable=n}},{key:"group",get:function(){return this.options.group}},{key:"async",get:function(){return this.options.async}},{key:"depends",get:function(){return this.options.depends}},{key:"value",get:function(){var n;return R(this.selfReactiveable?(n=this.selfReactiveable)===null||n===void 0?void 0:n.state:this.store.state,this.path)}},{key:"run",value:function(n){var r;return(r=this.store.reactiveable)===null||r===void 0?void 0:r.runComputed(this.id,n)}},{key:"cancel",value:function(){if(this.async)this.value.cancel();else throw new Error("cancel only works for async computed")}}]),t}();function Te(t,e,n,r){var a=n.options.onCreateComputed;if(typeof a=="function"&&typeof e=="function"){var i=a.call(n,t,e,r);r.scope||(r.scope=E.Current),typeof i=="function"&&(e=i)}}function Q(t,e,n){return Object.assign({loading:!1,timeout:0,retry:0,error:null,result:void 0,progress:0,run:t.reactiveable.markRaw(G(function(r){return t.reactiveable.runComputed(e,Object.assign({},r))})),cancel:t.reactiveable.markRaw(G(function(){console.log("cancel")}))},n)}function et(t,e,n){var r=t.valuePath,a=t.id,i=t.desc,u=t.resultPath,s=t.getter,c=e.selfReactiveable;n.reactiveable.createComputed({onComputed:function(o){var f=o.draft,p=o.values,v=o.options;if(!n.options.enableComputed||!e.enable&&(v==null?void 0:v.enable)!==!0){n.options.log("Sync computed <".concat(i,"> is disabled"),"warn");return}n.options.log("Run sync computed for : ".concat(i)),t.dependValues=p;var b=Object.assign({},e,v),h=f,A=Ee(n,b,{draft:f,dependValues:p,valuePath:r,computedType:"Computed"}),S=e.initial;try{S=s.call(h,A),n.emit("computed:done",{path:r,id:a,value:S})}catch(C){n.emit("computed:error",{path:r,id:a,error:C})}c?c.setState(function(C){k(C,u,S)}):k(f,u,S)},options:e})}function re(t,e){var n=t.path,r=t.parent,a=t.value,i=a(),u=i.getter,s=i.options;Te(n,u,e,s);var c=s.selfReactiveable,l=n,o=we(n,s),f="".concat(o,"_").concat(n.join(m));e.options.log("Create sync computed: ".concat(f));var p={id:o,desc:f,resultPath:l,isComputedRunning:!1,dependValues:[],valuePath:n,deps:[],getter:u};et(p,s,e),c||t.replaceValue(R(e.state,n));var v=new Re(e,c,n,s);return s.save&&e.computedObjects.set(o,v),v}var tt=d(90393),O=d.n(tt),nt=d(7392),x=d.n(nt),rt=d(70125),H=d.n(rt),w=d(13834),at=d(53273);function it(t,e,n,r,a){var i=Q(t,r,a),u=R(e,n);Object.assign(u,i,a)}function ut(t,e,n){var r=Object.assign({},n),a=r.max,i=a===void 0?100:a,u=r.min,s=u===void 0?0:u,c=r.value,l=c===void 0?0:c;return t(function(o){return k(o,[].concat(j()(e),["progress"]),l)}),{value:function(f){f>i&&(f=i),f<s&&(f=s),t(function(p){return k(p,[].concat(j()(e),["progress"]),f)})},end:function(){this.value(i)}}}function B(t,e,n){t(function(r){Object.entries(n).forEach(function(a){var i=H()(a,2),u=i[0],s=i[1];k(r,[].concat(j()(e),[u]),s)})})}function st(t,e,n,r){return ae.apply(this,arguments)}function ae(){return ae=x()(O()().mark(function t(e,n,r,a){var i,u,s,c,l,o,f,p,v,b,h,A,S,C,q,y,he,ye,J,Ne,Y,D,V,ge,xe,P;return O()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:i=n.id,u=n.valuePath,s=n.getter,c=n.resultPath,l=n.dependValues,o=r.timeout,f=o===void 0?0:o,p=r.retry,v=p===void 0?[0,0]:p,b=r.selfReactiveable,h=b?b.setState.bind(b):a.setState,A=e,S=Ee(a,r,{draft:e,dependValues:l,valuePath:u,computedType:"Computed"}),C=Array.isArray(v)?v:[Number(v),0],q=H()(C,2),y=q[0],he=q[1],J=new AbortController,Ne={onTimeout:function(I){return ye=I},getProgressbar:function(I){return ut(h,u,I)},getSnap:function(I){return(0,w.getSnap)(I,!1)},abortSignal:J.signal,cancel:J.abort},Y=!1,B(h,c,{cancel:(0,w.markRaw)(G(function(){return J.abort()}))}),J.signal.addEventListener("abort",function(){Y=!0}),D=!1,V=!1,xe=O()().mark(function _(){var I,ee,M,He,me,be,Z,Ce,U;return O()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(D=!1,V=!1,M={},g.prev=3,He=Array.isArray(f)?f:[f,0],me=H()(He,2),be=me[0],Z=be===void 0?0:be,Ce=me[1],U=Ce===void 0?0:Ce,B(h,c,{loading:!0,error:null,retry:P>0?y-P:0,timeout:U>1?U:Z,progress:0}),!Y){g.next=8;break}throw new Error("Abort");case 8:return Z>0&&(I=setTimeout(function(){V=!0,typeof ye=="function"&&ye(),D||(clearInterval(ee),B(h,c,{loading:!1,error:"TIMEOUT",timeout:0}))},Z),U>1&&(ee=setInterval(function(){B(h,c,{timeout:U--}),U===0&&clearInterval(ee)},Z/(U+1)))),g.next=11,s.call(A,S,Ne);case 11:if(ge=g.sent,!Y){g.next=14;break}throw new Error("Abort");case 14:V||Object.assign(M,{result:ge,error:null,timeout:0}),g.next=22;break;case 17:g.prev=17,g.t0=g.catch(3),D=!0,V||Object.assign(M,{error:Fe(g.t0).message,timeout:0}),y>0&&Object.assign(M,{retry:y-P});case 22:return g.prev=22,clearTimeout(I),clearInterval(ee),(!D||P==y)&&Object.assign(M,{loading:!1}),!D&&!V&&Object.assign(M,{error:null}),B(h,c,M),g.finish(22);case 29:if(!D){g.next=33;break}if(!(y>0&&he>0&&P<y)){g.next=33;break}return g.next=33,(0,at.g)(he);case 33:case"end":return g.stop()}},_,null,[[3,17,22,29]])}),P=0;case 15:if(!(P<y+1)){F.next=20;break}return F.delegateYield(xe(),"t0",17);case 17:P++,F.next=15;break;case 20:Y||V?a.emit("computed:cancel",{path:u,id:i,reason:V?"timeout":"abort"}):D?a.emit("computed:error",{path:u,id:i,error:D}):a.emit("computed:done",{path:u,id:i,value:ge});case 21:case"end":return F.stop()}},t)})),ae.apply(this,arguments)}function ot(t,e,n){var r=t.valuePath,a=t.id,i=t.deps,u=t.desc,s=e.selfReactiveable,c=e.initial,l=e.noReentry;n.reactiveable.createAsyncComputed({depends:function(f){return Be(i,f,r)},initial:function(f){s?s.setState(function(p){k(p,r,Q(n,a,{result:c}))}):k(f,r,Q(n,a,{result:c}))},onComputed:function(){var o=x()(O()().mark(function p(v){var b,h,A,S,C;return O()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(b=v.draft,h=v.values,A=v.options,!(!n.options.enableComputed||!e.enable&&(A==null?void 0:A.enable)!==!0)){y.next=4;break}return n.options.log("Async computed <".concat(u,"> is disabled"),"warn"),y.abrupt("return");case 4:if(n.options.log("Run async computed for : ".concat(u)),S=Object.assign({},e,A),!(l&&t.isComputedRunning)){y.next=10;break}return n.options.debug&&n.options.log("Reentry async computed: ".concat(u),"warn"),n.emit("computed:cancel",{path:r,id:a,reason:"reentry"}),y.abrupt("return");case 10:return t.isComputedRunning=!0,t.dependValues=h,y.prev=12,y.next=15,st(b,t,S,n);case 15:return C=y.sent,y.abrupt("return",C);case 17:return y.prev=17,t.isComputedRunning=!1,y.finish(17);case 20:case"end":return y.stop()}},p,null,[[12,,17,20]])}));function f(p){return o.apply(this,arguments)}return f}(),options:e})}function ie(t,e){var n=t.path,r=t.parent,a=t.value,i=a(),u=i.getter,s=i.options;s.async=!0,Te(n,u,e,s);var c=s.depends,l=c===void 0?[]:c,o=s.selfReactiveable,f=n;l.length==0&&e.options.log("async computed <".concat(n.join("."),"> should specify depends"),"warn");var p=we(n,s);s.id=p;var v="".concat(p,"_").concat(n.join(m));e.options.log("Create async computed: ".concat(v," (depends=").concat(l.length==0?"None":W(l),")"));var b={id:p,desc:v,resultPath:f,isComputedRunning:!1,dependValues:[],valuePath:n,deps:l,getter:u};ot(b,s,e),o||t.replaceValue(R(e.state,n));var h=new Re(e,o,n,s);return s.save&&e.computedObjects.set(p,h),h}function ct(t){return Object.assign({loading:!1,timeout:0,retry:0,error:null,result:void 0,progress:0,run:(0,w.markRaw)(G(function(e){})),cancel:(0,w.markRaw)(G(function(){}))},t)}var ue=d(36711);function se(t,e){var n=t.value,r;return n.__COMPUTED__=="async"?r=ie(t,e):n.__COMPUTED__=="sync"?r=re(t,e):(0,ue.$)(n)?(t.value=function(){return{getter:n,options:{depends:[],initial:void 0,immediate:!0,enable:!0}}},r=ie(t,e)):(t.value=function(){return{getter:n,options:{initial:void 0,enable:!0}}},r=re(t,e)),r&&setTimeout(function(){e.emit("computed:created",r)}),r}var lt=d(71698),oe=d.n(lt),ft=d(44114),L=d.n(ft),dt=d(19365),pt=d.n(dt),vt=d(72904),ht=d.n(vt),yt=d(65523),ce=d.n(yt),gt=d(7122),le=d.n(gt),mt=d(19108),De=d.n(mt);function fe(t,e,n){if(typeof t!="function")throw new Error("computed getter must be a function");var r=[],a={async:!1,enable:!0,timeout:0,depends:[],immediate:!0,save:!0};if(arguments.length==1)r=[];else if(arguments.length==2)if(Array.isArray(arguments[1]))r=arguments[1];else if(z()(arguments[1])=="object")Object.assign(a,arguments[1]);else throw new Error("invalid arguments");else arguments.length>=3&&(r=arguments[1],Object.assign(a,arguments[2]));var i=a.async===!0||(0,ue.$)(t)||arguments.length>=2&&Array.isArray(e);a.async=i,a.depends=ke(r);var u=function(){return{getter:t,options:a}};return u.__COMPUTED__=i?"async":"sync",u}function X(){return Math.random().toString(36).slice(2)}var bt=function(){function t(e,n){K()(this,t)}return N()(t,[{key:"state",get:function(){throw new Error("state not implemented.")}},{key:"useState",value:function(n){throw new Error("useState not implemented.")}},{key:"setState",value:function(n){throw new Error("setState not implemented.")}},{key:"createAsyncComputed",value:function(n){throw new Error("createAsyncComputed not implemented.")}},{key:"createComputed",value:function(n){throw new Error("createComputed not implemented.")}},{key:"runComputed",value:function(n,r){throw new Error("runComputed not implemented.")}},{key:"sync",value:function(n){throw new Error("sync not implemented.")}},{key:"markRaw",value:function(n){throw new Error("makeRaw not implemented.")}},{key:"createWatch",value:function(n,r){throw new Error("createWatch not implemented.")}}]),t}(),We=function(t){ce()(n,t);var e=le()(n);function n(r,a){var i,u;return K()(this,n),u=e.call(this,r,a),$()(L()(u),"_stateCtx",void 0),u._stateCtx=(0,w.sharex)(r,{stopArrDep:!1,moduleName:(i=a==null?void 0:a.id)!==null&&i!==void 0?i:X(),onRead:function(c){a!=null&&a.onRead&&a.onRead({path:c.fullKeyPath,value:c.value,parent:c.parent,replaceValue:c.replaceValue})}}),u}return N()(n,[{key:"state",get:function(){return this._stateCtx.reactive}},{key:"useState",value:function(a){var i=this._stateCtx.useState(),u=H()(i,2),s=u[0],c=u[1],l=typeof a=="function"?a(s):s;return[l,c]}},{key:"setState",value:function(a){this._stateCtx.setState(a)}},{key:"sync",value:function(a){return this._stateCtx.sync(a)}},{key:"createAsyncComputed",value:function(a){var i=a.initial,u=a.onComputed,s=a.depends,c=a.options;return this._stateCtx.mutate({deps:function(o){return typeof s=="function"?s(o):null},fn:function(o,f){f.isFirstCall&&typeof i=="function"&&i(o,f)},task:function(){var l=x()(O()().mark(function f(p){var v,b,h,A;return O()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=p.draft,b=p.setState,h=p.input,A=p.extraArgs,typeof i!="function"){C.next=3;break}return C.abrupt("return",u({draft:v,setState:b,values:h,options:Object.assign({},A)}));case 3:case"end":return C.stop()}},f)}));function o(f){return l.apply(this,arguments)}return o}(),immediate:c.immediate,desc:c.id,checkDeadCycle:!1}),c.id}},{key:"createComputed",value:function(a){var i=a.onComputed,u=a.options;return this._stateCtx.mutate({fn:function(c,l){var o=l.input;typeof i=="function"&&i({draft:c,values:o})},task:function(){var s=x()(O()().mark(function l(o){var f,p,v;return O()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:f=o.draft,p=o.input,v=o.extraArgs,typeof i=="function"&&i({draft:f,values:p,options:v});case 2:case"end":return h.stop()}},l)}));function c(l){return s.apply(this,arguments)}return c}(),desc:u.id,checkDeadCycle:!1}),u.id}},{key:"runComputed",value:function(a,i){var u={desc:a,extraArgs:i};return this._stateCtx.runMutateTask(u)}},{key:"markRaw",value:function(a){return(0,w.markRaw)(a)}},{key:"createWatch",value:function(a,i){var u=this,s=(0,w.watch)(function(l){var o=l.triggerReasons,f=o.map(function(p){return p.keyPath});a(f)},function(){return(i==null?void 0:i.length)==0?[u._stateCtx.state]:i==null?void 0:i.map(function(l){return T(u._stateCtx.state,l)})}),c=s.unwatch;return c}}]),n}(bt),Ct=d(59166);function $e(t){function e(n,r,a){var i=Object.assign({id:X(),save:!1},(0,Ct.P)(arguments[1])?arguments[1]:arguments[2]);i.depends=Array.isArray(arguments[1])?arguments[1]:[];var u=i.async===!0||(0,ue.$)(n)||Array.isArray(arguments[1]);i.selfReactiveable=new We({value:u?Q(t,i.id,{}):i.initial});var s;u?s={path:["value"],parent:null,value:fe(n,i.depends,i)}:s={path:["value"],parent:null,value:fe(n,i)};var c=se(s,t);return c}return e}var Ve=function(t){ce()(n,t);var e=le()(n);function n(r){var a;return K()(this,n),a=e.call(this),$()(L()(a),"_createComputed",void 0),a.store=r,a}return N()(n,[{key:"runGroup",value:function(){var r=x()(O()().mark(function i(u,s){return O()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",Promise.all(j()(this.values()).filter(function(o){return o.group==u}).map(function(o){return o.async,o.run(s)})));case 1:case"end":return l.stop()}},i,this)}));function a(i,u){return r.apply(this,arguments)}return a}()},{key:"enableGroup",value:function(){var r=x()(O()().mark(function i(u){var s,c,l;return O()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:s=oe()(this.values());try{for(s.s();!(c=s.n()).done;)l=c.value,l.options.enable=u}catch(p){s.e(p)}finally{s.f()}case 2:case"end":return f.stop()}},i,this)}));function a(i){return r.apply(this,arguments)}return a}()},{key:"delete",value:function(a){return pt()(ht()(n.prototype),"delete",this).call(this,a)}},{key:"create",get:function(){return this._createComputed||(this._createComputed=$e(this.store)),this._createComputed}}]),n}(De()(Map));function Pe(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return typeof t=="function"?t:typeof t=="string"?function(e){return W(e)==W(t.split(m))}:Array.isArray(t)?t.length===0?function(){return!0}:function(e){return t.map(function(n){return typeof n=="string"?n.split(m):Array.isArray(n)?n:[String(n)]}).some(function(n){return W(e)==W(n)})}:function(){return!1}}function Ot(t,e,n){var r=Object.assign({depends:Pe(e),enable:!0},n),a=function(){return{listener:t,options:r}};return a.__COMPUTED__="watch",a}function de(t){return function(e,n){if(n=ke(n),n.length===0)return t.reactiveable.createWatch(e);if(n.some(function(r){return typeof r=="string"&&r.startsWith(".")}))throw new Error("watch depends can not start with '.'");return t.reactiveable.createWatch(e,n)}}var Ie=d(92379);function pe(t,e){e.options.log("install watch for <".concat(t.path.length==0?"Dynamic":t.path.join(m),">"));var n=t.value();n.options.path=t.path;var r=e.watchObjects.add(n),a=n.options.context;return a?a.setState(function(i){i.value=n.options.initial}):(t.replaceValue(n.options.initial),e.setState(function(i){k(i,t.path,n.options.initial)})),r}function Me(t){return function(e,n,r){(0,Ie.useEffect)(function(){var a={path:["value"],parent:void 0,value:function(){var s={listener:e,options:Object.assign({depends:Pe(n),context:(0,w.sharex)({value:0}),selfPath:["value"],initial:0,enable:!0,scope:E.Depends},r)};return s}},i=pe(a,t);return function(){t.watchObjects.delete(i.id)}},[n])}}function ve(t,e){if(t===e)return!0;if(t==null||e==null||z()(t)!==z()(e))return!1;if(z()(t)==="object"){if(Array.isArray(t)&&Array.isArray(e))return t.length!==e.length?!1:t.every(function(r,a){return ve(r,e[a])});if(!Array.isArray(t)&&!Array.isArray(e)){var n=Object.keys(t);return n.length!==Object.keys(e).length?!1:n.every(function(r){return ve(t[r],e[r])})}else return!1}return!1}var Ue=function(){function t(e,n){if(K()(this,t),$()(this,"_cache",void 0),$()(this,"_listener",void 0),$()(this,"_options",void 0),this.store=e,this._options=Object.assign({enable:!0,selfPath:[],group:void 0,context:void 0,initial:void 0},n.options),typeof this._options.depends!="function")throw new Error("watch options.depends must be a function");if(!this._options.id){var r=this._options.path;this._options.id=this._options.id||this._options.context?X():W(r)}this._listener=n.listener}return N()(t,[{key:"id",get:function(){return this._options.id}},{key:"options",get:function(){return this._options}},{key:"path",get:function(){return this._options.path}},{key:"depends",get:function(){return this._options.depends}},{key:"enable",get:function(){return this._options.enable},set:function(n){this._options.enable=n}},{key:"cache",get:function(){return this._cache||(this._cache={}),this._cache}},{key:"value",get:function(){var n=this._options.context?this._options.context:this.store.state;return R((0,w.getSnap)(n),this.path)}},{key:"getName",value:function(){return this._options.context?this.id:this.path.join(m)}},{key:"isDepends",value:function(n,r){return ve(n,this.path)?!1:this.depends(n,r)}},{key:"reset",value:function(){this._cache={}}},{key:"run",value:function(n,r){var a=this;if(!this.enable){this.store.options.log("WatchObject <".concat(this.getName(),"> is disabled"));return}try{var i=this._listener.call(this,n,r,this);i!==void 0&&(this._options.context?this._options.context.setState(function(u){u.value=i}):this.store.setState(function(u){k(u,a.path,i)}))}catch(u){}}}]),t}(),Ge=function(t){ce()(n,t);var e=le()(n);function n(r){var a;return K()(this,n),a=e.call(this),$()(L()(a),"_off",void 0),$()(L()(a),"_enable",!0),a.store=r,r.on("created",a.onStateCreated.bind(L()(a))),a}return N()(n,[{key:"onStateCreated",value:function(){this.createWacher()}},{key:"enable",get:function(){return this._enable},set:function(a){this._enable=a}},{key:"createWacher",value:function(){var a=this,i=this.store.reactiveable.createWatch(function(u){a._enable&&u.forEach(function(s){var c=R(a.store.state,s),l=oe()(a.values()),o;try{for(l.s();!(o=l.n()).done;){var f=o.value;f.isDepends(s,c)&&f.run(s,c)}}catch(p){l.e(p)}finally{l.f()}})},[]);this._off=i}},{key:"reset",value:function(){this._off&&this._off(),this.createWacher()}},{key:"add",value:function(a){var i=new Ue(this.store,a);return this.set(i.id,i),i}},{key:"enableGroup",value:function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=oe()(this.values()),s;try{for(u.s();!(s=u.n()).done;){var c=s.value;c.options.group==a&&(c.options.enable=i)}}catch(l){u.e(l)}finally{u.f()}}}]),n}(De()(Map));function wt(t,e){var n=t.path,r=t.value,a=W(n);typeof r=="function"&&!e._replacedKeys[a]&&!Ae(r)&&(e._replacedKeys[a]=!0,r.__COMPUTED__=="watch"?pe(t,e):se(t,e))}function At(t){return function(e){var n=t.reactiveable.useState.bind(t.reactiveable);if(e==null)return n();var r=n(),a=H()(r,2),i=a[0],u=a[1],s=e(i);return[s,u]}}function jt(t){return function(e){t.reactiveable.setState(function(n){e(n)})}}var St=d(24222);function kt(t){var e=(0,St.Z)();t._emitter=e,t.on=e.on,t.off=e.off,t.emit=e.emit,t.once=function(n,r){var a=function i(u){try{r(u)}finally{e.off(n,i)}};e.on(n,a)}}function Ke(t,e){var n=Object.assign({id:X(),debug:!0,immediate:!1,enableComputed:!0,scope:function(){return E.Current}},e);n.log=function(){n.debug&&Ye.apply(void 0,arguments)};var r={options:n,_replacedKeys:{}};return kt(r),r.computedObjects=new Ve(r),r.watchObjects=new Ge(r),r.reactiveable=new We(t,{id:n.id,onRead:function(i){wt(i,r)}}),r.state=r.reactiveable.state,r.emit("created"),r.useState=At(r),r.setState=jt(r),r.enableComputed=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return r.options.enableComputed=a},r.sync=r.reactiveable.sync.bind(r.reactiveable),r.watch=de(r),r.useWatch=Me(r),r.watch=de(r),r.createComputed=$e(r),n.immediate&&Ze(r.state),r}function Et(t,e){var n=(0,Ie.useState)(function(){return Ke(t,Object.assign({immediate:!0},e))}),r=H()(n,1),a=r[0];return a}}}]);
