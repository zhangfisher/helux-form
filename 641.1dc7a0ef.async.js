(self.webpackChunkspeedform_docs=self.webpackChunkspeedform_docs||[]).push([[641],{59664:function(se,k,p){"use strict";p.r(k),p.d(k,{$:function(){return E.$},ComputedObjects:function(){return Ve},ComputedScopeRef:function(){return A},OBJECT_PATH_DELIMITER:function(){return R},StoreWatcher:function(){return We},computed:function(){return nt},createAction:function(){return ye},createActions:function(){return he},createStore:function(){return ht},createUseWatch:function(){return we},createWatch:function(){return ae},getSnap:function(){return E.getSnap},getVal:function(){return M},getValueByPath:function(){return K},installComputed:function(){return Ee},installWatch:function(){return Me},isIncludePath:function(){return Ge},isSkipComputed:function(){return le},markRaw:function(){return E.markRaw},setVal:function(){return $},skipComputed:function(){return ee},watch:function(){return pt}});var q=p(39114),_=p.n(q),Pe=p(70125),G=p.n(Pe),E=p(14102),ke=p(79664),S=p.n(ke),R="/";function K(e,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:R,r=[];try{return typeof n=="function"&&(n=n.call(e,e)),r=Array.isArray(n)?n:typeof n=="string"?n.split(a):[],r.length>0?M(e,r):e}catch(t){return e}}var ce=Symbol("SKIP_COMPUTED");function ee(e){return e[ce]=!0,e}function le(e){return e[ce]===!0}function $e(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log",a=typeof e=="function"?e():e instanceof Error?e.stack:e;try{var r;(r=console)[n].apply(r,["[@speedform/reactive] "].concat(S()(Array.isArray(a)?a:[a])))}catch(t){}}function fe(e,n){if(!Array.isArray(e))throw new Error("path must be an array");return n==="self"?e:n==="root"?[]:n==="parent"?e.slice(0,-2):n==="current"?e.slice(0,-1):typeof n=="string"?n.startsWith("./")?[].concat(S()(e.slice(0,-1)),S()(n.slice(2).split(R))):n.startsWith("../")?fe(e.slice(0,-1),n.slice(3)):(n.includes(".")&&(console.warn('[@speedform/reactive] The dependency path uses "/" as the separator, and will automatically convert'),n=n.replaceAll(".","/")),[].concat(S()(e.slice(0,-1)),S()(n.split(R)))):Array.isArray(n)?n:e}function pe(e){return e.map(function(n){return Array.isArray(n)?n.join("."):n}).join("_")}function Le(e){return e instanceof Error?e:new Error(e)}function Ue(e,n){return(e||[]).map(function(a){return Array.isArray(a)?a:typeof a=="string"?a.startsWith("./")||a.startsWith("../")?a:a.includes(R)?a.split(R):a.split("."):[]})}function Ne(e,n,a){return e.map(function(r){return M(n,fe(a,r))})}function Ge(e,n){return e.length>n.length?!1:e.every(function(a,r){return a===n[r]})}function de(e){return toString.call(e)==="[object Map]"}function ve(e,n){var a=e.get(n);if(a!==void 0)return a;var r=e.get(Number(n)||n);if(r!==void 0)return r}function M(e,n){if(n.length===0)return e;var a,r=e;return n.forEach(function(t){a=de(r)?ve(r,t):r[t],r=a}),a}function $(e,n,a){var r=e,t=n.length-1;n.forEach(function(u,i){var s=de(r);if(i===t){s?r.set(u,a):r[u]=a;return}var c=s?ve(r,u):r[u];r=c})}function Fe(e){return typeof e=="function"&&e.then&&typeof e.then=="function"||e&&e instanceof Promise}function he(e,n,a,r){return Object.entries(e||{}).reduce(function(t,u){var i=G()(u,2),s=i[0],c=i[1];return t[s]=ye(c,n.setState,a),t},{})}function ye(e,n,a){var r=function(u){typeof u=="function"&&n(function(i){u(i)})};return function(){var t=e.apply(void 0,arguments);if(Fe(t))return t.then(function(u){r(u)});r(t)}}var Be=p(77937),ge=p.n(Be),He=p(41176),me=p.n(He),Je=p(65523),Ce=p.n(Je),ze=p(7122),Oe=p.n(ze),Ye=p(19108),be=p.n(Ye),Qe=p(90393),L=p.n(Qe),Xe=p(7392),ne=p.n(Xe),Ze=p(26851),qe=p.n(Ze),Se=p(96820),_e=p(71660),et=p(45727);function tt(e,n,a){var r=n==null?a:n;if(typeof r=="function")try{r=r.call(e,e)}catch(t){}return r==null?a==null?A.Root:a:r}function Ae(e,n){var a=n.input,r=n.type,t=n.valuePath,u=n.funcOptions,i=n.storeOptions,s=n.computedType,c=e;if(typeof i.onComputedContext=="function"){var l=i.onComputedContext.call(e,e,{computedType:s,contextType:r,valuePath:t});l!==void 0&&(c=l)}var o=t.length>=1?t.slice(0,t.length-1):[],f=tt(e,r=="context"?u.context:u.scope,r=="context"?i.computedThis&&i.computedThis(s):i.computedScope&&i.computedScope(s));try{if(f===A.Current)return K(e,o);if(f===A.Parent)return K(e,t.slice(0,t.length-2));if(f===A.Root)return c;if(f===A.Depends)return Array.isArray(a)?a.map(function(h){return typeof h=="function"?h():h}):[];if(typeof f=="string")return K(e,[].concat(S()(o),S()(f.split(R))));if(Array.isArray(f))if(f.length>0&&f[0].startsWith("@")){var d=K(e,[].concat(S()(f[0].substring(1).split(R)),S()(f.slice(1))));return K(e,d)}else return K(e,f);else if(typeof f=="number"){var O=f>t.length-2?t.length-f-1:0;return K(e,t.slice(0,O))}else return e}catch(h){return e}}function te(e,n){var a=n.input,r=n.type,t=n.computedContext,u=n.computedOptions,i=n.storeOptions;return Ae(e,{input:a,type:r,valuePath:t.fullKeyPath,funcOptions:u,storeOptions:i,computedType:"Computed"})}function nt(e,n,a){if(typeof e!="function")throw new Error("getter must be a function");var r=[],t={async:!1,enable:!0,timeout:0,depends:[],toComputedResult:A.Self,immediate:!0};if(arguments.length==1)r=[];else if(arguments.length==2)if(Array.isArray(arguments[1]))r=arguments[1];else if(qe()(arguments[1])=="object")Object.assign(t,arguments[1]);else throw new Error("invalid arguments");else arguments.length>=3&&(r=arguments[1],Object.assign(t,arguments[2]));var u=t.async===!0||(0,Se.$)(e)||arguments.length>=2&&Array.isArray(n);t.async=u,t.depends=r;var i=function(){return{fn:e,options:t}};return i.__COMPUTED__=u?"async":"sync",i}function yt(e,n,a){var r=n==null?a:n;if(typeof r=="function")try{r=r.call(e,e)}catch(t){}return r==null?a==null?ComputedScopeRef.Root:a:r}function je(e,n){var a="";return typeof n=="function"?a=n(e):typeof n=="string"?a=n:a=pe(e),a}function Te(e,n,a,r){var t=n.fullKeyPath,u=n.parent,i=n.value,s=r.onCreateComputed,c=i(),l=c.fn,o=c.options;if(!(u&&!Object.hasOwn(u,t[t.length-1]))){if(typeof s=="function"&&typeof l=="function"){var f=s.call(e,t,l,o);o.scope||(o.scope=A.Current),o.context||(o.context=A.Root),typeof f=="function"&&(l=f)}var d=t.join(R);r.log("Create sync computed: ".concat(d));var O=je(t,o.id),h=e.mutate({fn:function(C,w){if(!o.enable){r.log("Async computed <".concat(d,"> is disabled"),"warn");return}r.log("Run sync computed for : ".concat(d));var V=w.input,m=te(C,{input:V,computedOptions:o,computedContext:n,storeOptions:r,type:"context"}),D=te(C,{input:V,computedOptions:o,computedContext:n,storeOptions:r,type:"scope"}),b=o.initial;try{b=l.call(m,D)}catch(I){if(typeof o.onError=="function")try{var T;(T=o.onError)===null||T===void 0||T.call(m,I)}catch(U){}}$(C,t,b)},desc:O,checkDeadCycle:!1});n.replaceValue(M(h.snap,t)),a.set(d,{mutate:h,group:o.group,async:!1,run:function(C){return h.run(C)}})}}function xe(e,n,a){return Object.assign({value:void 0,loading:!1,timeout:0,retry:0,error:null,progress:0,run:(0,E.markRaw)(ee(function(r){return e.runMutateTask({desc:n,extraArgs:r})})),cancel:(0,E.markRaw)(ee(function(){console.log("cancel")}))},a)}function rt(e,n,a,r,t){var u=xe(e,r,t),i=M(n,a);Object.assign(i,u,t)}function at(e,n,a){var r=Object.assign({},a),t=r.max,u=t===void 0?100:t,i=r.min,s=i===void 0?0:i,c=r.value,l=c===void 0?0:c;return e(function(o){return $(o,[].concat(S()(n),["progress"]),l)}),{value:function(f){f>u&&(f=u),f<s&&(f=s),e(function(d){return $(d,[].concat(S()(n),["progress"]),f)})},end:function(){this.value(u)}}}function Q(e,n,a){e(function(r){Object.entries(a).forEach(function(t){var u=G()(t,2),i=u[0],s=u[1];$(r,[].concat(S()(n),[i]),s)})})}function ut(e,n,a){return re.apply(this,arguments)}function re(){return re=ne()(L()().mark(function e(n,a,r){var t,u,i,s,c,l,o,f,d,O,h,j,C,w,V,m,D,b,T,I,U,H,y;return L()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:t=r.input,u=r.computedOptions,i=r.computedContext,s=r.storeOptions,c=r.computedResultPath,l=r.setState,o=te(n,{input:t,computedOptions:u,computedContext:i,storeOptions:s,type:"context"}),f=te(n,{input:t,computedOptions:u,computedContext:i,storeOptions:s,type:"scope"}),d=i.fullKeyPath,O=u.timeout,h=O===void 0?0:O,j=u.retry,C=j===void 0?[0,0]:j,w=Array.isArray(C)?C:[Number(C),0],V=G()(w,2),m=V[0],D=V[1],T=new AbortController,I={onTimeout:function(W){return b=W},getProgressbar:function(W){return at(l,d,W)},getSnap:function(W){return(0,E.getSnap)(W,!1)},abortSignal:T.signal,cancel:T.abort},U=!1,Q(l,c,{cancel:(0,E.markRaw)(ee(function(){return T.abort()}))}),T.signal.addEventListener("abort",function(){U=!0}),H=L()().mark(function J(){var W,z,P,N,De,v,Ie,ue,ie,Z,oe,Y,Ke;return L()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(P=!1,N=!1,De=y>0,v={},g.prev=2,Ie=Array.isArray(h)?h:[h,0],ue=G()(Ie,2),ie=ue[0],Z=ie===void 0?0:ie,oe=ue[1],Y=oe===void 0?0:oe,Q(l,c,{loading:!0,error:null,retry:y>0?m-y:0,timeout:Y>1?Y:Z,progress:0}),!U){g.next=7;break}throw new Error("Aborted");case 7:return Z>0&&(W=setTimeout(function(){N=!0,typeof b=="function"&&b(),P||(clearInterval(z),Q(l,c,{loading:!1,error:"TIMEOUT",timeout:0}))},Z),Y>1&&(z=setInterval(function(){Q(l,c,{timeout:Y--}),Y===0&&clearInterval(z)},Z/Y))),g.next=10,a.call(o,f,I);case 10:Ke=g.sent,N||Object.assign(v,{result:Ke,error:null,timeout:0}),g.next=20;break;case 14:if(g.prev=14,g.t0=g.catch(2),P=!0,typeof u.onError=="function")try{u.onError.call(o,g.t0)}catch(mt){}N||Object.assign(v,{error:Le(g.t0).message,timeout:0}),m>0&&Object.assign(v,{retry:m-y});case 20:return g.prev=20,clearTimeout(W),clearInterval(z),(!P||y==m)&&Object.assign(v,{loading:!1}),!P&&!N&&Object.assign(v,{error:null}),Q(l,c,v),g.finish(20);case 27:if(!P){g.next=31;break}if(!(m>0&&D>0&&y<m)){g.next=31;break}return g.next=31,(0,et.g)(D);case 31:case"end":return g.stop()}},J,null,[[2,14,20,27]])}),y=0;case 13:if(!(y<m+1)){x.next=18;break}return x.delegateYield(H(),"t0",15);case 15:y++,x.next=13;break;case 18:case"end":return x.stop()}},e)})),re.apply(this,arguments)}function Re(e,n,a,r){var t=n.fullKeyPath,u=n.parent,i=n.value,s=r.onCreateComputed;if(!(u&&!Object.hasOwn(u,t[t.length-1]))){var c=i(),l=c.fn,o=c.options;if(o.async=!0,typeof s=="function"&&typeof l=="function"){var f=s.call(e,t,l,o);o.scope||(o.scope=A.Current),o.context||(o.context=A.Root),typeof f=="function"&&(l=f)}var d=o.depends,O=o.initial,h=o.toComputedResult,j=h===void 0?"self":h,C=o.immediate,w=o.noReentry,V=w===void 0?!1:w,m=!1,D=(0,_e.d)(j,{self:t,root:[],parent:t.slice(0,t.length-2),current:t.slice(0,t.length-1),Array:j,String:[].concat(S()(t.slice(0,t.length-1)),[String(j).split(R)])},{defaultValue:t}),b=Ue(d);b.length==0&&r.log("async computed <".concat(t.join("."),"> should specify depends"),"warn");var T=je(t,o.id),I=t.join(R);r.log("Create async computed: ".concat(I," (depends=").concat(b.length==0?"None":pe(b),")"));var U=e.mutate({deps:function(y){return Ne(b,y,t)},fn:function(y,X){if(X.isFirstCall)if(j=="self")$(y,t,xe(e,T,{result:O}));else{rt(e,y,D,T,{result:O});var x=M(y,t.slice(0,t.length-1));delete x[t[t.length-1]]}},task:function(){var H=ne()(L()().mark(function X(x){var J,W,z,P,N;return L()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(J=x.draft,W=x.setState,z=x.input,P=x.extraArgs,o.enable){v.next=4;break}return r.log("Async computed <".concat(I,"> is disabled"),"warn"),v.abrupt("return");case 4:if(r.log("Run async computed for : ".concat(I)),N=Object.assign({},o,P),!(V&&m&&r.debug)){v.next=9;break}return r.log("Reentry async computed: ".concat(I),"warn"),v.abrupt("return");case 9:return m=!0,v.prev=10,v.next=13,ut(J,l,{input:z,computedResultPath:D,computedOptions:N,computedContext:n,storeOptions:r,setState:W});case 13:return v.abrupt("return",v.sent);case 14:return v.prev=14,m=!1,v.finish(14);case 17:case"end":return v.stop()}},X,null,[[10,,14,17]])}));function y(X){return H.apply(this,arguments)}return y}(),immediate:C,desc:T,checkDeadCycle:!1});n.replaceValue(M(U.snap,t)),a.set(I,{mutate:U,group:o.group,async:!0,run:function(y){return U.runTask(y)}})}}function Ee(e){var n=e.stateCtx,a=e.params,r=e.storeOptions,t=e.extendObjects,u=a.value;u.__COMPUTED__=="async"?Re(n,a,t.computedObjects,r):u.__COMPUTED__=="sync"?Te(n,a,t.computedObjects,r):(0,Se.$)(u)?(a.value=function(){return{fn:u,options:{depends:[],initial:void 0,immediate:!0,enable:!0,context:r.computedThis}}},Re(n,a,t.computedObjects,r)):(a.value=function(){return{fn:u,options:{initial:void 0,enable:!0,context:r.computedThis}}},Te(n,a,t.computedObjects,r))}var Ve=function(e){Ce()(a,e);var n=Oe()(a);function a(){return ge()(this,a),n.apply(this,arguments)}return me()(a,[{key:"runGroup",value:function(){var r=ne()(L()().mark(function u(i){return L()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Promise.all(S()(this.values()).filter(function(l){return l.group==i}).map(function(l){return l.async?l.mutate.runTask():l.mutate.run()})));case 1:case"end":return c.stop()}},u,this)}));function t(u){return r.apply(this,arguments)}return t}()}]),a}(be()(Map)),it=p(20458),ot=p(71698),st=p.n(ot),ct=p(44114),F=p.n(ct),lt=p(79862),B=p.n(lt),ft=p(70079);function pt(e,n,a){var r=Object.assign({on:n,enable:!0,scope:A.Depends},a),t=function(){return{fn:e,options:r}};return t.__COMPUTED__="watch",t}var We=function(e){Ce()(a,e);var n=Oe()(a);function a(r){var t;return ge()(this,a),t=n.call(this),B()(F()(t),"listeners",new Map),B()(F()(t),"_wacher",{off:function(){}}),B()(F()(t),"_ctx",void 0),B()(F()(t),"_storeOptions",void 0),B()(F()(t),"_enable",!0),B()(F()(t),"cache",new Map),B()(F()(t),"listenerCache",void 0),t._storeOptions=r,t}return me()(a,[{key:"bind",value:function(t){this._ctx||(this._ctx=t),this.createWacher()}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"getWatchScope",value:function(){}},{key:"createWacher",value:function(){var t=this,u=(0,E.watch)(function(s){var c=s.triggerReasons,l=c.map(function(o){return o.keyPath});l.forEach(function(o){var f=t.getCachedWatchers(o),d=M(t._ctx.state,o);if(f.length===0){var O=st()(t.values()),h;try{for(O.s();!(h=O.n()).done;){var j=h.value;t.isMatchWatcher(o,d,j)&&f.push(j)}}catch(b){O.e(b)}finally{O.f()}}for(var C=0,w=Object.entries(f);C<w.length;C++){var V=G()(w[C],2),m=V[0],D=V[1];try{D.run(o)}catch(b){console.warn("Error while run watchLisenter("+o+"->"+m+")",b.stack)}}})},function(){return[t._ctx.state]}),i=u.unwatch;this._wacher={off:i}}},{key:"getCachedWatchers",value:function(t){var u=this.getValueKey(t);return this.cache.has(u)?this.cache.get(u):[]}},{key:"addListenerToCache",value:function(t,u,i,s){var c=this.getValueKey(t);this.cache.has(c)||this.cache.set(c,[]);var l=this.cache.get(c);l.push()}},{key:"getValueKey",value:function(t){return JSON.stringify(t)}},{key:"getListenerCache",value:function(t){this.listenerCache||(this.listenerCache=new Map);var u=t.join(".");return this.listenerCache.has(u)||this.listenerCache.set(u,{}),this.listenerCache.get(u)}},{key:"isMatchWatcher",value:function(t,u,i){if(!(this._enable===!1||i.enable===!1)&&typeof i.on=="function")return i.on(t,u)}},{key:"executeListener",value:function(t,u,i,s){var c=this,l={getSelfValue:function(){return M((0,E.getSnap)(c._ctx.state),u)},getCache:function(){return c.getListenerCache(u)},triggerPath:t,selfPath:u,state:this._ctx.state},o=Ae(this._ctx.state,{computedType:"Watch",input:[function(){return M(c._ctx.state,t)}],type:"scope",valuePath:u,funcOptions:{scope:s.scope},storeOptions:this._storeOptions}),f=i.call(this._ctx.state,o,l);f!==void 0&&this._ctx.setState(function(d){$(d,u,f)})}},{key:"add",value:function(t,u){var i=this,s=u.fullKeyPath;this.set(this.getValueKey(s),_()(_()({path:s,listener:t.fn},t.options),{},{run:function(l){return i.executeListener(l,s,t.fn,t.options)}}))}},{key:"remove",value:function(t){this.listeners.delete(this.getValueKey(t))}},{key:"enableGroup",value:function(t){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;Object.entries(this.listeners).forEach(function(i){var s=G()(i,2),c=s[0],l=s[1];l.options.group==t&&(l.options.enable=u)})}}]),a}(be()(Map));function Me(e){var n=e.stateCtx,a=e.params,r=e.storeOptions,t=e.extendObjects,u=t.watchObjects;u==null||u.bind(n),r.log("install watch for <".concat(a.fullKeyPath.join(R),">"));var i=a.value();u.add(i,a),n.setState(function(s){$(s,a.fullKeyPath,i.options.initial)})}function ae(e){return function(n,a){var r=(0,E.watch)(function(u){var i=u.triggerReasons,s=i.map(function(c){return c.keyPath});n(s)},function(){return a==null?void 0:a.map(function(u){return K(e.state,u)})}),t=r.unwatch;return t}}function we(e){return function(n,a){(0,ft.useEffect)(function(){return ae(e)(n,a)},[])}}function dt(e,n,a,r){var t=e.fullKeyPath,u=e.value,i=t.join(".");if(typeof u=="function"&&!a._replacedKey[i]&&!le(u)){a._replacedKey[i]=!0;var s={stateCtx:n,extendObjects:a,storeOptions:r,params:e};u.__COMPUTED__=="watch"?Me(s):Ee(s)}}var A=function(e){return e.Root="root",e.Current="current",e.Parent="parent",e.Depends="depends",e.Self="self",e}({});function vt(e){return function(n,a){var r=e.useState;if(n==null)return r();var t=r(),u=G()(t,2),i=u[0],s=u[1],c=n(i),l=s;return typeof a=="function"&&(l=function(f){s(function(d){a.call(d,d,f)})}),[c,l]}}function ht(e,n){var a=Object.assign({id:Math.random().toString(16).substring(2),debug:!0,computedThis:A.Root,computedScope:A.Current,singleton:!0},n);a.log=function(){a.debug&&$e.apply(void 0,arguments)};var r=a.singleton?e:(0,it.I)(e),t={computedObjects:new Ve,watchObjects:new We(a),_replacedKey:{}};return(0,E.model)(function(u){var i=u.sharex(r.state,{stopArrDep:!1,moduleName:a.id,onRead:function(o){dt(o,i,t,a)}}),s=he(r.actions,i,u,a),c=vt(i);return _()(_()({actions:s},i),{},{state:i.reactive,useState:c,watch:ae(i),useWatch:we(i)},t)})}},2109:function(se){function k(p){var q=new Error("Cannot find module '"+p+"'");throw q.code="MODULE_NOT_FOUND",q}k.keys=function(){return[]},k.resolve=k,k.id=2109,se.exports=k}}]);
