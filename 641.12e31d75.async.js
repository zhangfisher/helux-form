(self.webpackChunkspeedform_docs=self.webpackChunkspeedform_docs||[]).push([[641],{59664:function(ie,k,p){"use strict";p.r(k),p.d(k,{$:function(){return x.$},ComputedObjects:function(){return Te},ComputedScopeRef:function(){return b},OBJECT_PATH_DELIMITER:function(){return A},StoreWatcher:function(){return xe},computed:function(){return tt},createAction:function(){return he},createActions:function(){return ve},createStore:function(){return dt},createUseWatch:function(){return Ee},createWatch:function(){return ne},getSnap:function(){return x.getSnap},getVal:function(){return V},getValueByPath:function(){return D},installComputed:function(){return Ae},installWatch:function(){return Re},isIncludePath:function(){return Le},isSkipComputed:function(){return ce},markRaw:function(){return x.markRaw},setVal:function(){return M},skipComputed:function(){return q},watch:function(){return lt}});var Z=p(39114),oe=p.n(Z),De=p(70125),I=p.n(De),x=p(14102),Me=p(79664),O=p.n(Me),A="/";function D(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:A,r=[];try{return typeof n=="function"&&(n=n.call(e,e)),r=Array.isArray(n)?n:typeof n=="string"?n.split(t):[],r.length>0?V(e,r):e}catch(a){return e}}var se=Symbol("SKIP_COMPUTED");function q(e){return e[se]=!0,e}function ce(e){return e[se]===!0}function We(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log",t=typeof e=="function"?e():e instanceof Error?e.stack:e;try{var r;(r=console)[n].apply(r,["[@speedform/reactive] "].concat(O()(Array.isArray(t)?t:[t])))}catch(a){}}function le(e,n){if(!Array.isArray(e))throw new Error("path must be an array");return n==="self"?e:n==="root"?[]:n==="parent"?e.slice(0,-2):n==="current"?e.slice(0,-1):typeof n=="string"?n.startsWith("./")?[].concat(O()(e.slice(0,-1)),O()(n.slice(2).split(A))):n.startsWith("../")?le(e.slice(0,-1),n.slice(3)):(n.includes(".")&&(console.warn('[@speedform/reactive] The dependency path uses "/" as the separator, and will automatically convert'),n=n.replaceAll(".","/")),[].concat(O()(e.slice(0,-1)),O()(n.split(A)))):Array.isArray(n)?n:e}function fe(e){return e.map(function(n){return Array.isArray(n)?n.join("."):n}).join("_")}function ke(e){return e instanceof Error?e:new Error(e)}function Ie(e,n){return(e||[]).map(function(t){return Array.isArray(t)?t:typeof t=="string"?t.startsWith("./")||t.startsWith("../")?t:t.includes(A)?t.split(A):t.split("."):[]})}function $e(e,n,t){return e.map(function(r){return V(n,le(t,r))})}function Le(e,n){return e.length>n.length?!1:e.every(function(t,r){return t===n[r]})}function pe(e){return toString.call(e)==="[object Map]"}function de(e,n){var t=e.get(n);if(t!==void 0)return t;var r=e.get(Number(n)||n);if(r!==void 0)return r}function V(e,n){if(n.length===0)return e;var t,r=e;return n.forEach(function(a){t=pe(r)?de(r,a):r[a],r=t}),t}function M(e,n,t){var r=e,a=n.length-1;n.forEach(function(u,i){var s=pe(r);if(i===a){s?r.set(u,t):r[u]=t;return}var c=s?de(r,u):r[u];r=c})}function Pe(e){return typeof e=="function"&&e.then&&typeof e.then=="function"||e&&e instanceof Promise}function ve(e,n,t,r){return Object.entries(e||{}).reduce(function(a,u){var i=I()(u,2),s=i[0],c=i[1];return a[s]=he(c,n.setState,t),a},{})}function he(e,n,t){var r=function(u){typeof u=="function"&&n(function(i){u(i)})};return function(){var a=e.apply(void 0,arguments);if(Pe(a))return a.then(function(u){r(u)});r(a)}}var Ue=p(77937),ye=p.n(Ue),Ne=p(41176),ge=p.n(Ne),Fe=p(65523),Ge=p.n(Fe),Be=p(7122),He=p.n(Be),Je=p(19108),Ye=p.n(Je),ze=p(90393),$=p.n(ze),Qe=p(7392),ee=p.n(Qe),Xe=p(26851),Ze=p.n(Xe),me=p(96820),qe=p(71660),_e=p(45727);function et(e,n,t){var r=n==null?t:n;if(typeof r=="function")try{r=r.call(e,e)}catch(a){}return r==null?t==null?b.Root:t:r}function Ce(e,n){var t=n.input,r=n.contextType,a=n.value,u=n.funcOptions,i=n.storeOptions,s=n.computedType,c=e;if(typeof i.onComputedContext=="function"){var l=i.onComputedContext.call(e,e,{computedType:s,contextType:r,valuePath:a.fullKeyPath});l!==void 0&&(c=l)}var o=a.keyPath,d=a.fullKeyPath,f=et(e,r=="context"?u.context:u.scope,r=="context"?s=="Computed"?i.computedThis:i.watchThis:s=="Computed"?i.computedScope:i.watchScope);try{if(f===b.Current)return D(e,o);if(f===b.Parent)return D(e,d.slice(0,d.length-2));if(f===b.Root)return c;if(f===b.Depends)return Array.isArray(t)?t:[];if(typeof f=="string")return D(e,[].concat(O()(o),O()(f.split(A))));if(Array.isArray(f))if(f.length>0&&f[0].startsWith("@")){var h=D(e,[].concat(O()(f[0].substring(1).split(A)),O()(f.slice(1))));return D(e,h)}else return D(e,f);else if(typeof f=="number"){var m=f>d.length-2?d.length-f-1:0;return D(e,d.slice(0,m))}else return e}catch(R){return e}}function _(e,n){var t=n.input,r=n.type,a=n.computedContext,u=n.computedOptions,i=n.storeOptions;return Ce(e,{input:t,contextType:r,value:a,funcOptions:u,storeOptions:i,computedType:"Computed"})}function tt(e,n,t){if(typeof e!="function")throw new Error("getter must be a function");var r=[],a={async:!1,enable:!0,timeout:0,depends:[],toComputedResult:b.Self,immediate:!0};if(arguments.length==1)r=[];else if(arguments.length==2)if(Array.isArray(arguments[1]))r=arguments[1];else if(Ze()(arguments[1])=="object")Object.assign(a,arguments[1]);else throw new Error("invalid arguments");else arguments.length>=3&&(r=arguments[1],Object.assign(a,arguments[2]));var u=a.async===!0||(0,me.$)(e)||arguments.length>=2&&Array.isArray(n);a.async=u,a.depends=r;var i=function(){return{fn:e,options:a}};return i.__COMPUTED__=u?"async":"sync",i}function vt(e,n,t){var r=n==null?t:n;if(typeof r=="function")try{r=r.call(e,e)}catch(a){}return r==null?t==null?ComputedScopeRef.Root:t:r}function Oe(e,n){var t="";return typeof n=="function"?t=n(e):typeof n=="string"?t=n:t=fe(e),t}function be(e,n,t,r){var a=n.fullKeyPath,u=n.parent,i=n.value,s=r.onCreateComputed,c=i(),l=c.fn,o=c.options;if(!(u&&!Object.hasOwn(u,a[a.length-1]))){if(typeof s=="function"&&typeof l=="function"){var d=s.call(e,a,l,o);o.scope||(o.scope=b.Current),o.context||(o.context=b.Root),typeof d=="function"&&(l=d)}var f=a.join(A);r.log("Create sync computed: ".concat(f));var h=Oe(a,o.id),m=e.mutate({fn:function(T,G){if(!o.enable){r.log("Async computed <".concat(f,"> is disabled"),"warn");return}r.log("Run sync computed for : ".concat(f));var L=G.input,C=_(T,{input:L,computedOptions:o,computedContext:n,storeOptions:r,type:"context"}),P=_(T,{input:L,computedOptions:o,computedContext:n,storeOptions:r,type:"scope"}),E=o.initial;try{E=l.call(C,P)}catch(K){if(typeof o.onError=="function")try{var S;(S=o.onError)===null||S===void 0||S.call(C,K)}catch(U){}}M(T,a,E)},desc:h,checkDeadCycle:!1});n.replaceValue(V(m.snap,a)),t.set(f,{mutate:m,group:o.group,async:!1,run:function(T){return m.run(T)}})}}function Se(e,n,t){return Object.assign({value:void 0,loading:!1,timeout:0,retry:0,error:null,progress:0,run:(0,x.markRaw)(q(function(r){return e.runMutateTask({desc:n,extraArgs:r})})),cancel:(0,x.markRaw)(q(function(){console.log("cancel")}))},t)}function nt(e,n,t,r,a){var u=Se(e,r,a),i=V(n,t);Object.assign(i,u,a)}function rt(e,n,t){var r=Object.assign({},t),a=r.max,u=a===void 0?100:a,i=r.min,s=i===void 0?0:i,c=r.value,l=c===void 0?0:c;return e(function(o){return M(o,[].concat(O()(n),["progress"]),l)}),{value:function(d){d>u&&(d=u),d<s&&(d=s),e(function(f){return M(f,[].concat(O()(n),["progress"]),d)})},end:function(){this.value(u)}}}function z(e,n,t){e(function(r){Object.entries(t).forEach(function(a){var u=I()(a,2),i=u[0],s=u[1];M(r,[].concat(O()(n),[i]),s)})})}function at(e,n,t){return te.apply(this,arguments)}function te(){return te=ee()($()().mark(function e(n,t,r){var a,u,i,s,c,l,o,d,f,h,m,R,T,G,L,C,P,E,S,K,U,B,y;return $()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:a=r.input,u=r.computedOptions,i=r.computedContext,s=r.storeOptions,c=r.computedResultPath,l=r.setState,o=_(n,{input:a,computedOptions:u,computedContext:i,storeOptions:s,type:"context"}),d=_(n,{input:a,computedOptions:u,computedContext:i,storeOptions:s,type:"scope"}),f=i.fullKeyPath,h=u.timeout,m=h===void 0?0:h,R=u.retry,T=R===void 0?[0,0]:R,G=Array.isArray(T)?T:[Number(T),0],L=I()(G,2),C=L[0],P=L[1],S=new AbortController,K={onTimeout:function(w){return E=w},getProgressbar:function(w){return rt(l,f,w)},getSnap:function(w){return(0,x.getSnap)(w,!1)},abortSignal:S.signal,cancel:S.abort},U=!1,z(l,c,{cancel:(0,x.markRaw)(q(function(){return S.abort()}))}),S.signal.addEventListener("abort",function(){U=!0}),B=$()().mark(function H(){var w,J,W,N,we,v,Ve,re,ae,X,ue,Y,Ke;return $()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(W=!1,N=!1,we=y>0,v={},g.prev=2,Ve=Array.isArray(m)?m:[m,0],re=I()(Ve,2),ae=re[0],X=ae===void 0?0:ae,ue=re[1],Y=ue===void 0?0:ue,z(l,c,{loading:!0,error:null,retry:y>0?C-y:0,timeout:Y>1?Y:X,progress:0}),!U){g.next=7;break}throw new Error("Aborted");case 7:return X>0&&(w=setTimeout(function(){N=!0,typeof E=="function"&&E(),W||(clearInterval(J),z(l,c,{loading:!1,error:"TIMEOUT",timeout:0}))},X),Y>1&&(J=setInterval(function(){z(l,c,{timeout:Y--}),Y===0&&clearInterval(J)},X/Y))),g.next=10,t.call(o,d,K);case 10:Ke=g.sent,N||Object.assign(v,{result:Ke,error:null,timeout:0}),g.next=20;break;case 14:if(g.prev=14,g.t0=g.catch(2),W=!0,typeof u.onError=="function")try{u.onError.call(o,g.t0)}catch(yt){}N||Object.assign(v,{error:ke(g.t0).message,timeout:0}),C>0&&Object.assign(v,{retry:C-y});case 20:return g.prev=20,clearTimeout(w),clearInterval(J),(!W||y==C)&&Object.assign(v,{loading:!1}),!W&&!N&&Object.assign(v,{error:null}),z(l,c,v),g.finish(20);case 27:if(!W){g.next=31;break}if(!(C>0&&P>0&&y<C)){g.next=31;break}return g.next=31,(0,_e.g)(P);case 31:case"end":return g.stop()}},H,null,[[2,14,20,27]])}),y=0;case 13:if(!(y<C+1)){j.next=18;break}return j.delegateYield(B(),"t0",15);case 15:y++,j.next=13;break;case 18:case"end":return j.stop()}},e)})),te.apply(this,arguments)}function je(e,n,t,r){var a=n.fullKeyPath,u=n.parent,i=n.value,s=r.onCreateComputed;if(!(u&&!Object.hasOwn(u,a[a.length-1]))){var c=i(),l=c.fn,o=c.options;if(o.async=!0,typeof s=="function"&&typeof l=="function"){var d=s.call(e,a,l,o);o.scope||(o.scope=b.Current),o.context||(o.context=b.Root),typeof d=="function"&&(l=d)}var f=o.depends,h=o.initial,m=o.toComputedResult,R=m===void 0?"self":m,T=o.immediate,G=o.noReentry,L=G===void 0?!1:G,C=!1,P=(0,qe.d)(R,{self:a,root:[],parent:a.slice(0,a.length-2),current:a.slice(0,a.length-1),Array:R,String:[].concat(O()(a.slice(0,a.length-1)),[String(R).split(A)])},{defaultValue:a}),E=Ie(f);E.length==0&&r.log("async computed <".concat(a.join("."),"> should specify depends"),"warn");var S=Oe(a,o.id),K=a.join(A);r.log("Create async computed: ".concat(K," (depends=").concat(E.length==0?"None":fe(E),")"));var U=e.mutate({deps:function(y){return $e(E,y,a)},fn:function(y,Q){if(Q.isFirstCall)if(R=="self")M(y,a,Se(e,S,{result:h}));else{nt(e,y,P,S,{result:h});var j=V(y,a.slice(0,a.length-1));delete j[a[a.length-1]]}},task:function(){var B=ee()($()().mark(function Q(j){var H,w,J,W,N;return $()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(H=j.draft,w=j.setState,J=j.input,W=j.extraArgs,o.enable){v.next=4;break}return r.log("Async computed <".concat(K,"> is disabled"),"warn"),v.abrupt("return");case 4:if(r.log("Run async computed for : ".concat(K)),N=Object.assign({},o,W),!(L&&C&&r.debug)){v.next=9;break}return r.log("Reentry async computed: ".concat(K),"warn"),v.abrupt("return");case 9:return C=!0,v.prev=10,v.next=13,at(H,l,{input:J,computedResultPath:P,computedOptions:N,computedContext:n,storeOptions:r,setState:w});case 13:return v.abrupt("return",v.sent);case 14:return v.prev=14,C=!1,v.finish(14);case 17:case"end":return v.stop()}},Q,null,[[10,,14,17]])}));function y(Q){return B.apply(this,arguments)}return y}(),immediate:T,desc:S,checkDeadCycle:!1});n.replaceValue(V(U.snap,a)),t.set(K,{mutate:U,group:o.group,async:!0,run:function(y){return U.runTask(y)}})}}function Ae(e){var n=e.stateCtx,t=e.params,r=e.storeOptions,a=e.extendObjects,u=t.value;u.__COMPUTED__=="async"?je(n,t,a.computedObjects,r):u.__COMPUTED__=="sync"?be(n,t,a.computedObjects,r):(0,me.$)(u)?(t.value=function(){return{fn:u,options:{depends:[],initial:void 0,immediate:!0,enable:!0,context:r.computedThis}}},je(n,t,a.computedObjects,r)):(t.value=function(){return{fn:u,options:{initial:void 0,enable:!0,context:r.computedThis}}},be(n,t,a.computedObjects,r))}var Te=function(e){Ge()(t,e);var n=He()(t);function t(){return ye()(this,t),n.apply(this,arguments)}return ge()(t,[{key:"runGroup",value:function(){var r=ee()($()().mark(function u(i){return $()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Promise.all(O()(this.values()).filter(function(l){return l.group==i}).map(function(l){return l.async?l.mutate.runTask():l.mutate.run()})));case 1:case"end":return c.stop()}},u,this)}));function a(u){return r.apply(this,arguments)}return a}()}]),t}(Ye()(Map)),ut=p(20458),it=p(71698),ot=p.n(it),st=p(79862),F=p.n(st),ct=p(70079);function lt(e,n,t){var r=Object.assign({on:n,enable:!0},t),a=function(){return{fn:e,options:r}};return a.__COMPUTED__="watch",a}var xe=function(){function e(n){ye()(this,e),F()(this,"listeners",new Map),F()(this,"_wacher",{off:function(){}}),F()(this,"_ctx",void 0),F()(this,"_storeOptions",void 0),F()(this,"_enable",!0),F()(this,"cache",new Map),F()(this,"listenerCache",void 0),this._storeOptions=n}return ge()(e,[{key:"bind",value:function(t){this._ctx||(this._ctx=t),this.createWacher()}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"getWatchScope",value:function(){}},{key:"createWacher",value:function(){var t=this,r=(0,x.watch)(function(u){var i=u.triggerReasons,s=i.map(function(c){return c.keyPath});s.forEach(function(c){if(!t.hitListenerFromCache(c)){var l=ot()(t.listeners),o;try{for(l.s();!(o=l.n()).done;){var d=I()(o.value,2),f=d[0],h=d[1];try{t.executeListener(c,JSON.parse(f),h)}catch(m){console.warn("Error while run watchLisenter("+c+"->"+f+")",m.stack)}}}catch(m){l.e(m)}finally{l.f()}}})},function(){return[t._ctx.state]}),a=r.unwatch;this._wacher={off:a}}},{key:"addListenerToCache",value:function(t,r,a,u){var i=this.getValueKey(t);this.cache.has(i)||this.cache.set(i,[]);var s=this.cache.get(i);s.push([r,a,u])}},{key:"getValueKey",value:function(t){return JSON.stringify(t)}},{key:"hitListenerFromCache",value:function(t){var r=this,a=this.getValueKey(t);if(this.cache.has(a)){var u=V(this._ctx.state,t),i=this.cache.get(a);return i.forEach(function(s){var c=I()(s,3),l=c[0],o=c[1],d=c[2],f=o(u,d);f!==void 0&&r._ctx.setState(function(h){M(h,l,f)})}),i.length>0}return!1}},{key:"getListenerCache",value:function(t){this.listenerCache||(this.listenerCache=new Map);var r=t.join(".");return this.listenerCache.has(r)||this.listenerCache.set(r,{}),this.listenerCache.get(r)}},{key:"executeListener",value:function(t,r,a){var u=this,i=a.fn,s=a.options;if(!(this._enable===!1||s.enable===!1)){var c=s.on;if(typeof c=="function"){var l=V(this._ctx.state,t);try{if(c(t,l)==!0){var o={getSelfValue:function(){return V((0,x.getSnap)(u._ctx.state),r)},getCache:function(){return u.getListenerCache(r)},srcPath:t,selfPath:r,state:this._ctx.state};this.addListenerToCache(t,r,i,o);var d=Ce(this._ctx.state,{computedType:"Watch",input:[l],contextType:"context",value:{keyPath:r,fullKeyPath:r},funcOptions:{context:s.scope},storeOptions:this._storeOptions}),f=i(l,o);f!==void 0&&this._ctx.setState(function(h){M(h,r,f)})}}catch(h){this._storeOptions.log("Error while run watchLisenter(".concat(t,"->").concat(r,")")+h.stack,"error")}}}}},{key:"add",value:function(t,r){var a=r.fullKeyPath;this.listeners.set(this.getValueKey(a),{fn:t.fn,options:t.options})}},{key:"remove",value:function(t){this.listeners.delete(this.getValueKey(t))}},{key:"enableGroup",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;Object.entries(this.listeners).forEach(function(a){var u=I()(a,2),i=u[0],s=u[1];s.options.group==t&&(s.options.enable=r)})}}]),e}();function Re(e){var n=e.stateCtx,t=e.params,r=e.storeOptions,a=e.extendObjects,u=a.watchObjects;u==null||u.bind(n),r.log("install watch for <".concat(t.fullKeyPath.join(A),">"));var i=t.value();u.add(i,t),n.setState(function(s){M(s,t.fullKeyPath,i.options.initial)})}function ne(e){return function(n,t){var r=(0,x.watch)(function(u){var i=u.triggerReasons,s=i.map(function(c){return c.keyPath});n(s)},function(){return t==null?void 0:t.map(function(u){return D(e.state,u)})}),a=r.unwatch;return a}}function Ee(e){return function(n,t){(0,ct.useEffect)(function(){return ne(e)(n,t)},[])}}function ft(e,n,t,r){var a=e.fullKeyPath,u=e.value,i=a.join(".");if(typeof u=="function"&&!t._replacedKey[i]&&!ce(u)){t._replacedKey[i]=!0;var s={stateCtx:n,extendObjects:t,storeOptions:r,params:e};u.__COMPUTED__=="watch"?Re(s):Ae(s)}}var b=function(e){return e.Root="root",e.Current="current",e.Parent="parent",e.Depends="depends",e.Self="self",e}({});function pt(e){return function(n,t){var r=e.useState;if(n==null)return r();var a=r(),u=I()(a,2),i=u[0],s=u[1],c=n(i),l=s;return typeof t=="function"&&(l=function(d){s(function(f){t.call(f,f,d)})}),[c,l]}}function dt(e,n){var t=Object.assign({id:Math.random().toString(16).substring(2),debug:!0,computedThis:b.Root,computedScope:b.Current,singleton:!0},n);t.log=function(){t.debug&&We.apply(void 0,arguments)};var r=t.singleton?e:(0,ut.I)(e),a={computedObjects:new Te,watchObjects:new xe(t),_replacedKey:{}};return(0,x.model)(function(u){var i=u.sharex(r.state,{stopArrDep:!1,moduleName:t.id,onRead:function(o){ft(o,i,a,t)}}),s=ve(r.actions,i,u,t),c=pt(i);return oe()(oe()({actions:s},i),{},{state:i.reactive,useState:c,watch:ne(i),useWatch:Ee(i)},a)})}},2109:function(ie){function k(p){var Z=new Error("Cannot find module '"+p+"'");throw Z.code="MODULE_NOT_FOUND",Z}k.keys=function(){return[]},k.resolve=k,k.id=2109,ie.exports=k}}]);
