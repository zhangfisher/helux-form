!(function(){"use strict";var Hd=Object.defineProperty,Gd=Object.defineProperties;var jd=Object.getOwnPropertyDescriptors;var Nt=Object.getOwnPropertySymbols;var gc=Object.prototype.hasOwnProperty,Ec=Object.prototype.propertyIsEnumerable;var mc=(N,V,k)=>V in N?Hd(N,V,{enumerable:!0,configurable:!0,writable:!0,value:k}):N[V]=k,C=(N,V)=>{for(var k in V||(V={}))gc.call(V,k)&&mc(N,k,V[k]);if(Nt)for(var k of Nt(V))Ec.call(V,k)&&mc(N,k,V[k]);return N},H=(N,V)=>Gd(N,jd(V));var vc=(N,V)=>{var k={};for(var F in N)gc.call(N,F)&&V.indexOf(F)<0&&(k[F]=N[F]);if(N!=null&&Nt)for(var F of Nt(N))V.indexOf(F)<0&&Ec.call(N,F)&&(k[F]=N[F]);return k};var Sc=(N,V,k)=>new Promise((F,Z)=>{var Me=j=>{try{be(k.next(j))}catch(q){Z(q)}},rt=j=>{try{be(k.throw(j))}catch(q){Z(q)}},be=j=>j.done?F(j.value):Promise.resolve(j.value).then(Me,rt);be((k=k.apply(N,V)).next())});(self.webpackChunkspeedform_docs=self.webpackChunkspeedform_docs||[]).push([[369],{44369:function(N,V,k){k.r(V),k.d(V,{$:function(){return ud},action:function(){return sd},addMiddleware:function(){return Vd},addPlugin:function(){return Ud},atom:function(){return bl},atomx:function(){return wl},block:function(){return ad},createShared:function(){return Ml},cst:function(){return Bd},defineDeriveFnItem:function(){return xl},defineDeriveTask:function(){return Pl},defineMutateFnItem:function(){return yd},derive:function(){return Cl},deriveDict:function(){return Ol},dynamicBlock:function(){return id},emit:function(){return vd},flush:function(){return Dd},getActionLoading:function(){return Pd},getAtom:function(){return Nd},getDeriveLoading:function(){return xd},getMutateLoading:function(){return Od},getRawState:function(){return kd},getSnap:function(){return Ld},init:function(){return Ad},isAtom:function(){return Kd},isDerivedAtom:function(){return Td},isDerivedResult:function(){return Md},isDiff:function(){return Fd},isSharedState:function(){return Rd},markRaw:function(){return Id},model:function(){return gd},modelFactory:function(){return Ed},mutate:function(){return fd},mutateDict:function(){return ld},on:function(){return Sd},produce:function(){return Cd},reactiveDesc:function(){return _d},runDerive:function(){return kl},runDeriveTask:function(){return Ll},runMutate:function(){return dd},runMutateTask:function(){return pd},shallowCompare:function(){return wd},share:function(){return Il},sharex:function(){return Fl},signal:function(){return cd},storeSrv:function(){return bd},sync:function(){return hd},syncer:function(){return md},useActionLoading:function(){return ql},useAtom:function(){return Ul},useAtomX:function(){return Bl},useDerived:function(){return Gl},useEffect:function(){return Ql},useGlobalForceUpdate:function(){return od},useGlobalId:function(){return Wl},useLayoutEffect:function(){return ed},useLocalForceUpdate:function(){return rd},useMutable:function(){return Jl},useMutateLoading:function(){return Zl},useObject:function(){return nd},useOnEvent:function(){return zl},useReactive:function(){return Yl},useReactiveX:function(){return Hl},useService:function(){return Xl},useStable:function(){return td},useWatch:function(){return jl},useWatchEffect:function(){return $l},watch:function(){return Nl},watchEffect:function(){return Vl}});function F(e,t){e.includes(t)||e.push(t)}function Z(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}function Me(e){return Array.from(new Set(e))}function rt(e,t){let n=!1;for(const r of e)if(t.includes(r)){n=!0;break}return n}function be(e,t){let n="";const r=e.length;for(let o=0;o<r;o++){const s=e[o];if(t.startsWith(s)){n=s;break}}return n}function j(e,t,n){if(!e)return[];const r=e(t,n);return Array.isArray(r)?r:[r]}var q=function(){if(typeof globalThis!="undefined")return globalThis;if(typeof global!="undefined")return global;if(typeof window!="undefined")return window;if(this!==void 0)return this;throw new Error("no globalThis")}(),dr=!1;function O(...e){}var Ac=O;function _c(...e){return e}function we(...e){return[]}function $d(...e){}var Dc=Object.prototype.toString,Kc="[object Map]";function Wd(){return!(typeof window!="undefined"&&window.document)}function Vt(e){return Dc.call(e)===Kc}function pr(e){return e===Number.MAX_SAFE_INTEGER}function le(){return!(!dr&&q.name!=="previewFrame"&&!q.BrowserFS)}function W(e){return e&&typeof e=="object"&&!Array.isArray(e)}function yr(e){return e&&typeof e=="object"}function x(e){return typeof e=="function"}function Xd(e){return dr?Object.prototype.toString.call(e)==="[object AsyncFunction]":!0}function Ut(e){return typeof e=="symbol"}function Bt(e){if(!e)return!1;const t=typeof e;return(t==="object"||t==="function")&&x(e.then)}function zd(e){try{return e.test,!1}catch(t){return!0}}function ke(){return typeof Proxy=="function"}function de(e,t){var f;const{throwErr:n=!1,prefixLabel:r="",suffixLabel:o=", see details in console.",logErr:s=!0,alertErr:c}=t||{};let a=e,i=!1;if(e instanceof Error&&(i=!0,a=e.message),(c!=null?c:le())&&e&&((f=q.alert)==null||f.call(q,`${r}${a}${o}`)),s&&console.error(e),n)throw i?e:new Error(String(e))}function Ie(e,t=0){t===0?(console.error(e),le()&&console.trace(e)):t===1?console.error(e):console.warn(e)}function Le(e){return pr(e)?1:e+1}var Rc=!!Reflect,Tc=Object.prototype.hasOwnProperty;function Mc(e,t){return Rc?Reflect.has(e,t):Tc.call(e,t)}function Ne(e,t,n){let r=e[t];return r||(r=e[t]=n),r}function ot(e,t,n){let r=e.get(t);return r||(e.set(t,n),r=n),r}function hr(e,t){let n="";for(const r in e)if(t.startsWith(r)){n=r;break}return n}function mr(e,t){const n=e.get(t);if(n!==void 0)return n;const r=e.get(Number(t)||t);return r!==void 0?r:void 0}function pe(e,t){let n,r=e;return t.forEach(o=>{n=Vt(r)?mr(r,o):r[o],r=n}),n}function gr(e,t,n){let r=e;const o=t.length-1;t.forEach((s,c)=>{const a=Vt(r);if(c===o)return void(a?r.set(s,n):r[s]=n);r=a?mr(r,s):r[s]})}function bc(){return Ie("changing shared state is invalid"),!0}function Jd(e){return e}function Yt(e,t){return`${t}/${e}`}function Ht(e){return e&&ke()}var wc=Object.defineProperty,Gt={};((e,t)=>{for(var n in t)wc(e,n,{get:t[n],enumerable:!0})})(Gt,{useEffect:()=>Oc,useEffectLogic:()=>$t,useForceUpdate:()=>Er,useLayoutEffect:()=>Cc,useObject:()=>xc,useObjectLogic:()=>Sr,useStable:()=>vr});var Ic=0,st=new Map,jt=0;function Fc(e,t){const n=()=>{const r=t();return()=>{st.delete(e),r&&r()}};if(function(r){jt||(jt=r)}(e),function(r){const o=st.get(r);o?o.count+=1:st.set(r,{count:1})}(e),jt%2!=0)return n();{const r=function(o){return st.get(o)}(e);if(r&&r.count>1)return n()}}function $t(e,t,n){const{useState:r,useLayoutEffect:o,useEffect:s}=e.react,{isLayout:c,deps:a}=n,[i]=r(()=>++Ic);(c?o:s)(()=>Fc(i,t),a)}function Cc(e,t,n){$t(e,t,{isLayout:!0,deps:n})}function Oc(e,t,n){$t(e,t,{deps:n})}function Er(e){const[,t]=e.react.useState({});return()=>t({})}function Pc(e){const{data:t}=e.current;x(t)?e.current.wrap=(...n)=>e.current.data(...n):W(t)?e.current.wrap=function(n,r){if(!ke()){const s={};return Object.keys(n).forEach(c=>{const a=n[c];x(a)?s[c]=(...i)=>r.current.data[c](...i):Object.defineProperty(s,c,{get:()=>r.current.data[c],set(i){r.current.data[c]=i}})}),s}const o={};return new Proxy(n,{get(s,c){const a=s[c];return x(a)?Ne(o,c,(...i)=>r.current.data[c](...i)):a}})}(t,e):e.current.wrap=t}function vr(e,t){const{useRef:n,useMemo:r}=e.react,o=n({data:t,wrap:{},inited:!1});return o.current.data=r(()=>t,[t]),o.current.inited||(Pc(o),o.current.inited=!0),o.current.wrap}function Sr(e,t,n,r){const{useState:o,useRef:s,useEffect:c}=e.react,[a]=o(t),i=Er(e),f=s({state:null,unmount:!1,shouldCopy:!0}),l=vr(e,{setState(u){const d=f.current;if(d.unmount)return;let p;const{state:m}=d;n?(p=n(u,d.state||a),r&&p?(d.state=p,d.shouldCopy=!1):d.shouldCopy=!0):(p=(x(u)?u(m):u)||{},d.shouldCopy=!0),Object.assign(a,p||{}),i()},getLatestState(){const u=f.current;return u.shouldCopy&&(u.state=C({},a),u.shouldCopy=!1),u.state}});return c(()=>{const u=f.current;return u.unmount=!1,()=>{u.unmount=!0}},[f]),[a,l.setState,l]}function xc(e,t){return Sr(e,t)}function kc(e){const t={},n={react:e},r=Gt;return Object.keys(Gt).forEach(o=>{t[o]=r[o].bind(null,n)}),t}const Zd=3,Lc="3.12.1",ct=Symbol("M"),Ar=Symbol("V"),_r=Symbol("IMMUT_BASE"),Wt=Symbol("IS_RAW"),X="Map",J="Set",z="Array",Nc="Object",Vc=[Symbol.iterator,Symbol.toStringTag],Uc={Map:X,Set:J,Array:z},Xt="[object Object]",at="[object Map]",it="[object Set]",zt="[object Array]",Jt="[object Function]",Bc={[at]:X,[it]:J,[zt]:z,[Xt]:Nc},Yc=["push","pop","shift","splice","unshift","reverse","copyWithin","delete","fill"],Hc=["set","clear","delete"],Gc=["add","clear","delete"],jc=["splice","sort","unshift","shift"],$c=["concat","copyWithin","entries","every","fill","filter","find","findIndex","flat","flatMap","forEach","includes","indexOf","join","keys","lastIndexOf","map","pop","push","reduce","reduceRight","reverse","shift","unshift","slice","some","sort","splice","values","valueOf"],Wc=["clear","delete","entries","forEach","get","has","keys","set","values"],Xc=["add","clear","delete","entries","forEach","has","keys","values"],Dr={[X]:Wc,[J]:Xc,[z]:$c},zc={[X]:["clear","set","delete"],[J]:["clear","add","delete"],[z]:["pop","push","shift","unshift","splice","sort","copyWithin"]},Jc={[X]:["forEach","get"],[J]:["forEach"],[z]:["forEach","map"]},Ve={value:0,usablePrefix:1},Kr={autoFreeze:!1,fastModeRange:"array"},Zc=Object.prototype.toString,qc=!!Reflect,Qc=Object.prototype.hasOwnProperty;function Rr(e,t){return qc?Reflect.has(e,t):Qc.call(e,t)}function ea(e,t,n,r){const o=(s,c,a)=>{ne(s)||(r(s,c,a),Array.isArray(s)&&s.forEach((i,f)=>{o(i,s,f)}),ut(s)&&s.forEach((i,f)=>{o(i,s,f)}),Ue(s)&&Object.keys(s).forEach(i=>{o(s[i],s,i)}))};o(e,t,n)}function ye(e){return Zc.call(e)}function Fe(...e){return e}function Ue(e){return ye(e)===Xt}function ut(e){return ye(e)===at}function Zt(e){return ye(e)===it}function he(e){return ye(e)===Jt}function Tr(e){var t=ye(e);return Bc[t]}function ne(e){const t=ye(e);return![Xt,zt,at,it,Jt].includes(t)}function Mr(e){return e.constructor.name==="AsyncFunction"||typeof e.then=="function"}function br(e){return typeof Promise!="undefined"&&e instanceof Promise}function qt(e){var t=typeof e;return t==="number"?!0:t==="string"?/^[0-9]*$/.test(e):!1}function ta(e){return typeof e=="symbol"}function na(e){var t;return e&&(t=e[Wt])!==null&&t!==void 0?t:!1}const ra={[zt]:Array.prototype,[at]:Map.prototype,[it]:Set.prototype,[Jt]:Function.prototype};function oa(e){const t=ye(e),n=ra[t]||Object.prototype,r=Object.create(null);return Object.setPrototypeOf(r,n),Object.setPrototypeOf(e,r),e}const Qt=new Map;function Be(e){e.rootMeta.modified=!0;const t=n=>{n&&!n.modified&&(n.modified=!0,t(n.parentMeta))};t(e)}function en(e,t,n){if(n.apiCtx.debug){const{fast:r}=n;r?e[ct]=t:(oa(e),e.__proto__[ct]=t)}return e}function sa(e,t,n){const r=[t],o=re(e,n);if(o&&o.level>0){const{keyPath:s}=o;return[...s,t]}return r}function ca(e,t,n){const{ver:r,parentMeta:o=null,immutBase:s,compareVer:c,apiCtx:a,hasOnOperate:i}=n,f=Tr(t);let l=[],u=0,d=null;o&&(d=o.copy,u=ia(d,a),l=sa(d,e,a));const p={rootMeta:null,parentMeta:o,parent:d,selfType:f,self:t,copy:null,key:e,keyPath:l,level:u,proxyVal:null,proxyItems:null,modified:!1,scopes:[],isImmutBase:s,isDel:!1,isFast:!1,isArrOrderChanged:!1,newNodeStats:{},newNodeMap:new Map,newNodes:[],ver:r,compareVer:c,revoke:Fe,hasOnOperate:i,execOnOperate:Fe};return u===0?p.rootMeta=p:p.rootMeta=o.rootMeta,p}function wr(e){const t=tn(e);return t?!t.isImmutBase:!1}function aa(){Ve.value>=Number.MAX_SAFE_INTEGER?(Ve.value=1,Ve.usablePrefix+=1):Ve.value+=1;const{value:e,usablePrefix:t}=Ve;return`${t}_${e}`}function ia(e,t){const n=me(e,t);return n?n.level+1:1}function re(e,t){return t.metaMap.get(e)}function me(e,t){let n=t||Fr(e);return(n==null?void 0:n.metaMap.get(e))||null}function Ir(e){return e&&e[Ar]||""}function Fr(e){const t=Ir(e);return Qt.get(t)||null}function tn(e){const t=Fr(e);return t&&t.metaMap.get(e)||null}function Cr(e,t){const n=tn(e),r=tn(t);if(!n&&!r)return!Object.is(e,t);const{self:o,modified:s,compareVer:c,ver:a,level:i}=n||{self:e,modified:!1,compareVer:!1,ver:"0",level:0},{self:f,modified:l,compareVer:u,ver:d,level:p}=r||{self:t,modified:!1,compareVer:!1,ver:"0",level:0};return o!==f||(c||u)&&(i===0||p===0)&&a!==d?!0:s||l}function ua(e,t,n=!0){const r=n?Cr:Object.is;return!((c,a)=>{for(let i in c)if(!(i in a))return!0;for(let i in a)if(r(c[i],a[i]))return!0;return!1})(e,t)}function qd(e){const t=n=>{if(isPrimitive(n))return n;let r=n;if(Array.isArray(n)&&(r=n.slice(),r.forEach((o,s)=>{r[s]=t(o)})),isSet(n)){const o=Array.from(n);o.forEach((s,c)=>{o[c]=t(s)}),r=new Set(o)}return isMap(n)&&(r=new Map(n),r.forEach((o,s)=>{r.set(s,t(o))})),isObject(n)&&(r={},Object.keys(n).forEach(o=>{r[o]=t(n[o])})),r};return t(e)}function fa(e,t){const{parentType:n,fastModeRange:r}=t;if(Array.isArray(e))return{copy:e.slice(),fast:!1};const o=r==="array"&&n===z||r==="all";let s=e;return e&&Ue(e)&&(s=Object.assign({},e)),ut(e)&&(s=new Map(e)),Zt(e)&&(s=new Set(e)),{copy:s,fast:o}}function la(e,t,n){const{apiCtx:r,immutBase:o}=n;if(o)return{copy:e,fast:!1};const{copy:s,fast:c}=fa(e,n);return en(s,t,{apiCtx:r,fast:c}),{copy:s,fast:c}}function da(e,t,n){const{copy:r,isArrOrderChanged:o}=e,{targetNode:s,key:c}=n;if(o){const a=r.findIndex(i=>i===t.copy);a>=0&&(r[a]=s);return}r[c]=s}function pa(e,t){return Ue(e)?Ir(e)===t:!0}function ya(e,t){const{debug:n}=t,r=new Map;t.newNodeMap.forEach(o=>{const{node:s,parent:c,key:a}=o,i=r.get(s);if(i){c[a]=i;return}const f=o;ea(s,c,a,(l,u,d)=>{const p=me(l,t);if(p){const{modified:m,copy:g,self:y}=p,E=m?g:y;u[d]=E}}),f.target=c[a],r.set(s,f.target)}),e.scopes.forEach(o=>{const{modified:s,copy:c,parentMeta:a,key:i,self:f,revoke:l,proxyVal:u,isDel:d,isFast:p}=o;if(!c||(n&&(p?delete c[ct]:delete c.__proto__[ct]),!a))return l();const m=s?c:f,g=a.copy,y=a.selfType;if(y===X)return g.set(i,m),l();if(y===J)return g.delete(u),g.add(m),l();if(y===z)return da(a,o,{targetNode:m,key:i}),l();if(d!==!0)return g[i]=m,l()}),e.scopes.length=0}function ha(e,t){const{self:n,copy:r,modified:o}=e;let s=n;return r&&o&&(s=e.copy),ya(e,t),s}function Or(e){e.rootMeta.scopes.push(e)}function Pr(e,t,n){const{traps:r,parentType:o,fastModeRange:s,immutBase:c,apiCtx:a}=n,i=ca(e,t,n),{copy:f,fast:l}=la(t,i,{immutBase:c,parentType:o,fastModeRange:s,apiCtx:a});if(i.copy=f,i.isFast=l,c){const u=new Proxy(f,r);i.proxyVal=u,i.revoke=Fe}else{const u=Proxy.revocable(f,r);i.proxyVal=u.proxy,i.revoke=u.revoke}return a.metaMap.set(f,i),a.metaMap.set(i.proxyVal,i),i}function ma(e,t){return e===z?!0:(Jc[e]||[]).includes(t)}function ga(e,t){const{key:n,parentMeta:r,parent:o,parentType:s,fastModeRange:c,readOnly:a,apiCtx:i}=t;let f=e;if(a&&r&&!he(e)){const{copy:u,self:d}=r,p=d[n];if(f!==p){const m=i.metaMap.get(f);m&&(i.metaMap.delete(f),i.metaMap.delete(m.proxyVal)),u[n]=p,f=p}}const l=(u,d)=>{const p=d||"";if(ne(u)||!u)return u;if(!r)throw new Error("[[ createMeta ]]: meta should not be null");if(!he(u)){if(r.newNodeStats[p]||u[Wt])return u;let g=re(u,i);return g||(g=Pr(p,u,t),Or(g),r.selfType===X?o.set(p,g.copy):o[p]=g.copy),g.proxyVal}if(!ma(s,p)||r.proxyItems)return u;let m=[];if(s===J){const g=new Set;o.forEach(y=>g.add(l(y))),kr(g,r,{dataType:J,apiCtx:i}),m=en(g,r,{fast:c,apiCtx:i}),r.copy=m}else if(s===X){const g=new Map;o.forEach((y,E)=>g.set(E,l(y,E))),kr(g,r,{dataType:X,apiCtx:i}),m=en(g,r,{fast:c,apiCtx:i}),r.copy=m}else s===z&&p!=="sort"&&(r.copy=r.copy||o.slice(),m=r.proxyVal);return r.proxyItems=m,u};return l(f,n)}function xr(e,t){if(!Ue(e))return e;const n=re(e,t);return n?n.copy:e}function kr(e,t,n){const{dataType:r,apiCtx:o}=n,s=e.delete.bind(e),c=e.clear.bind(e);if(e.delete=function(...i){return Be(t),s(...i)},e.clear=function(...i){return Be(t),c(...i)},r===J){const a=e.add.bind(e);e.add=function(...f){return Be(t),a(...f)}}if(r===X){const a=e.set.bind(e),i=e.get.bind(e);e.set=function(...l){if(Be(t),t.hasOnOperate){const u=l[1];t.rootMeta.execOnOperate("set",l[0],{mayProxyVal:u,value:u,parentMeta:t})}return a(...l)},e.get=function(...l){const u=i(...l);if(t.hasOnOperate){const d=me(u,o),p=d?d.copy||d.self:u;t.rootMeta.execOnOperate("get",l[0],{mayProxyVal:u,value:p,parentMeta:t,isChanged:!1})}return u}}}function Ea(e){const{calledBy:t,parentMeta:n,op:r,parentType:o}=e;(["deleteProperty","set"].includes(t)||t==="get"&&(o===J&&Gc.includes(r)||o===z&&Yc.includes(r)||o===X&&Hc.includes(r)))&&Be(n)}function Lr(e,t){const n=e.keyPath.slice();return n.push(t),n.join("|")}function nn(e,t){const{op:n,key:r,value:o,calledBy:s,parentType:c,parentMeta:a,apiCtx:i}=t,f=xr(o,i);if(!a){e[r]=f;return}const{self:l,copy:u}=a;Ea({calledBy:s,parentMeta:a,op:n,key:r,parentType:c});const d=Dr[c]||[];if(he(o)&&d.includes(n))return n==="slice"?l.slice:(jc.includes(n)&&(a.isArrOrderChanged=!0),u?c===J||c===X?u[n].bind(u):u[n]:l[n].bind(l));if(!u)return f;const p=u[r],m=()=>{const y=me(p,i);y&&(y.isDel=!0)},g=()=>{const y=me(o,i);y&&y.isDel&&(y.isDel=!1,y.key=r,y.keyPath=a.keyPath.concat([r]),y.level=a.level+1,y.parent=a.copy,y.parentMeta=a)};if(s==="deleteProperty"){const y=me(o,i);y?y.isDel=!0:m();const E=u[r];ne(E)||i.newNodeMap.delete(Lr(a,r)),delete u[r];return}ne(f)||(a.newNodeStats[r]=!0,i.newNodeMap.set(Lr(a,r),{parent:u,node:f,key:r,target:null})),u[r]=f,m(),g()}function rn(e){if(ne(e))return e;if(Array.isArray(e)&&e.length>0)return e.forEach(rn),Object.freeze(e);if(Zt(e)){const n=e;n.add=()=>n,n.delete=()=>!1,n.clear=Fe;for(const r of n.values())Object.freeze(r);return Object.freeze(e)}if(ut(e)){const n=e;n.set=()=>n,n.delete=()=>!1,n.clear=Fe;for(const r of n.values())Object.freeze(r);return Object.freeze(e)}return Object.getOwnPropertyNames(e).forEach(n=>{const r=e[n];rn(r)}),Object.freeze(e)}const va=["length","constructor","asymmetricMatch","nodeType","size"],Nr={};va.forEach(e=>Nr[e]=1);const Sa={[z]:1,[J]:1,[X]:1},on=new Map;function Vr(e){var t,n,r,o,s;const c=e||{},a=c.onOperate,i=!!a,f=c.customKeys||[],l=c.fastModeRange||Kr.fastModeRange,u=(t=c[_r])!==null&&t!==void 0?t:!1,d=(n=c.readOnly)!==null&&n!==void 0?n:!1,p=c.disableWarn,m=(r=c.compareVer)!==null&&r!==void 0?r:!1,g=(o=c.debug)!==null&&o!==void 0?o:!1,y=(s=c.autoFreeze)!==null&&s!==void 0?s:Kr.autoFreeze,E=aa(),v={metaMap:new Map,newNodeMap:new Map,debug:g,metaVer:E};Qt.set(E,v);const R=()=>(p||console.warn("can not mutate state at readOnly mode!"),!0),T=(_,b,K)=>{const{mayProxyVal:h,parentMeta:S,value:D,isCustom:A=!1}=K;let M=!1;if(!a)return{isChanged:M,mayProxyVal:h};const L=S||{},{selfType:I="",keyPath:P=[],copy:Q,self:Re,modified:Lt,proxyVal:Te}=L||{};let nt=!1;K.isChanged!==void 0?M=K.isChanged:(Dr[I]||[]).includes(b)?(nt=!0,M=(zc[I]||[]).includes(b)):_!=="get"&&(M=S?(Lt?Q:Re)[b]!==D:!0);let fe=null,lr=!1;return a({immutBase:u,parent:Re,parentType:I,parentProxy:Te,op:_,replaceValue:hc=>{lr=!0,fe=hc},getReplaced:()=>({isReplaced:lr,replacedValue:fe}),isBuiltInFnKey:nt,isChanged:M,isCustom:A,key:b,keyPath:P,fullKeyPath:P.concat(b),value:D,proxyValue:h}),{mayProxyVal:lr?fe:h,isChanged:M}},w=(()=>{let _=!0;const b={get:(K,h)=>{if(Ar===h)return E;const S=K[h];if(Vc.includes(h))return he(S)?S.bind(K):S;if(h==="__proto__"||h==="toJSON"&&!Rr(K,h))return S;let D=S;const A=re(K,v);if(f.includes(h))return T("get",h,{parentMeta:A,mayProxyVal:D,value:S,isChanged:!1,isCustom:!0}).mayProxyVal;const M=A==null?void 0:A.selfType;return Sa[M]&&Nr[h]?A.copy[h]:(D=ga(S,{key:h,compareVer:m,parentMeta:A,parentType:M,ver:E,traps:b,parent:K,fastModeRange:l,immutBase:u,readOnly:d,apiCtx:v,hasOnOperate:i}),M===z&&qt(h)?T("get",h,{parentMeta:A,mayProxyVal:D,value:S}).mayProxyVal:Uc[M]?(D=nn(K,{op:h,key:h,value:S,metaVer:E,calledBy:"get",parentType:M,parentMeta:A,apiCtx:v}),T("get",h,{parentMeta:A,mayProxyVal:D,value:S}).mayProxyVal):T("get",h,{parentMeta:A,mayProxyVal:D,value:S}).mayProxyVal)},set:(K,h,S)=>{let D=S;const A=re(K,v);if(wr(S))if(pa(S,E)){if(D=xr(S,v),D===K[h])return!0}else _=!1;if(d)return T("set",h,{parentMeta:A,isChanged:!1,value:D}),R();if(A&&A.selfType===z){if(A.copy&&A.__callSet&&qt(h))return T("set",h,{parentMeta:A,value:D}),A.copy[h]=D,!0;A.__callSet=!0}let M=!1;return a?M=T("set",h,{parentMeta:A,value:D}).isChanged:M=(A.modified?A.copy:A.self)[h]!==S,M&&nn(K,{parentMeta:A,key:h,value:D,metaVer:E,calledBy:"set",apiCtx:v}),!0},deleteProperty:(K,h)=>{const S=re(K,v),D=K[h];return d?(T("del",h,{parentMeta:S,isChanged:!1,value:D}),R()):(T("del",h,{parentMeta:S,isChanged:!0,value:D}),nn(K,{parentMeta:S,op:"del",key:h,value:"",metaVer:E,calledBy:"deleteProperty",apiCtx:v}),!0)},apply:function(K,h,S){return K.apply(h,S)}};return{createDraft:K=>{if(ne(K))throw new Error("base state can not be primitive");let h=K;const S=re(K,v);if(S){if(u&&S.isImmutBase)return S.proxyVal;h=S.self}const D=Pr("",h,{ver:E,traps:b,immutBase:u,readOnly:d,compareVer:m,apiCtx:v,hasOnOperate:i});return Or(D),D.execOnOperate=T,on.set(D.proxyVal,w.finishDraft),D.proxyVal},finishDraft:K=>{const h=re(K,v);if(!h)throw new Error("rootMeta should not be null!");if(h.level!==0)throw new Error("can not finish sub draft node!");if(h.isImmutBase)return K;let S=ha(h,v);return y&&_&&(S=rn(S)),Qt.delete(E),S}}})();return w}function Qd(e){const t=getDraftMeta(e);return t?t.self:e}function ep(e){const t=getDraftMeta(e);return t?deepCopy(t.copy||t.self):e}function Aa(e){return!e||ne(e)||(e[Wt]=!0),e}const Ur={has:Rr,noop:Fe,isObject:Ue,isMap:ut,isSet:Zt,isFn:he,isPrimitive:ne,isPromiseFn:Mr,isPromiseResult:br,isSymbol:ta,isMardedRaw:na,canBeNum:qt,isDraft:wr,isDiff:Cr,shallowCompare:ua,getDraftMeta:me,getDataType:Tr},Br=Lc;function sn(e,t){return Vr(t).createDraft(e)}function cn(e){const t=on.get(e);if(!t)throw new Error("Not a Limu root draft or draft has been finished!");return on.delete(e),t(e)}function Yr(e){if(!he(e))throw new Error("produce callback is not a function")}function _a(e,t){if(Mr(e)||br(t))throw new Error("produce callback can not be a promise function or result")}function Hr(e,t,n){Yr(t);const r=sn(e,n),o=t(r);return _a(t,o),cn(r)}function Da(e,t,n){if(!t||!he(t)){const r=e,o=t;return Yr(e),s=>Hr(s,r,o)}return Hr(e,t,n)}const Ka=Da,op=null;function sp(e){return deepCopyFn(e)}function ft(e,t){return Vr(Object.assign(Object.assign({},t||{}),{readOnly:!0,[_r]:!0})).createDraft(e)}function cp(e){conf.autoFreeze=e}function ap(){return conf.autoFreeze}const ip=null,Ra=Aa,up=null;var Ta=Object.defineProperty,Ma=(e,t)=>{for(var n in t)Ta(e,n,{get:t[n],enumerable:!0})},Gr={};Ma(Gr,{$:()=>ml,action:()=>Ss,addMiddleware:()=>Ja,addPlugin:()=>ei,atom:()=>Xf,atomx:()=>zf,block:()=>dl,createShared:()=>hl,cst:()=>gl,currentDraftRoot:()=>bi,defineDeriveFnItem:()=>yf,defineDeriveTask:()=>pf,defineMutateFnItem:()=>Ef,derive:()=>Ks,deriveDict:()=>df,dynamicBlock:()=>lc,emit:()=>oi,flush:()=>Un,getActionLoading:()=>wf,getAtom:()=>Qr,getDeriveLoading:()=>Yu,getMutateLoading:()=>Mf,getRawState:()=>li,getSnap:()=>ho,init:()=>za,isAtom:()=>Pe,isDerivedAtom:()=>ge,isDerivedResult:()=>Ya,isDiff:()=>yl,isSharedState:()=>Ba,markRaw:()=>Ra,mutate:()=>ws,mutateDict:()=>tr,on:()=>si,produce:()=>Ka,reactiveDesc:()=>Uo,runDerive:()=>Nu,runDeriveTask:()=>Vu,runMutate:()=>Ms,runMutateTask:()=>bs,shallowCompare:()=>pl,share:()=>tc,sharex:()=>nc,signal:()=>dc,storeSrv:()=>Pf,sync:()=>Jf,syncer:()=>Zf,useActionLoading:()=>If,useAtom:()=>Is,useAtomX:()=>Fs,useDerived:()=>rr,useGlobalForceUpdate:()=>xs,useGlobalId:()=>Tf,useLocalForceUpdate:()=>Vs,useMutable:()=>Us,useMutateLoading:()=>bf,useOnEvent:()=>Ff,useReactive:()=>sr,useReactiveX:()=>Bs,useService:()=>Of,useWatch:()=>kf,useWatchEffect:()=>Lf,watch:()=>nf,watchEffect:()=>rf});var jr="4.1.0",ba=Br,an={ON_DATA_CHANGED:"ON_DATA_CHANGED",ON_SHARE_CREATED:"ON_SHARE_CREATED",ON_ERROR_OCCURED:"ON_ERROR_OCCURED"},un={NO:"no",PRIVATE:"private",GLOBAL:"global"},$r=0,Wr=Symbol,wa=typeof Wr=="function";function oe(e){return wa?Wr(e):($r+=1,`__HELUX_SYMBOL_${$r}__`)}var Ia="__proto__",Fa=ke(),Ca=oe("HeluxUndefined"),Xr=oe("HeluxMutateFnItem"),lt=oe("HeluxFnKey"),dt=oe("HeluxSharedKey"),zr=oe("HeluxReactiveMeta"),fn=oe("HeluxIsBlock"),Ce=oe("HeluxIsAtom"),Ye=oe("HeluxIsDerivedAtom"),pt=[dt,Ce,Ye,fn],yt="SingleMutate",Oa="HeluxGlobalLoading",Pa=6,xa=!0,Jr=2e3,ka=20,He="1",ln="2",ht=1,mt=2,Zr=3,Oe="|",gt={TASK:"task",MAY_TRANSFER:"may_transfer"},se={STATIC:"static",HOOK:"hook"},ee={USER_STATE:"user_state",GLOGAL_EMPTY:"global_empty",GLOGAL_LOADING:"global_loading",PRIVATE_LOADING:"private_loading"},La="derive",qr="watch",Et="Object",Na="Map",Va="Array",Ua="Other",G={SET_STATE:"SetState",MUTATE:"Mutate",ACTION:"Action",REACTIVE:"Reactive",LOADING:"Loading",SYNC:"Sync"};function Pe(e){var t;return e&&(t=e[Ce])!=null?t:!1}function Ba(e){return e?e[Ce]!==void 0:!1}function ge(e){return e&&e[Ye]||!1}function Ya(e){return e?e[Ye]!==void 0:!1}function Qr(e){return Pe(e)||ge(e)?e.val:e}function Ha(){return{keySeed:{static:0,hook:0,Reactive:0,Mutate:0},runningFnKey:"",runningSharedKey:0,isIgnore:!1,depKeys:[],GID_INSKEYS_MAP:new Map,FNKEY_STATIC_CTX_MAP:new Map,FNKEY_HOOK_CTX_MAP:new Map,DEPKEY_FNKEYS_MAP:new Map,UNMOUNT_INFO_MAP:new Map,DEPKEY_COMPUTING_FNKEYS_MAP:new Map}}function Ga(){return{keySeed:0,keyPrefix:0,initCount:0,mountedCount:0,latest:{val:null,stateOrResult:null,sharedKey:0,depKey:"",keyPath:[],isDerivedResult:!1,isDerivedAtom:!1},runningKey:"",isDynamic:!1,KEY_CTX_MAP:new Map,KEY_DYNAMIC_CTX_MAP:new Map}}function ja(){return{keySeed:0,UNMOUNT_INFO_MAP:new Map}}function $a(){return{keySeed:0,SHARED_KEY_STATE_MAP:new Map,STATE_SHARED_KEY_MAP:new Map,INTERMAL_MAP:new Map,COMPARE_MAP:new Map,isStateChanged:!1}}function eo(){const e={};return{on:(t,n)=>{Ne(e,t,[]).push(n)},emit:(t,...n)=>{(e[t]||[]).slice().forEach(o=>o(...n))},off:(t,n)=>{const r=e[t]||[],o=r.findIndex(s=>s===n);o>=0&&r.splice(o,1)},canEmit:t=>e[t]}}function to(){const e={VER:jr,LIMU_VER:Br,rootState:{},setState:(t,n)=>{const r=e.ctx.mod[t];if(!r)throw new Error(`moduleName ${t} not found`);r.setState(n)},ctx:{bus:eo(),userBus:eo(),mod:{},middlewares:[],plugins:[],sharedScope:$a(),fnScope:Ha(),insScope:ja(),blockScope:Ga(),markAtomMap:new Map,renderSN:0,globalLoading:null,globalLoadingInternal:null,globalEmpty:null,globalEmptyInternal:null,isRootRender:!0},legacyRoot:{}};return e}var vt={},no=!1,ro=null,oo=!1;function Y(){return vt.ctx||{}}function Wa(){return vt}function so(e){vt=e.ROOT,ro=e.api,no=e.inited}function Xa(){return{ROOT:vt,inited:no,API:ro}}function za(e){if(oo)return!1;oo=!0;const{isRootRender:t=!0}=e;return Y().isRootRender=t,!0}function Ja(e){const{middlewares:t}=Y();t.push(e)}function Za(e,t,n,r){const{middlewares:o}=Y();if(!o.length)return;const s={},{sharedKey:c,moduleName:a,forAtom:i}=e,l={forAtom:i,draftRoot:t,draft:n,sharedKey:c,moduleName:a,setData:(u,d)=>s[u]=d,data:s,idx:0,sn:r};o.forEach((u,d)=>{u(H(C({},l),{idx:d}))})}var{ON_DATA_CHANGED:dn,ON_SHARE_CREATED:co,ON_ERROR_OCCURED:qa}=an,Qa=[ee.GLOGAL_LOADING,ee.PRIVATE_LOADING];function ei(e){const{plugins:t,bus:n}=Y();t.push(e);const r={on:(o,s)=>n.on(o,s),onStateChanged:o=>n.on(dn,o)};e.install(r)}function ti(e,t){const{bus:n}=Y();if(n.canEmit(dn)){const{from:r,desc:o}=t,{sharedKey:s,moduleName:c,snap:a,usefulName:i,stateType:f}=e;let l;Qa.includes(f)?l=`${i}/setState`:l=`${i}@${r||"Api"}/${o}`,n.emit(dn,{snap:a,sharedKey:s,moduleName:c,type:l})}}function ni(e){const{bus:t}=Y();if(t.canEmit(co)){const{snap:n,sharedKey:r,moduleName:o,usefulName:s}=e,c=`${s}@FactoryApi/createShared`;t.emit(co,{snap:n,sharedKey:r,moduleName:o,type:c})}}function ao(e,t,n){const{bus:r}=Y();if(!r.canEmit(t))return!1;const{sharedKey:o,moduleName:s}=e;return r.emit(t,{moduleName:s,sharedKey:o,data:n}),!0}function io(e,t){ao(e,qa,{err:t})||(console.warn("found uncaught error, sugguest add a plugin to handle this error"),console.error(t))}function ri(){const{userBus:e}=Y();return e}function oi(e,...t){const{userBus:n}=Y();n.emit(e,...t)}function si(e,t){const{userBus:n}=Y();return n.on(e,t),()=>n.off(e,t)}function ci(e,t){return e.__proto__=t,e}function ai(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n]);return e}var pn=Object.setPrototypeOf||({__proto__:[]}instanceof Array?ci:ai);function ii(e){const t=Object.create(null);return pn(t,C({},Object.prototype)),e&&Object.assign(t,e),t}function uo(e){if(x(e))return;const t=Object.create(null);return pn(t,Object.prototype),pn(e,t),e}function fo(e,t,n){return e[t]=n,!0}function lo(e,t){return e[t]}function Ge(e,t){const{set:n=fo,get:r=lo,obj:o={}}=t||{};return Object.keys(e).forEach(s=>{Object.defineProperty(o,s,{enumerable:!0,configurable:!1,set:function(c){return n(e,s,c)},get:function(){return r(e,s)}})}),o}function Ee(e,t){const{set:n=fo,get:r=lo}=t||{};if(ke())return new Proxy(e,{set(c,a,i){return n(c,a,i)},get(c,a){return r(c,a)}});const o=ii();return Ge(o,{obj:o,set:n,get:r})}var je=Y();function St(e){const n=Y()[e];return je[e]=n,n}function te(){return je.blockScope||St("blockScope")}function U(){return je.fnScope||St("fnScope")}function ce(){return je.sharedScope||St("sharedScope")}function po(){return je.insScope||St("insScope")}function yo(){const{INTERMAL_MAP:e}=ce();return e}function ui(e,t){if(!e||!le()||!t)return;const{INTERMAL_MAP:n,SHARED_KEY_STATE_MAP:r,STATE_SHARED_KEY_MAP:o}=ce();let s=[],c=!1;if(n.forEach(a=>{a.moduleName===e&&a.loc===t&&a.stateType===ee.USER_STATE&&s.push(a.sharedKey)}),s.length>1){const a=s[0],i=n.get(a);n.delete(a),i&&(r.delete(i.sharedKey),o.delete(i.rawState))}return c}function $e(e){return yo().get(e)}function B(e){const t=ae(e);return $e(t)}function fi(e,t){const n=yo(),r=ae(e);n.set(r,t)}function li(e){return B(e).rawState}function ho(e,t=!0){const n=B(e);return t?n.prevSnap:n.snap}function ae(e){return e&&(e[dt]||ce().STATE_SHARED_KEY_MAP.get(e))||0}function yn(e){let t={state:{},stateRoot:{},isAtom:!1};if(!e)return t;const n=B(e);if(n){const{sharedState:r,sharedRoot:o}=n;t={state:r,stateRoot:o,isAtom:n.forAtom}}return t}function di(e){const t=ce(),{STATE_SHARED_KEY_MAP:n}=t,r=Le(t.keySeed);return n.set(e,r),t.keySeed=r,r}function pi(e,t){const{SHARED_KEY_STATE_MAP:n,STATE_SHARED_KEY_MAP:r}=ce();n.set(e,t),r.set(t,e)}function yi(e){return ce().SHARED_KEY_STATE_MAP.get(e)}function hi(e,t){const{rootState:n,ctx:r}=Wa(),{moduleName:o,usefulName:s}=t,c=n[s],a=B(c);if(o&&a&&a.loc!==t.loc){const i=`
loc1:${a.loc} 
loc2:${t.loc}`;return Ie(`only-dev-mode tip: moduleName ${o} duplicate! this does not effect helux but the duplicated module will be ignored by devtool`+i)}n[s]=e,r.mod[s]=B(e)}var mi={innerSetState:O};function mo(e,t){const{rawState:n,forAtom:r}=e,o=new Map,s={},c={},a=[],i=C({},n);let f=i;return r&&(f=n.val),H(C(C({ver:0,sn:0,reactive:n,reactiveRoot:n,sync:O,syncer:O,snap:i,prevSnap:i,rawStateVal:f},e),t),{insCtxMap:o,key2InsKeys:s,id2InsKeys:c,recordId(l,u){if(!l)return;const d=Ne(c,l,[]);F(d,u)},delId(l,u){l&&Z(c[l]||[],u)},recordDep(l,u){const d=Ne(s,l,[]);F(d,u)},delDep(l,u){Z(s[l]||[],u)},mapInsCtx(l,u){o.set(u,l)},delInsCtx(l){o.delete(l)},extra:{},loadingInternal:mi,level1ArrKeys:a})}var gi={Mutate:"",Reactive:"r",[se.STATIC]:"s",[se.HOOK]:"h"};function Ei(){const e=po(),t=Le(e.keySeed);return e.keySeed=t,t}function vi(){const e=te(),{keySeed:t,keyPrefix:n}=e,r=Le(t);e.keySeed=r;let o=n;return pr(t)&&(o=Le(n),e.keyPrefix=o),`${o}_${r}`}function Si(){const e=Y(),t=e.renderSN,n=t===Number.MAX_VALUE?1:t+1;return e.renderSN=n,n}function hn(e){const t=gi[e],r=U().keySeed,o=Le(r[e]);return r[e]=o,`${t}${o}`}function Ai(){return hn("Reactive")}var{MAY_TRANSFER:_i}=gt,{SET_STATE:Di,REACTIVE:Ki}=G,Ri=()=>({isReplaced:!1,replacedValue:null}),Ti=()=>{},Mi=gn({isFake:!0});function go(e,t,n=O){const{desc:r="",onRead:o,from:s=Ki,depKeys:c=[],isTop:a=!1,expired:i=!1,insKey:f=0}=t;return{draft:e,finish:n,modified:!1,expired:i,sharedKey:0,moduleName:"",hasFlushTask:!1,nextTickFlush:O,data:[],isTop:a,key:"",fnKey:"",depKeys:c,writeKeys:[],desc:r,onRead:o,from:s,insKey:f}}function mn(e){const{ids:t=[],globalIds:n=[],isReactive:r=!1,from:o=Di,enableDep:s=!1,handleCbReturn:c=!0,sn:a=Si(),isFirstCall:i=!1,desc:f="",onRead:l}=e;return{fnKey:"",depKeys:[],forcedDepKeys:[],triggerReasons:[],ids:t,globalIds:n,readKeys:{},writeKeys:{},arrKeyDict:{},writeKeyPathInfo:{},handleCbReturn:c,draftVal:null,from:o,isReactive:r,enableDep:s,sn:a,isFirstCall:i,desc:f,onRead:l}}function We(e,t,n){const{isChanged:r=!0,parentKeyPath:o=[],op:s="set",parentType:c="Object"}=n,a=o.slice();return a.push(e),{isChanged:r,isCustom:!1,op:s,immutBase:!1,key:e,value:t,proxyValue:t,parentType:c,keyPath:o,fullKeyPath:a,isBuiltInFnKey:!1,replaceValue:O,getReplaced:Ri}}function gn(e){const u=e||{},{desc:t="",fn:n=O,task:r=Ti,depKeys:o=[],writeKeys:s=[],deps:c=we,isFake:a=!1,onlyDeps:i=!1}=u,f=vc(u,["desc","fn","task","depKeys","writeKeys","deps","isFake","onlyDeps"]);return C({fn:n,task:r,deps:c,oriDesc:"",onlyDeps:i,desc:t,depKeys:o,writeKeys:s,checkDeadCycle:void 0,watchKey:"",isFake:a,enabled:!0,extraBound:{state:{},stateRoot:{},isAtom:!1}},f)}function Eo(){const e={fnKey:"",fn:O,subFnInfo:Mi,checkDeadCycle:!0,isFirstLevel:!0,isExpired:!1,task:O,deps:we,status:{loading:!1,err:null,ok:!0},stateRoot:{},isStateAtom:!1,forAtom:!1,remainRunCount:0,showLoading:!1,nextLevelFnKeys:[],prevLevelFnKeys:[],mountStatus:ht,depKeys:[],depSharedKeys:[],result:{},fnType:"watch",returnUpstreamResult:!1,scopeType:"static",renderStatus:He,proxyResult:{},updater:O,createTime:Date.now(),shouldReplaceResult:!1,isAsync:!1,isAsyncTransfer:!1,isSimpleWatch:!1,isRunning:!1,dcErrorInfo:{err:null,tipFn:O},asyncType:_i,subscribe:t=>{t()},extra:{},setLoading:(t,n=null)=>{const r=!t&&!n;e.status={loading:t,err:n,ok:r}},renderInfo:{time:0,insKey:0,sn:0,getDeps:()=>e.depKeys.slice()}};return e}var vo={draftRoot:{val:null},isFake:!0,isAtom:!0},So=mn({}),At=go(!0,{expired:!0}),fp=gn(),Ao=mo({rawState:{},forAtom:!1,usefulName:""},{}),_o=Eo(),_t=vo,En=So,Do="",vn=new Map,Sn=new Map,An=new Map,_n=O,Dn=[],Kn="";function bi(){return _t}var Xe={current:()=>Kn,set:e=>Kn=e,del:()=>Kn=""},Rn={current:()=>_n,set:e=>_n=e,del:()=>_n=O},ze={current:e=>Sn.get(e)||"SetState",set:(e,t)=>Sn.set(e,t),del:e=>Sn.delete(e)},Je={current:()=>Dn,set:e=>Dn=e,del:()=>Dn=[]},ie={current:()=>An.get(Do)||At,markUsing:e=>Do=e,set:(e,t)=>An.set(e,t),del:e=>An.delete(e)},Tn={current:e=>vn.get(e),set:(e,t)=>vn.set(e,t),del:e=>vn.delete(e)},Dt={current:()=>_t,set:(e,t)=>{Object.assign(_t,{draftRoot:e,isAtom:t,isFake:!1})},del:()=>_t=vo},Mn={current:()=>En,set:e=>En=e,del:()=>En=So};function bn(e){const{FNKEY_STATIC_CTX_MAP:t,FNKEY_HOOK_CTX_MAP:n}=U();return e[0]==="s"?t:n}function wi(e,t){const{DEPKEY_COMPUTING_FNKEYS_MAP:n}=U();ot(n,e,[]).push(t)}function Ii(e,t){const{DEPKEY_COMPUTING_FNKEYS_MAP:n}=U(),r=n.get(e);r&&Z(r,t)}function Fi(e){const{DEPKEY_FNKEYS_MAP:t}=U(),{depKeys:n,fnKey:r}=e;n.forEach(o=>{const s=t.get(o)||[];Z(s,r)})}function Ko(e,t){const{FNKEY_STATIC_CTX_MAP:n}=U(),{fnKey:r,prevLevelFnKeys:o}=e;o.forEach(s=>{var a;const c=(a=n.get(s))==null?void 0:a.nextLevelFnKeys;c&&(t?F(c,r):Z(c,r))})}function Ci(){const{FNKEY_HOOK_CTX_MAP:e}=U();le()&&e.forEach(t=>{t.isExpired=!0})}function Ro(e,t,n){const r=n||hn(t);return x(e)?e[lt]=r:(uo(e),e.__proto__[lt]=r),r}function To(e){return x(e)?e[lt]||"":W(e)&&e.__proto__[lt]||""}function ve(e){return bn(e).get(e)}function wn(e){return bn(e).get(e)||_o}function Ze(e){const t=To(e);return ve(t)||null}function Kt(){const{runningFnKey:e,depKeys:t,runningSharedKey:n,isIgnore:r}=U();return{fnCtx:e?ve(e):null,depKeys:t,isIgnore:r,runningSharedKey:n}}function Oi(){return U().runningFnKey}var{USER_STATE:Pi}=ee;function xi(e,t=8){let n="";if(le()&&e)try{throw new Error("loc")}catch(r){const o=r.stack.split(`
`),s=o[1]||"";s.includes("webpack-internal")||s.includes("/node_modules/")?n=o.slice(0,16).join(" -> "):n=o.map(a=>a.substring(0,a.indexOf("(")).trim()).slice(4,t).join(" -> ")}return n}function Mo(e){const[t,n]=e.split("/"),r=n.split(Oe);return{sharedKey:Number(t),keyPath:r,depKey:e}}function bo(e){const{sharedKey:t,forAtom:n}=e,r=n?"/val":"",o=n?["val"]:[];return{depKey:`${t}${r}`,keyPath:o,sharedKey:t}}function $(e,t){try{return Yt(e.join(Oe),t)}catch(n){return console.warn("found Symbol key in your path :",e),`${t}`}}function ki(e,t){const{snap:n,prevSnap:r,stateType:o}=e;if(Pi!==o)return!0;const{keyPath:s}=Mo(t);try{const c=pe(n,s),a=pe(r,s);return c!==a}catch(c){return!0}}function Li(e,t){return ke()?ft(e,{onOperate:t,compareVer:!0}):Ee(e,{get(n,r){const o=n[r],s=We(r,o,{isChanged:!1,parentKeyPath:[]});return t(s),o}})}function Ni(e,t){if(t!==void 0){if(e)return{val:t};if(W(t))return t}}function Vi(e,t,n){const r=x(t)?t(n):t;return Ni(e,r)}function Rt(e,t){let{value:n}=e;if(t){t(e);const{replacedValue:r,isReplaced:o}=e.getReplaced();o&&(n=r)}return n}function wo(e){return[Va,Na].includes(e)}function Ui(e){return Array.isArray(e)||Vt(e)}var{isObject:Se,getDataType:Io}=Ur;function In(e,t){return typeof e=="boolean"?e:t}function Fo(e,t){if(e===t)return e;const r=t.substring(e.length+1).split(Oe);return`${e}${Oe}${r[0]}`}function Bi(e,t){be(e,t)||F(e,t)}var Fn=new Map;function Co(e,t){let n=!1;const{depKey:r,keyPath:o,sharedKey:s}=e,{stopDepInfo:c,level1ArrKeys:a,recordCb:i}=t,f=Fn.get(r);if(f)return i(f),!0;const{keys:l,isArrDict:u,depth:d,arrKeyStopDcit:p,stopArrDep:m}=c,g=be(a,r),y=o.length>d;if(y||g){let v="",R=d;return g&&(R=d+1,p[g]===!1||m&&(y?v=$(o.slice(0,R),s):v=Fo(g,r))),v||(v=$(o.slice(0,R),s)),g||Fn.set(r,v),i(v),!0}const E=String(s);for(const v of l){if(!r.startsWith(v)||v===E)continue;const R=u[v],T=R?Fo(v,r):v;R||Fn.set(r,T),i(T),n=!0;break}return n}function Cn(e,t){const n=te(),{runningKey:r}=n;if(r){const{KEY_DYNAMIC_CTX_MAP:o,KEY_CTX_MAP:s,isDynamic:c}=n,i=(c?o:s).get(r);if(i){const{results:f,depKeys:l}=i;t?F(f,t):e.forEach(u=>F(l,u))}}}function Tt(e,t){const n=ce(),{COMPARE_MAP:r}=n;let o=r.get(t);return o!==void 0?o:e.sharedKeyStr===t?n.isStateChanged:(o=ki(e,t),r.set(t,o),o&&(n.isStateChanged=!0),o)}function Oo(e,t,n){if(t.includes(n)&&Tt(e,n))return!0;let r=!1;for(const o of t)o.startsWith(n)&&Tt(e,o)&&(r=!0);return r}function Yi(){const e=ce();e.COMPARE_MAP.clear(),e.isStateChanged=!1}function On(e=!0){const t=U();t.isIgnore=e}function xe(e,t){const{fnCtx:n,depKeys:r,isIgnore:o}=Kt(),s=t.specificCtx||n;if(!s){Rn.current()(e);return}const{DEPKEY_FNKEYS_MAP:c}=U(),{belongCtx:a,sharedKey:i}=t;if(i&&F(s.depSharedKeys,i),n&&a){n.isFirstLevel=!1,a.isAsync&&(n.isAsync=!0);const l=a.fnKey;F(s.prevLevelFnKeys,l),F(a.nextLevelFnKeys,n.fnKey)}const{fnKey:f}=s;e.forEach(l=>{if(Ia===l||o)return;n&&F(r,l);const u=ot(c,l,[]);F(u,f)})}function Pn(e){e&&e.depKeys.forEach(t=>xe([t],{specificCtx:e}))}function Po(e){const{FNKEY_HOOK_CTX_MAP:t,UNMOUNT_INFO_MAP:n}=U(),{fnKey:r}=e;t.set(r,e),Ko(e,!0);let o=n.get(r);o?o.c=2:(o={c:1,t:Date.now(),prev:0},n.set(r,o));const{c:s}=o;if(s===2){const c=ve(r);Pn(c)}}function xo(e){let t="";return e.depSharedKeys.forEach(n=>{var o;const r=((o=$e(n))==null?void 0:o.ver)||0;t+=`${r}_`}),t}function Hi(e,t,n){const{DEPKEY_FNKEYS_MAP:r}=U(),o=r.get(t)||[],s=[],c=[];return o.forEach(a=>{const i=ve(a);if(i&&Oo(e,i.depKeys,t)){i.isFirstLevel&&s.push(a),i.isAsync&&c.push(a);const f=n[a];n[a]=f===void 0?1:f+1}}),{firstLevelFnKeys:s,asyncFnKeys:c}}function xn(e){Fi(e),Ko(e)}function Gi(){const{FNKEY_HOOK_CTX_MAP:e}=U();if(e.size>=ka){const t=Date.now();e.forEach(n=>{const{mountStatus:r,createTime:o,fnKey:s}=n;[ht,Zr].includes(r)&&t-o>Jr&&(xn(n),e.delete(s))})}}function kn(e,t,n,r,o,s=!1,c=!1){const a=te();a.latest={sharedKey:e,val:t,stateOrResult:n,depKey:r,keyPath:o,isDerivedResult:s,isDerivedAtom:c}}function ji(){return te().latest}function ko(e){const{KEY_DYNAMIC_CTX_MAP:t,KEY_CTX_MAP:n}=te();return e?t:n}function Lo(){return Ie("changing shared state is invalid"),!0}function Mt(e,t,n,r,o){return r===Ce?e?t:!1:r===dt?n:o}function Ln(e,t,n){e.replaceValue(Mt(e.keyPath.length===0,t,n,e.key,e.value))}function $i(e){let t={};const{rawState:n,sharedKey:r,forAtom:o,onRead:s,isPrimitive:c,stopDepth:a}=e,i=(l,u)=>{const d=$(l,r);xe([d],{sharedKey:r}),Cn([d]),kn(r,u,t,d,l)};if(Fa)t=ft(n,{customKeys:pt,onOperate:l=>{const{isBuiltInFnKey:u,isCustom:d}=l;if(d)return Ln(l,o,r);if(!u){const{fullKeyPath:p}=l,m=Rt(l,s);i(p,m)}},compareVer:!0});else{const l=(u,d,p)=>Ge(u,{set:Lo,get:(m,g)=>{const y=m[g];if(pt.includes(g))return Mt(d===1,o,r,g,y);const E=We(g,y,{isChanged:!1,parentKeyPath:p});if(d<a&&Se(y))return l(y,d+1,E.fullKeyPath);const v=Rt(E,s);return i(E.fullKeyPath,v),v}});t=l(n,1,[])}let f=t;return o&&(c?f=n.val:f=Ee(n,{set:Lo,get:(l,u)=>t.val[u]})),pi(r,t),{sharedRoot:t,sharedState:f}}var No=null;function Nn(){return No}function Wi(e,t){const n=Y();let r=n.globalEmpty;if(!r){const{stateRoot:o}=t({apiCtx:e,rawState:{},forGlobal:!0,stateType:ee.GLOGAL_EMPTY}),s=B(o);n.globalEmpty=o,n.globalEmptyInternal=s}return No=r,r}function Vn(e){const{GID_INSKEYS_MAP:t}=U();return ot(t,e,[])}function Xi(){return Y().globalEmptyInternal}function Vo(e,t){if(!e)return;const n=Vn(e);F(n,t)}function zi(e,t){if(!e)return;const n=Vn(e);Z(n,t)}var{REACTIVE:Ji}=G,qe=new Map;function Zi(e){return!!(e&&!e.expired&&e.modified)}function qi(e){const{sharedKey:t}=e;e.expired=!0,ie.del(e.key);const n=ze.current(t);return ze.del(t),e.finish(null,{desc:n})}function Uo(e,t){const n=ae(e);return t&&ze.set(n,t),n}function Un(e,t){const n=ae(e);Qe(n,t)}function Qi(){const e=ie.current();e.isTop&&Qe(e.sharedKey,e.desc)}function Qe(e,t){const n=qe.get(e);Zi(n)&&(t&&ze.set(e,t),qi(n))}function eu(e){const t=qe.get(e)||At;t.expired=!0}function tu(e,t){const n=qe.get(e)||At;n.modified=!0,n.nextTickFlush(t)}function nu(e,t){const{from:n=Ji,onRead:r}=t,{finish:o,draftRoot:s}=e.setStateFactory({isReactive:!0,from:n,handleCbReturn:!1,enableDep:!0,onRead:r}),c=go(s,t,o);return c.key=Ai(),c.sharedKey=e.sharedKey,c.nextTickFlush=a=>{const{expired:i,hasFlushTask:f}=c;i||(c.data=[a]),f||(c.hasFlushTask=!0,Promise.resolve().then(()=>{const[l]=c.data;Qe(e.sharedKey,l)}))},c}function Bo(e,t,n){const{sharedKey:r}=e,{insKey:o=0,from:s}=t;let c=qe.get(r)||At;c.expired&&(c=nu(e,{isTop:!0,from:s}),qe.set(r,c),ie.set(c.key,c),c.fnKey=Xe.current()),ie.markUsing(c.key),c.onRead=o?t.onRead:void 0,c.insKey=o;const{draft:a}=c;return{val:n?a.val:a,meta:c}}function Bn(e,t){let n={},r={};const{rawState:o,deep:s,forAtom:c,isPrimitive:a,sharedKey:i}=e;if(Ht(s)){const f={[dt]:i,[Ce]:c},l=(d,p,m)=>{const{val:g}=Bo(e,t,d);return g[p]=m,!0},u=(d,p,m)=>{const g=m[p];if(g!==void 0)return g;const{val:y,meta:E}=Bo(e,t,d);return zr===p?E:y[p]};if(n=new Proxy(o,{set:(d,p,m)=>l(!1,p,m),get:(d,p)=>u(!1,p,f)}),r=n,c){const d=H(C({},f),{[Ce]:!1});r=a?o.val:new Proxy(o.val,{set:(p,m,g)=>l(!0,m,g),get:(p,m)=>u(!0,m,d)})}}else n=o,r=o.val;return{draftRoot:n,draft:r}}function ru(e){const{UNMOUNT_INFO_MAP:t}=po(),{insKey:n,readMap:r,internal:o}=e;o.mapInsCtx(e,n);let s=t.get(n);s?(s.c=2,s.prev=n-1):(s={c:1,t:Date.now(),prev:0},t.set(n,s));const{c}=s;c===2&&Object.keys(r).forEach(a=>{o.recordDep(a,n)})}function Yo(e){const{readMap:t,insKey:n,internal:r}=e;Object.keys(t).forEach(o=>r.delDep(o,n)),r.delInsCtx(n)}function ou(e){const{canCollect:t,isFirstRender:n,currentDepKeys:r}=e;if(!t){n&&(e.depKeys=r.slice());return}e.depKeys=r.slice()}function su(e){const{canCollect:t}=e;t&&(e.readMap={},e.delReadMap={},e.depKeys=e.currentDepKeys.slice(),e.currentDepKeys.length=0)}function Ho(e,t,n){if(!e.canCollect)return;const{parentType:r,rawVal:o}=n,s=Ui(o);s&&Bi(e.internal.level1ArrKeys,t.depKey),e.recordDep(t,r,s)}function Yn(e,t){const{depKeys:n,currentDepKeys:r,fixedDepKeys:o}=e;return(t?r:n).concat(o)}function cu(e){if(!e)return;const{updater:t,mountStatus:n,createTime:r}=e;if(n===ht){Date.now()-r>Jr?Yo(e):e.needEFUpdate=!0;return}t()}function Go(e){const{internal:t,isReactive:n,insKey:r}=e,{rawState:o,isDeep:s,sharedKey:c,onRead:a,forAtom:i}=t;if(s){const f=l=>{const{isBuiltInFnKey:u,key:d}=l;if(u)return;if(Ut(d))return Ln(l,i,c);const{fullKeyPath:p,keyPath:m,parentType:g}=l,y=Rt(l,a),v={depKey:$(p,c),keyPath:p,parentKeyPath:m,sharedKey:c};Ho(e,v,{parentType:g,rawVal:y})};if(n){const{draft:l,draftRoot:u}=Bn(t,{onRead:f,insKey:r});e.proxyState=u,e.proxyStateVal=l}else e.proxyState=ft(o,{onOperate:f,compareVer:!0})}else e.proxyState=Ee(o,{set:()=>(Ie("changing shared state is invalid"),!0),get:(f,l)=>{const u=f[l];if(Ut(l))return Mt(!0,i,c,l,u);const d=Rt(We(l,u,{isChanged:!1,parentKeyPath:[]}),a),p=Yt(l,c),m=Se(f)?Et:Ua;return Ho(e,{depKey:p,keyPath:[l],sharedKey:c},{parentType:m,rawVal:d}),d}})}function au(e){var K;const{updater:t,sharedState:n,id:r="",globalId:o="",collectType:s="every",deps:c,pure:a=!0,arrDep:i=!0,isReactive:f=!1}=e,l=i&&(K=e.arrIndexDep)!=null?K:!0,u=B(n);if(!u)throw new Error("ERR_OBJ_NOT_SHARED: input object is not a result returned by share api");const d=Ei(),{rawState:p,isDeep:m,ver:g,ruleConf:y,level1ArrKeys:E,forAtom:v,sharedKey:R,sharedKeyStr:T,snap:w}=u,{stopDepInfo:_}=y,b={readMap:{},delReadMap:{},pure:a,depKeys:[],fixedDepKeys:[],currentDepKeys:[],isDeep:m,isReactive:f,insKey:d,internal:u,rawState:p,sharedState:n,sharedKey:R,proxyState:{},proxyStateVal:{},updater:t,mountStatus:ht,renderStatus:He,needEFUpdate:!1,createTime:Date.now(),rootVal:null,ver:g,id:r,globalId:o,collectType:s,canCollect:s!=="no",isFirstRender:!0,subscribe:h=>{h()},extra:{},getDeps:()=>Yn(b,!0),renderInfo:{isAtom:v,setDraft:u.insSetDraft,time:Date.now(),sn:0,snap:w,insKey:d,getDeps:()=>Yn(b,!0),getPrevDeps:()=>Yn(b,!1)},recordDep:(h,S,D)=>{let A=h.depKey;Co(h,{stopDepInfo:_,level1ArrKeys:E,recordCb:Te=>{A=Te}});const{renderStatus:M,fixedDepKeys:L}=b;if(M===ln)return;const{readMap:I,insKey:P,currentDepKeys:Q,delReadMap:Re}=b;xe([A],{}),Oi()&&(Z(Q,A),F(b.fixedDepKeys,A));const Lt=()=>{I[A]=1,u.recordDep(A,P),L.includes(A)||F(Q,A)};if(!I[A]&&!Re[A]){const{parentKeyPath:Te}=h;if(a&&S===Et&&Te){const fe=Te.length?$(Te,R):T;I[fe]&&(delete I[fe],Re[fe]=1,Z(Q,fe))}const nt=wo(S);if(nt){l&&Lt();return}(!D||!nt&&i)&&Lt()}}};if(o&&Vo(o,d),Go(b),u.mapInsCtx(b,d),u.recordId(r,d),x(c)){const h=v?b.proxyState.val:b.proxyState,S=j(c,h),D=b.getDeps().slice();S.includes(h)&&D.push(u.rootValKey),b.fixedDepKeys=D}return b}function jo(e){const{result:t,forAtom:n}=e;e.proxyResult=Ee(t,{set:()=>(Ie("changing derived result is invalid"),!1),get:(r,o)=>Ye===o?n:(He===e.renderStatus&&Pn(e),t[o])})}function iu(e){const{proxyState:t,internal:n,renderInfo:r,canCollect:o,isReactive:s}=e,{sharedKey:c,sharedKeyStr:a,insSetState:i,forAtom:f}=n;r.snap=n.snap,r.time=Date.now();const l=f?t.val:t;return e.isFirstRender&&(e.rootVal=l,Tn.set(e.rootVal,e)),!f&&o&&e.recordDep({depKey:a,keyPath:[],sharedKey:c},Et),[s?t:l,i,r]}function uu(e,t){if(t&&!Pe(e))throw new Error("useAtom only accept atom")}function fu(e){const{ver:t,internal:{ver:n}}=e;t!==n&&(e.ver=n,Go(e))}function lu(e){e.mountStatus=mt;const{id:t,globalId:n,insKey:r}=e;e.internal.recordId(t,r),Vo(n,r),ru(e)}function du(e){e.mountStatus=Zr;const{id:t,globalId:n,insKey:r}=e;e.internal.delId(t,r),zi(n,r),Yo(e)}function pu(e,t){const n=B(t).sharedKey;return e.internal.sharedKey!==n}function bt(e,t,n,r){if(Y().isRootRender)try{const o=r||n;e.react.useSyncExternalStore(t,n,o)}catch(o){console.error(o)}}var yu=null;function $o(e,t,n){const{hookImpl:r,react:o}=e,s=r.useForceUpdate(),c=o.useRef({ctx:yu});let a=c.current.ctx;return(!a||pu(a,t))&&(a=au(C({updater:s,sharedState:t},n)),c.current.ctx=a),a}function Wo(e,t){e.react.useEffect(()=>(t.isFirstRender=!1,Tn.del(t.rootVal),t.collectType==="first"&&(t.canCollect=!1),t.needEFUpdate&&(t.needEFUpdate=!1,t.updater()),lu(t),()=>{du(t)}),[t])}function hu(e,t,n,r){n.renderStatus=He,su(n),bt(e,n.subscribe,()=>B(t).snap),e.react.useEffect(()=>{n.renderStatus=ln,n.isFirstRender=!1,ou(n)})}function Hn(e,t,n={}){const r=$o(e,t,n);return bt(e,r.subscribe,()=>B(t).snap),Wo(e,r),r}function wt(e,t,n={}){const{forAtom:r}=n;uu(t,r);const o=$o(e,t,n);return hu(e,t,o,n),Wo(e,o),fu(o),{tuple:iu(o),insCtx:o}}function Xo(e,t){const{forAtom:n,label:r,strict:o=!1}=t||{};let s;if(typeof e=="number"?s=$e(e):s=B(e),!s&&e){const a=e[zr];s=$e(a==null?void 0:a.sharedKey)}let c=r?`[[${r}]] err:`:"err:";if(!s)if(o)de(`${c} not a valid shared or atom`,{throwErr:!0});else return null;return n!==void 0&&(n&&!s.forAtom&&de(`${c} expect a shared but recived a atom`,{throwErr:!0}),!n&&s.forAtom&&de(`${c} expect a atom but recived a shared`,{throwErr:!0})),s}function Ae(e,t){return Xo(e,H(C({},t||{}),{strict:!0}))}var{MUTATE:mu,LOADING:gu}=G,{GLOGAL_LOADING:Eu,PRIVATE_LOADING:vu}=ee,{PRIVATE:Su,GLOBAL:Au}=un,zo={},_u={},Du={time:0,sn:0,getDeps:we,getPrevDeps:we,insKey:0,setDraft:O,isAtom:!1},Ku=[_e(zo,_u,mu),O,Du];function Ru(e,t){const{internal:n,apiCtx:r}=t,{mutateFnDict:o,moduleName:s}=n,c={};Object.keys(o).forEach(f=>{c[f]={loading:!1,err:null,ok:!0}});const a=s?`${s}@Loading`:"";return e({apiCtx:r,rawState:c,isLoading:!0,stateType:vu},{moduleName:a}).state}var Jo=null;function Tu(){return Jo}function Zo(){return Y().globalLoadingInternal}function Mu(e,t){const n=Y();let r=n.globalLoading;if(!r){const{stateRoot:o}=t({apiCtx:e,rawState:{},stateType:Eu},{moduleName:Oa}),s=B(o);n.globalLoadingInternal=s,n.globalLoading=o}return Jo=r,r}function Gn(e,t){let n=t;return Ut(t)&&(n=t.toString()),`${e}>${n}`}function qo(e,t,n){if(!t)return;const{loadingInternal:r}=e;r.innerSetState(o=>{o[t]=n},{from:gu}),n.err&&(ao(e,an.ON_ERROR_OCCURED,{err:n.err}),console.error(n.err))}function _e(e,t,n){let r=e[n];return r||(r=Ee(t,{get(o,s){const c=Gn(n,s);return o[c]||{loading:!1,ok:!0,err:null}}}),e[n]=r),r}function et(e,t){const{internal:n,from:r}=t,{stateType:o,recordLoading:s}=n,c=ee.USER_STATE===o;let a=_e(zo,{},r),i={};if(c)if(Su===s)i=n.extra.loadingProxy,i||(i=Ru(e,t),n.extra.loadingProxy=i,n.loadingInternal=B(i)),a=_e(n.extra,i,r);else if(Au===s){const f=Zo();i=Tu(),n.loadingInternal=f,a=_e(f.extra,i,r)}else i=Nn();else i=n.sharedState,a=_e(n.extra,i,r);return{loadingState:a,loadingProxy:i}}function Qo(e,t){if(!Se(t))return e;const n=Object.keys(t);if(!n.length)return e;const r=t[n[0]];return r.__sharedKey?H(C({},e),{internal:Ae(r.__sharedKey)}):e}function es(e,t){const{internal:n,from:r,apiCtx:o}=t,{stateType:s}=n,c=ee.USER_STATE===s;et(e,t);let a=()=>Ku;return c&&(a=i=>{const f=Qo(t,i),l=et(e,f).loadingProxy,{insCtx:{proxyState:u,internal:d,extra:p,renderInfo:m}}=wt(o,l);return[_e(p,u,r),d.setState,m]}),{useLoading:a,getLoading:i=>{const f=Qo(t,i);return et(e,f).loadingState}}}function It(e){const t=Eo();return Object.assign(t,e||{})}function De(){const e=U(),{runningFnKey:t}=e;if(!t)return[];const n=ve(t);let r=[];if(n){const{depKeys:o}=e,{depKeys:s}=n,c={};o.forEach(i=>c[i]=1),o.forEach(i=>{const f=hr(c,i);f&&f!==i&&delete c[f]}),Object.keys(c).forEach(i=>F(s,i)),r=s.slice()}return e.runningFnKey="",e.depKeys=[],e.runningSharedKey=0,r}function jn(e,t){const n=U();n.runningFnKey=e,n.runningSharedKey=t,n.isIgnore=!1}function ts(e,t){const{specificProps:n,fnCtxBase:r}=t,{scopeType:o}=n,s=Ro(e,o),c=C({fn:e,fnKey:s},n),a=r?Object.assign(r,c):It(c);return bn(o).set(s,a),a}function $n(e){var o;const{FNKEY_HOOK_CTX_MAP:t,UNMOUNT_INFO_MAP:n}=U(),{fnKey:r}=e;xn(e),e.extra.deferedWatch=null,t.delete(r),((o=n.get(r))==null?void 0:o.c)===2&&n.delete(r),Gi()}function ns(e){const{DEPKEY_COMPUTING_FNKEYS_MAP:t}=U(),{prevLevelFnKeys:n,depKeys:r}=e;let o=!1;for(const s of r){const c=t.get(s)||[];if(rt(c,n)){o=!0;break}}return o}function bu(e,t=!0,n=Oe){return e.map(r=>{const[o,s]=r.split("/"),c=s.split(Oe);return`${t?`${$e(Number(o)).usefulName}/`:""}${c.join(n)}`})}var Ft=new Map,Ct={WATCH:"1",MUTATE:"2"},wu={[Ct.WATCH]:"watch",[Ct.MUTATE]:"mutate fn or task"};function Iu(e=0){return{sn:e,descs:[],errs:[],timer:null,cycle:[]}}function rs(e,t,n){const r=new Error(`DEAD_CYCLE: module(${e}) found mutate fn(${n}) in these dead cycle fns [${t.join(",")}]`);return r.cause="DeadCycle",r.data=t,r}function Fu(e){Ft.delete(e)}function Cu(e,t,n,r){const o=wu[r],{desc:s,task:c,fn:a,isFake:i}=t.subFnInfo,f=s?`(${s})`:"",l=`DEAD_CYCLE: found reactive object in ${o}${f} cb is changing module(${e.usefulName})'s some of these dep keys(${bu(n,!1,".")}), it will cause a infinity loop call!`,u=i?t.fn:c||a;return{err:new Error(`[only-dev-mode alert] ${l}`),tipFn:()=>console.error(` ${l} open the stack to find the below fn: 
`,u)}}function Ou(e,t,n){if(e&&n){const{usefulName:r}=e,o=ot(Ft,r,Iu(t));o.sn!==t&&(o.descs=[],o.errs=[]);const{descs:s}=o;if(s.length>1&&s[0]===n){const c=s.slice();throw o.cycle=c,s.length=0,rs(r,c,n)}F(s,n)}}function Wn(e,t){t.tipFn(),de(t.err,{logErr:!1,throwErr:!1,alertErr:e.alertDeadCycleErr})}function Ke(e,t,n){const{depKeys:r,subFnInfo:o}=t;let s=t.depKeys,c=n;r.length>n.length&&(s=n,c=r);let a=!1;if(rt(s,c)){const i=o.desc?Ct.MUTATE:Ct.WATCH,f=Cu(e,t,n,i);Wn(e,f),t.dcErrorInfo=f,a=!0}return a}function Pu(e,t){const n=Ft.get(e);return!n||!n.cycle.includes(t)?{isIn:!1,cycle:[]}:{isIn:!0,cycle:n.cycle}}function xu(e,t,n=!0){const r=Ft.get(e);if(!r)return;const{timer:o,errs:s}=r;s.push(t),o&&clearTimeout(o),r.timer=setTimeout(()=>{let c=null;for(const a of s)c?a.data.length>c.data.length&&(c=a):c=a;c&&de(c,{alertErr:n}),s.length=0},0)}function Xn(e,t=0){const n=ve(e);n&&(n.showLoading&&(n.setLoading(!0),n.updater()),t&&(n.remainRunCount+=t))}var{MAY_TRANSFER:ku}=gt;function Lu(e,t){const{isFirstCall:n=!1,triggerReasons:r=[],sn:o=0,from:s,internal:c=Ao,desc:a,fromFnKey:i}=t;if(e.dcErrorInfo.err){Wn(c,e.dcErrorInfo);return}if(e.fnKey===i){Ke(c,e,e.depKeys);return}if(e.isSimpleWatch||!e.checkDeadCycle)return e.fn({isFirstCall:n,triggerReasons:r,sn:o});if(G.MUTATE===s&&Ou(c,o,a),e.isRunning&&Ke(c,e,t.depKeys||[]))return;const f=ie.current();if(f.fnKey===e.fnKey&&Ke(c,e,f.writeKeys)||(Qe(f.sharedKey,f.desc),e.isRunning===!0&&f.isTop&&Ke(c,e,f.writeKeys)))return;e.isRunning=!0,Xe.set(e.fnKey);const u=e.fn({isFirstCall:n,triggerReasons:r,sn:o});Xe.del();const d=ie.current();if(!(d.isTop&&d.fnKey===e.fnKey&&Ke(c,e,d.writeKeys))&&!(u&&u.task&&d.from===G.MUTATE&&Ke(c,e,e.subFnInfo.writeKeys)))return e.isRunning=!1,u}function os(e,t,n){let r=t.val;return n||(r=t),{input:j(e,{state:r,stateRoot:t,isAtom:n}),state:r,stateRoot:t}}function tt(e,t={}){const{isFirstCall:n=!1,forceFn:r=!1,forceTask:o=!1,throwErr:s=!1,triggerReasons:c=[],sn:a=0,err:i,unbox:f=!1,internal:l=Ao}=t,u=ve(e),d=(I=null)=>{if(I&&s)throw I;const P=u||_o;return f?[P.result.val,I]:[P.result,I]};if(!u)return d(new Error(`not a valid watch or derive cb for key ${e}`));if(u.fnType===qr)return Lu(u,t);const{isAsync:p,fn:m,task:g,isAsyncTransfer:y,forAtom:E,result:v,depKeys:R}=u;u.remainRunCount>0&&(u.remainRunCount-=1);const T=I=>{const P=E?{val:I}:I;!u.returnUpstreamResult&&P&&Object.assign(u.result,P),u.shouldReplaceResult=!0},w=()=>{u.renderInfo.sn=a,u.updater()},_=I=>{const{data:P,err:Q=null}=I;Q?u.setLoading(!1,Q):(T(P),n?p&&u.status.loading&&!ns(u)&&u.setLoading(!1,Q):u.remainRunCount===0&&u.setLoading(!1,Q)),w(),u.nextLevelFnKeys.forEach(Re=>{tt(Re,{isFirstCall:n,sn:a,triggerReasons:c,err:Q})})},b=E?v:v.val,{deps:K,isStateAtom:h}=u,{input:S,state:D,stateRoot:A}=os(K,u.stateRoot,h),M={isAtom:u.isStateAtom,state:D,stateRoot:A,isFirstCall:n,prevResult:b,triggerReasons:c,input:S,sn:a};if(!p||r||p&&!g){const I=m(M);return _({data:I}),d()}if(p&&n&&u.nextLevelFnKeys.forEach(I=>Xn(I,0)),y)return _({err:i}),d();if(u.asyncType===ku){const I=m(M);return _({data:I}),d()}if(g){let I=Ac;return n?(R.forEach(P=>wi(P,e)),I=()=>R.forEach(P=>Ii(P,e))):o&&u.nextLevelFnKeys.forEach(P=>Xn(P)),Promise.resolve(()=>{const P=g(M);return Bt(P)?P:(de("ERR_NON_FN: derive task arg should be async function!",{throwErr:s}),null)}).then(P=>P()).then(P=>(I(),_({data:P}),d())).catch(P=>{if(I(),_({err:P}),s)throw P;return io(l,P),d(P)})}return d(i)}function Ot(e,t){const n=Ze(e);if(!n)throw new Error("[Helux]: not a derived result");return tt(n.fnKey,C({},t||{}))}function Nu(e,t){return Ot(e,{forceFn:!0,throwErr:t})}function Vu(e,t){return Promise.resolve(Ot(e,{forceTask:!0,throwErr:t}))}function Uu(e,t){return Ot(e,{forceFn:!0,throwErr:t,unbox:!0})}function Bu(e,t){return Promise.resolve(Ot(e,{forceTask:!0,throwErr:t,unbox:!0}))}function Yu(e){const t=Ze(e);return t?t.status:{loading:!1,err:null,ok:!0}}function zn(e,t,n){const r=e.get(t);r&&(r.renderInfo.sn=n,cu(r))}function Hu(e){const{mutateCtx:t,internal:n}=e,{ids:r,globalIds:o,depKeys:s,triggerReasons:c,isFirstCall:a,from:i,sn:f,desc:l,fnKey:u}=t,{key2InsKeys:d,id2InsKeys:p,insCtxMap:m,rootValKey:g}=n;let y=[],E=[],v=[],R=[];const T={};if(a){const _=De();Je.set(_)}const w=_=>{if(!Tt(n,_))return;const b=d[_]||[],K=[];for(const D of b){if(y.includes(D))continue;const A=m.get(D);if(!A)continue;const M=A.getDeps();if(M[0]===g){Tt(n,g)&&K.push(D);continue}Oo(n,M,_)&&K.push(D)}y=y.concat(K);const{firstLevelFnKeys:h,asyncFnKeys:S}=Hi(n,_,T);v=v.concat(h),R=R.concat(S)};if(s.forEach(_=>w(_)),s.includes(g)||w(g),Yi(),r.forEach(_=>{y=y.concat(p[_]||[])}),o.forEach(_=>{Vn(_).forEach(b=>F(E,b))}),y=Me(y),v=Me(v),R=Me(R),R.forEach(_=>Xn(_,T[_])),v.forEach(_=>tt(_,{depKeys:s,sn:f,from:i,triggerReasons:c,internal:n,desc:l,isFirstCall:a,fromFnKey:u})),y.forEach(_=>zn(m,_,f)),E.length){const _=Xi().insCtxMap;E.forEach(b=>zn(_,b,f))}}function Gu(e){const{state:t,internal:n,mutateCtx:r}=e,{rawState:o,isDeep:s,ver:c,snap:a}=n;s?(n.prevSnap=c===0?C({},a):a,n.snap=t,Object.assign(o,t)):n.snap=C({},o),n.ver+=1,n.sn=r.sn,Hu(e)}var{MUTATE:ju}=G;function ss(e,t){const{writeKey:n,ids:r,internal:o,opParams:s}=t,{snap:c}=o,{fullKeyPath:a,value:i}=s;Object.keys(e).forEach(f=>{n.startsWith(f)&&pe(c,a)!==i&&e[f].forEach(l=>F(r,l))})}function cs(e,t){const{isChanged:n,fullKeyPath:r,keyPath:o,parentType:s,value:c}=e,{internal:a,mutateCtx:i}=t,{arrKeyDict:f,isReactive:l,readKeys:u}=i,{sharedKey:d}=a,p=wo(s),m=ie.current();if(e.op==="get"){p&&(f[$(o,d)]=1);const A=$(r,d);u[A]=1,i.enableDep&&(m.onRead?m.onRead(e):(Kt().fnCtx&&xe([A],{sharedKey:d}),l&&(Cn([A]),kn(d,c,a.sharedState,A,r))));return}if(!n)return;const{moduleName:g,ruleConf:y,level1ArrKeys:E}=a,{writeKeyPathInfo:v,ids:R,globalIds:T,writeKeys:w}=i,_=$(r,d);if(m.key&&(m.isTop?F(m.writeKeys,_):m.from===ju&&F(wn(m.fnKey).subFnInfo.writeKeys||[],_)),p){const A=$(o,d);v[A]={sharedKey:d,moduleName:g,keyPath:o},w[A]=1}const{hasIds:b,hasGlobalIds:K,stopDepInfo:h}=y;v[_]={sharedKey:d,moduleName:g,keyPath:r};const S=hr(f,_);S&&(w[S]=1),Co({sharedKey:d,keyPath:r,depKey:_},{stopDepInfo:h,level1ArrKeys:E,recordCb:A=>{w[A]=1}})||(w[_]=1),b&&ss(y.idsDict,{ids:R,writeKey:_,internal:a,opParams:e}),K&&ss(y.globalIdsDict,{ids:T,writeKey:_,internal:a,opParams:e}),l?tu(d,m.desc):eu(d)}function as(e,t){Object.keys(t).forEach(n=>{e[n]=t[n]})}function Pt(e,t){if(!t)return e;On(!0);const n=e.val;return On(!1),n}function is(e){const{partial:t,forAtom:n,draftRoot:r,draftNode:o}=e;if(!t)return;if(!n){Se(t)&&as(o,t);return}const s=t.val;if(Se(o)){Se(s)?as(o,s):console.warn("dict atom deny to handle a non-dict returned value!");return}r.val=s}function $u(e,t){const{internal:n,mutateCtx:r}=e,o=Pt(t,n.forAtom),{from:s,sn:c,desc:a}=r;n.before({from:s,draftRoot:t,draft:o,desc:a,sn:c}),Za(n,t,o,c)}function us(e,t,n,r){const{mutateCtx:o,internal:s}=e,{writeKeys:c,writeKeyPathInfo:a,handleCbReturn:i}=o,{forAtom:f}=s;i&&is({partial:r,forAtom:f,draftRoot:t,draftNode:n}),$u(e,t),o.depKeys=Object.keys(c),Dt.del(),Mn.del(),e.state=cn(t),e.state!==s.rawState&&(o.triggerReasons=Object.values(a),Gu(e),ti(s,o))}function fs(e,t){const{ids:n,globalIds:r,from:o,desc:s,fnKey:c}=t;n&&n.forEach(a=>F(e.ids,a)),r&&r.forEach(a=>F(e.globalIds,a)),o&&(e.from=o),s&&(e.desc=s),c&&(e.fnKey=c)}function Wu(e){const{internal:t,setFactoryOpts:n}=e,{forAtom:r,rawState:o}=t,s=mn(n),c=sn(o,{customKeys:pt,onOperate:i=>{if(i.isCustom)return Ln(i,r,t.sharedKey);cs(i,{internal:t,mutateCtx:s})}});Dt.set(c,r),Mn.set(s);const a=Pt(c,r);return r&&(s.readKeys={}),{draftRoot:c,draftNode:a,finishMutate(i,f={}){fs(s,f),us({state:{},mutateCtx:s,internal:t},c,a,i)}}}function Xu(e){return uo(e),di(e)}function zu(e){if(!e)return{};const{desc:t,ids:n,globalIds:r}=e;return{desc:t,ids:n,globalIds:r}}function Ju(e){const{forAtom:t=!1}=e;let n=e.rawState;const r=x(n);let o=!1;if(t)n=r?{val:n()}:{val:n},o=!n.val||!yr(n.val);else{if(n=r?n():n,!W(n))throw new Error("ERR_NON_OBJ: pass an non-object to createShared!");if(ae(n))throw new Error("ERR_ALREADY_SHARED: pass a shared object to createShared!")}return{isPrimitive:o,rawState:n}}function ls(e,t,n){let r=null,o=t||"";if(x(e)&&e!==O)r={[Xr]:1,fn:e,deps:we,oriDesc:o,onlyDeps:!1,desc:o,depKeys:[],writeKeys:[],checkDeadCycle:void 0,watchKey:"",isFake:!1,enabled:!0,extraBound:{state:{},stateRoot:{},isAtom:!1}};else if(W(e)){const{fn:s,desc:c,deps:a,task:i,immediate:f,checkDeadCycle:l,onlyDeps:u=!1}=e,d=t||c||"",p=x(s)?s:void 0,m=x(i)?i:void 0,g=x(a)?a:we;(s||i)&&(r={[Xr]:1,checkDeadCycle:l,fn:p,watchKey:"",desc:d,oriDesc:d,deps:g,task:m,onlyDeps:u,immediate:f,depKeys:[],writeKeys:[],isFake:!1,enabled:!0,extraBound:{state:{},stateRoot:{},isAtom:!1}})}if(r&&n){const{oriDesc:s}=r;(!s||n[s])&&(r.desc=hn(G.MUTATE))}return r}function ds(e,t,n=!0){const r={},o=t||{};if(!e)return r;const s=(c,a)=>{const i=ls(c,a,o);i&&(i.enabled=n,r[i.desc]=i,o[i.desc]=i)};if(Array.isArray(e))if(e.length===1){const c=e[0],a=(W(c)?c.desc:"")||yt;s(e[0],a)}else e.forEach(c=>s(c));else x(e)?s(e,yt):W(e)&&Object.keys(e).forEach(c=>{s(e[c],c)});return r}function Zu(e,t={}){var K,h,S,D,A;const{forAtom:n=!1,forGlobal:r=!1,stateType:o=ee.USER_STATE}=e,{rawState:s,isPrimitive:c}=Ju(e),a=Xu(s),i=t.moduleName||"",f=(K=t.alertDeadCycleErr)!=null?K:le(),l=(h=t.deep)!=null?h:!0,u=(S=t.checkDeadCycle)!=null?S:!0,d=(D=t.enableMutate)!=null?D:!0,p=t.recordLoading||un.PRIVATE,m=t.rules||[],g=t.before||O,y=t.mutate||O,E=(A=t.stopArrDep)!=null?A:!0,v=t.stopDepth||Pa,R=`${a}`,T=n?`${a}/val`:R,w=i||R,_=xi(i),b=ds(y,{},d);return{isDestroyed:!1,alertDeadCycleErr:f,checkDeadCycle:u,rawState:s,sharedKey:a,sharedKeyStr:R,rootValKey:T,moduleName:i,usefulName:w,forAtom:n,forGlobal:r,loc:_,deep:l,rules:m,before:g,mutate:y,mutateFnDict:b,onRead:null,enableMutate:d,stateType:o,recordLoading:p,stopArrDep:E,stopDepth:v,isPrimitive:c}}function qu(e){const{rawState:t,sharedKey:n,rootValKey:r,deep:o,rules:s,stopDepth:c,stopArrDep:a,forAtom:i}=e,f={},l={},u={keys:[],isArrDict:{},arrKeyStopDcit:{},depth:c,stopArrDep:a},d={},p=Ht(o);s.forEach(y=>{const E=[],{when:v,ids:R=[],globalIds:T=[],stopDep:w}=y;let _;if(p){let D="";_=ft(t,{onOperate:({fullKeyPath:A,value:M,isBuiltInFnKey:L})=>{if(L)return;const I=$(A,n);D&&I.includes(D)&&E.pop(),E.push(I),d[I]=Array.isArray(M),D=I}})}else _=Ee(t,{set:bc,get:(D,A)=>{const M=$([A],n);E.push(M);const L=D[A];return d[M]=Array.isArray(L),L}});const b=i?_.val:_,K=j(v,b),h=(D,A,M)=>{const L=Ne(D,M,[]);A.forEach(I=>F(L,I))},S=D=>{h(f,R,D),h(l,T,D);let A;d[D]?(A=w!=null?w:xa,u.arrKeyStopDcit[D]=A,u.isArrDict[D]=d[D]):A=w!=null?w:!1,A&&F(u.keys,D)};E.forEach(S),K.includes(b)&&S(r)});const m=Object.keys(f).length>0,g=Object.keys(l).length>0;return{hasIds:m,idsDict:f,hasGlobalIds:g,globalIdsDict:l,stopDepInfo:u}}function Qu(e){const{desc:t=yt,strict:n=!1,throwErr:r=!1}={};return typeof e=="string"?{desc:e,strict:n,throwErr:r}:H(C({desc:t,strict:n},e),{throwErr:r})}function ps(e,t){var o;let n=O,r=!1;return x(t)?n=t:W(t)&&(n=t.deps||O,r=(o=t.immediate)!=null?o:!1),r=e?!0:r,{immediate:r,deps:n}}function ef(e){return e?typeof e=="boolean"?{enableStatus:e}:W(e)?e:{}:{}}function tf(e){Array.isArray(e)&&e.forEach(t=>{const n=Tn.current(t),r=B(t)||(n==null?void 0:n.internal);if(r){const{depKey:o,sharedKey:s}=bo(r);xe([o],{sharedKey:s})}n&&n.recordDep(bo(r))})}function ys(e,t,n){const{deps:r,immediate:o}=ps(e,n),s=xt(t,{scopeType:se.STATIC,deps:r,immediate:o});return{run:c=>tt(s.fnKey,{throwErr:c}),unwatch:()=>xn(s)}}function xt(e,t){const{scopeType:n,fnCtxBase:r,immediate:o,deps:s=O,label:c="watch",sharedState:a,isSimpleWatch:i}=t;if(!x(e))throw new Error(`ERR_NON_FN: pass an non-function to ${c}!`);const f=ts(e,{specificProps:{scopeType:n,fnType:qr,isSimpleWatch:i},fnCtxBase:r});jn(f.fnKey,ae(a));const l=s()||[];return tf(l),o&&e({isFirstCall:!0}),De(),f}function nf(e,t){return ys(!1,e,t)}function rf(e,t){return ys(!0,e,t)}var hs=()=>{},Jn=new Map;function ms(e,t){const{forAtom:n,rawState:r}=e,{deps:o,extraBound:s}=t;return n?j(o,r.val,s):j(o,r,s)}function of(e){var t;return(t=Jn.get(e))!=null?t:!1}function Zn(e,t){const{sn:n,getArgs:r=O,from:o,throwErr:s,isFirstCall:c,fnItem:a,mergeReturn:i}=t,{desc:f="",depKeys:l,task:u=hs,extraBound:d}=a,p=B(e),{sharedKey:m}=p,g={desc:f,sn:n,from:o},y=Gn(o,f),{draft:E,draftRoot:v}=Bn(p,{depKeys:l,desc:f,from:o}),R=M=>{Qe(m,M)},T=M=>{R(f);const{finish:L}=p.setStateFactory(g);return L(M)},w=G.MUTATE===o?ms(p,a):[],_={isFirstCall:c,desc:f,setState:T,input:w,draft:E,draftRoot:v,flush:R,extraBound:d},b=r(_)||[_],K=Jn.get(u),h=K===void 0,S=(M,L,I)=>{(h||K)&&qo(p,y,{loading:M,err:L,ok:I})};S(!0,null,!1);const D=M=>{if(Je.del(),S(!1,M,!1),s)throw M;return{snap:p.snap,err:M,result:null}},A=M=>(i&&M&&T(M),S(!1,null,!0),R(f),{snap:p.snap,err:null,result:M});try{const M=u(...b),L=Bt(M);return Jn.set(u,L),L?Promise.resolve(M).then(A).catch(D):A(M)}catch(M){return D(M)}}function gs(e,t){const{sn:n,getArgs:r=O,from:o,throwErr:s,isFirstCall:c=!1,fnItem:a}=t,{desc:i="",watchKey:f,fn:l=hs,extraBound:u}=a,d=G.MUTATE===o;d&&Xe.set(f);const p=B(e),{setStateFactory:m,forAtom:g,sharedRoot:y}=p,v={desc:i,sn:n,from:o,isFirstCall:c,enableDep:d&&c},R=S=>{const{finish:D}=m(v);return D(S)},T=Pt(y,g),w=d?ms(p,a):[],{draftNode:_,draftRoot:b,finish:K}=m(v),h=r({draft:_,draftRoot:b,setState:R,desc:i,input:w})||[_,{input:w,state:T,draftRoot:b,isFirstCall:c,extraBound:u}];try{const S=wn(a.watchKey);if(S.dcErrorInfo.err)return Wn(p,S.dcErrorInfo),{snap:p.snap,err:null,result:null};const D=l(...h);return K(D,{fnKey:S.fnKey}),Es(p,a,c),{snap:p.snap,err:null,result:null}}catch(S){if(Es(p,a,c),s)throw S;return{snap:p.snap,err:S,result:null}}}function Es(e,t,n){n&&!t.onlyDeps&&(Kt().fnCtx?t.depKeys=De():t.depKeys=Je.current(),Je.del());const r=ie.current();r.isTop&&r.fnKey===t.watchKey&&Ke(e,wn(t.watchKey),r.writeKeys),Xe.del()}function sf(e,t){var r;Qi(),Je.del(),On(!1);const n=Kt().fnCtx;n&&(n.subFnInfo=t,n.checkDeadCycle=(r=t.checkDeadCycle)!=null?r:e.checkDeadCycle,t.watchKey=n.fnKey),t.onlyDeps&&(t.depKeys=De())}function qn(e){const{target:t,dict:n}=e,r=Object.keys(n);if(!r.length)return;const o=B(t),{mutateFnDict:s,usefulName:c,forAtom:a,sharedRoot:i}=o,f=l=>io(o,l);r.forEach(l=>{const u=s[l];xt(({sn:d,isFirstCall:p})=>{if(p&&sf(o,u),!o.enableMutate)return;const{desc:m,fn:g,task:y,immediate:E}=u,v=Pu(c,m);try{if(v.isIn)throw rs(c,v.cycle,m);const R={sn:d,throwErr:!0,isFirstCall:p,fnItem:u,from:G.MUTATE};if(g&&(p||!y)&&gs(t,R),y){p&&(u.depKeys=De());const T=p&&(E!=null?E:!g);(!p||T)&&Zn(t,R).catch(f)}return u}catch(R){R.cause==="DeadCycle"&&xu(c,R,o.alertDeadCycleErr),f(R)}},{deps:()=>u.deps?u.deps(Pt(i,a),u.extraBound)||[]:[],sharedState:t,scopeType:se.STATIC,immediate:!0})})}var{ACTION:vs}=G;function cf(e,t){const{label:n,throwErr:r,desc:o="",task:s,mergeReturn:c=!0}=t,a=In(r,!1),i=Ae(e,{label:n}),{forAtom:f}=i,l=(u,d)=>{const p=In(d,a),m=gn({desc:o,task:s,depKeys:[]}),g=(y,E)=>y.__action?y.__action(E):y(E);return Zn(e,{fnItem:m,from:vs,mergeReturn:c,throwErr:p,getArgs:({draft:y,draftRoot:E,setState:v,desc:R,flush:T})=>[{draft:y,draftRoot:E,setState:v,desc:R,payload:u,flush:T,merge:_=>{is({partial:_,forAtom:f,draftRoot:E,draftNode:y})},dispatch:g}]})};return qo(i,Gn(vs,o),{loading:!1,ok:!0,err:null}),l.__sharedKey=i.sharedKey,l.__fnName=o,l.__task=s,s.__action=l,l}function Ss(e){return t=>(n,r="",o)=>cf(e,{task:n,desc:r,label:"action",mergeReturn:t,throwErr:o})}var{TASK:As}=gt,{STATIC:af,HOOK:uf}=se;function _s(e,t,n){if(!n&&(!W(t)||Bt(t)))throw new Error("ERR_NON_OBJ: derive,deriveAsync expect result to be a plain object");const{isAsync:r,isAsyncTransfer:o}=e;if(r&&!o){const s=To(t),c=ae(t);if(s&&e.fnKey!==s||c)throw new Error("ERR_INVALID_CALL: derive,deriveAsync can not transfer another derived result or shared state, it will cause wrong result")}}function ff(e,t){const n=Ee(e.result,{set:()=>(Ie("changing derived result is invalid"),!1),get:(r,o)=>{if(o===Ye)return t;const s=r[o];return xe(e.depKeys,{belongCtx:e}),Cn(e.depKeys,n),kn(0,s,n,"",[o],!0,t),s}});return e.proxyResult=n,n}function Ds(e,t){const{result:n,isUpstream:r}=t,o=Ze(n);o&&(e.depKeys=Me(e.depKeys.concat(o.depKeys)),F(o.nextLevelFnKeys,e.fnKey),F(e.prevLevelFnKeys,o.fnKey),e.isFirstLevel=!1,r==null||r())}function lf(e){var K,h;const{scopeType:t=af,fnCtxBase:n,isAsyncTransfer:r=!1,asyncType:o=As,returnUpstreamResult:s,runAsync:c=!0,forAtom:a=!1,immediate:i}=e;if(!x(e.fn))throw new Error("ERR_NON_FN: derive need fn arg!");const{fn:f=O,deps:l=O,task:u,stateRoot:d={}}=e,p=Pe(d),m=(K=e.isAsync)!=null?K:x(u),g=(h=e.showLoading)!=null?h:m,y=ts(f,{specificProps:{forAtom:a,scopeType:t,stateRoot:d,isStateAtom:p,fnType:La,task:u,deps:l,isAsync:m,asyncType:o,isAsyncTransfer:r,showLoading:g},fnCtxBase:n});jn(y.fnKey,0);const{input:E,state:v}=os(l,d,p);E.forEach(S=>Ds(y,{result:S}));let T=f({isFirstCall:!0,prevResult:null,triggerReasons:[],input:E,sn:0,state:v,stateRoot:d,isAtom:p});De();const w=Ze(T);a&&!w&&(T={val:T,z__is_atom_result__:!0});const _=y.fnKey;_s(y,T),Ds(y,{result:T,isUpstream:()=>{y.returnUpstreamResult=s!=null?s:!m}}),Pn(y),y.returnUpstreamResult||Ro(T,t,_);const b=c&&o===As&&(i!=null?i:!e.fn);return u&&b&&tt(_,{isFirstCall:!0,sn:y.renderInfo.sn+1}).then(S=>{_s(y,S[0],a)}).catch(S=>de(S)),y.result=T,t===uf&&ns(y)&&y.setLoading(!0),y.returnUpstreamResult?y.proxyResult=T:ff(y,a),y}function Qn(e,t){const n=x(e)?{fn:e}:e||{};return lf(C(C({},t||{}),n))}function Ks(e,t){return Qn(e,{forAtom:!0,stateRoot:t}).proxyResult}function df(e,t){return Qn(e,{stateRoot:t}).proxyResult}function pf(e){return t=>H(C({},t),{deps:e})}function yf(e){return e}var kt=e=>[e.snap,e.err];function er(e){const{target:t,desc:n="",forTask:r=!1,throwErr:o}=e,{mutateFnDict:s,snap:c}=B(t),a=n||yt,i=s[a];if(!i)return{snap:c,err:new Error(`mutate fn ${a} not defined`),result:null};if(r&&!i.task)return{snap:c,err:new Error(`mutate task ${a} not defined`),result:null};const f=In(o,!1),l={sn:0,fnItem:i,from:G.MUTATE,throwErr:f};return r?Zn(t,l):gs(t,l)}function Rs(e,t,n,r){return{run:o=>{const s=er({target:e,desc:t,throwErr:o});return kt(s)},runTask:o=>Promise.resolve(er({target:e,desc:t,forTask:!0,throwErr:o})).then(kt),desc:t,oriDesc:n,getSnap:()=>r.snap,snap:r.snap,__sharedKey:r.sharedKey}}function hf(e){const{target:t,fnItem:n,label:r,extraTarget:o}=e,s=Ae(t,{label:r}),c=ls(n,"",s.mutateFnDict);if(!c)throw new Error("not a fn or fnItem { fn }");o&&(c.extraBound=yn(o)),s.mutateFnDict[c.desc]=c,c.enabled=s.enableMutate;const a={[c.desc]:c};return s.enableMutate&&qn({target:t,dict:a}),Rs(t,c.desc,c.oriDesc,s)}function mf(e){const{target:t,fnDict:n,label:r}=e,o=Ae(t,{label:r}),s=ds(n,o.mutateFnDict,o.enableMutate);if(e.extraTarget){const a=yn(e.extraTarget);Object.keys(s).forEach(i=>s[i].extraBound=a)}o.enableMutate&&qn({target:t,dict:s});const c={};return Object.keys(s).forEach(a=>{c[a]=Rs(t,a,a,o)}),c}function gf(e,t){const{label:n,descOrOptions:r,forTask:o=!1}=t,{desc:s,strict:c,throwErr:a}=Qu(r);return s?Xo(e,{label:n,strict:c})?{ok:!0,desc:s,forTask:o,throwErr:a,err:null}:{ok:!1,desc:s,forTask:o,throwErr:a,err:new Error("not a valid atom or shared result")}:{ok:!1,desc:s,forTask:o,throwErr:a,err:new Error("miss desc")}}function Ts(e,t){const{ok:n,desc:r,forTask:o,err:s,throwErr:c}=gf(e,t);if(!n){if(c)throw s;return o?Promise.resolve([e,s]):[e,s]}const a=er({target:e,desc:r,forTask:o,throwErr:c});return o?Promise.resolve(a).then(kt):kt(a)}function Ms(e,t){return Ts(e,{descOrOptions:t,label:"runMutate"})}function bs(e,t){return Ts(e,{descOrOptions:t,label:"runMutateTask",forTask:!0})}function ws(e,t){return n=>hf({target:e,extraTarget:t,fnItem:n,label:"mutate"})}function tr(e,t){return n=>mf({target:e,extraTarget:t,fnDict:n,label:"mutateDict"})}function Ef(e){return e}function Is(e,t,n={}){const{tuple:r}=wt(e,t,n);return r}function Fs(e,t,n={}){const{tuple:r}=wt(e,t,n),[o,s,c]=r;return H(C({},c),{state:o,setState:s})}var vf="ERR_NOT_DERIVED_RESULT: useDerived only accept derived result",Sf="ERR_NOT_ATOM_RESULT: useDerivedAtom only accept derived atom";function Af(e,t,n){return e.isExpired?(e.isExpired=!1,!0):x(n)?!1:n!==t}function _f(e){$n(e),e.depKeys.length=0,e.prevLevelFnKeys.length=0,e.renderInfo.sn+=1}function Df(e,t){const{result:n,forAtom:r,showLoading:o}=t,{fnCtx:s,input:c,deriveFn:a}=e;let i=!1;if(a)if(Af(s,c,n))i=!0,_f(s);else return;e.input=n;const f=Ze(n);if(!f)throw new Error(vf);if(r&&!ge(n))throw new Error(Sf);e.deriveFn=()=>f.result,Qn({fn:()=>f.result,deps:()=>[],task:()=>Sc(this,null,function*(){return f.result})},{isAsync:f.isAsync,scopeType:se.HOOK,fnCtxBase:s,isAsyncTransfer:!0,runAsync:!1,returnUpstreamResult:!0,forAtom:r,asyncType:gt.MAY_TRANSFER,showLoading:o}),jo(s),i&&s.updater()}function Cs(e,t){const{result:n,forAtom:r}=t,{hookImpl:o,react:s}=e,c=o.useForceUpdate(),{current:a}=s.useRef({input:n,deriveFn:null,fnCtx:null});a.fnCtx||(a.fnCtx=It({updater:c,scopeType:se.HOOK,forAtom:r}));const i=a.fnCtx;return i.renderStatus=He,Df(a,t),i}function Kf(e,t){t.shouldReplaceResult&&(jo(t),t.shouldReplaceResult=!1),bt(e,t.subscribe,()=>xo(t)),e.react.useEffect(()=>{t.renderStatus=ln})}function Os(e,t){e.react.useEffect(()=>(t.mountStatus=mt,Po(t),()=>{$n(t)}),[t])}function nr(e,t){const n=Cs(e,t);return bt(e,n.subscribe,()=>xo(n)),Os(e,n),n}function Rf(e,t){const n=Cs(e,t);return Kf(e,n),Os(e,n),n}function rr(e,t,n){const r=Rf(e,C({result:t},n||{})),{proxyResult:o,status:s,renderInfo:c}=r;return[ge(t)?o.val:o,s,c]}function Ps(e,t,n){if(t===null)return n;if(!x(t))return null;const{sharedState:r,forAtom:o}=e,s=o?r.val:r,c={};Rn.set(i=>c[i[0]]=1);const a=j(t,s);return Rn.del(),a.includes(s)?e.key2InsKeys:c}function xs(e,t,n){const r=Ae(t),[o]=e.react.useState(()=>Ps(r,n,null));return s=>{const{insCtxMap:c,key2InsKeys:a}=r,i=Ps(r,s,a)||o||a,f={};if(Object.keys(i).forEach(u=>{(a[u]||[]).forEach(p=>f[p]=1)}),Object.keys(f).length){r.sn+=1;const u=r.sn;Object.keys(f).forEach(d=>{zn(c,Number(d),u)})}}}function Tf(e,t){ar(e);const n=Nn();return Hn(e,n,{collectType:"no",globalId:t}).renderInfo}var{ACTION:ks,MUTATE:Ls}=G;function or(e,t){ar(e);const{target:n,from:r="Mutate"}=t||{};let o=Zo();n&&(o=Ae(n));const{loadingProxy:s,loadingState:c}=et(ue,{apiCtx:e,internal:o,from:r});return{loadingProxy:s,loadingState:c,internal:o,from:r}}function Ns(e,t){const{loadingProxy:n,internal:r,from:o}=or(e,t),{proxyState:s,extra:c,renderInfo:a}=Hn(e,n);return[_e(c,s,o),r.setState,a]}function Mf(e,t){const{loadingProxy:n}=or(e,{target:t,from:Ls});return n}function bf(e,t){return Ns(e,{target:t,from:Ls})}function wf(e,t){const{loadingProxy:n}=or(e,{target:t,from:ks});return n}function If(e,t){return Ns(e,{target:t,from:ks})}function Vs(e){return e.hookImpl.useForceUpdate()}function Us(e,t){const n=(r,o)=>{let s=null;if(x(r)){const c=sn(o),a=r(c);s=cn(c),W(a)&&Object.assign(s,a)}else W(r)&&(s=C(C({},o),r));return s};return e.hookImpl.useObjectLogic(t,n,!0)}function Ff(e,t,n){const{useRef:r,useMemo:o,useEffect:s}=e.react,c=r({fn:n,wrap:null});c.current.fn=o(()=>n,[n]),c.current.wrap||(c.current.wrap=(...a)=>{c.current.fn(...a)}),s(()=>{const a=ri(),i=c.current.wrap;return a.on(t,i),()=>a.off(t,i)},[t,c])}function sr(e,t,n={}){const r=Pe(t),{insCtx:o}=wt(e,t,H(C({},n),{forAtom:r,isReactive:!0}));return[o.proxyStateVal,o.proxyState,o.renderInfo]}function Bs(e,t,n={}){const[r,o,s]=sr(e,t,n);return H(C({},s),{state:r,stateRoot:o})}function Cf(e,t,n){const r=W(n)?n:{};e.react.useEffect(()=>{const{srvRef:o}=r;x(o)&&o(t)},[])}function Of(e,t,n){const r=e.hookImpl.useStable(t);return Cf(e,r,n),r}function Pf(e){return t=>e.current=t}var{HOOK:Ys}=se;function Hs(e,t){e(()=>{var n,r;return t.mountStatus=mt,Po(t),(r=(n=t.extra).deferedWatch)==null||r.call(n),()=>{$n(t)}},[t])}function Gs(e,t){const{useRef:n,useState:r,useMemo:o,useEffect:s}=e.react,{label:c,forEffect:a,watchFn:i,watchOptions:f}=t,l=n({fn:i,wrap:null,fnKey:"",isDeferMarked:!1}),[u]=r(()=>It());if(l.current.fn=o(()=>i,[i]),!l.current.wrap){const{deps:d,immediate:p}=ps(a,f);l.current.wrap=g=>{if(u.mountStatus===mt){l.current.fn(g);return}u.extra.deferedWatch=()=>{if(l.current.isDeferMarked){l.current.fn(g);return}l.current.isDeferMarked=!0,jn(l.current.fnKey,0),l.current.fn(g),De()}};const{fnKey:m}=xt(l.current.wrap,{scopeType:Ys,fnCtxBase:u,deps:d,immediate:p,label:c});l.current.fnKey=m}Hs(s,u)}function xf(e,t,n){const{useState:r,useEffect:o}=e.react,[s]=r(()=>It());if(s.fn===O){const{manualDepKeys:c=[]}=n;xt(t,{scopeType:Ys,fnCtxBase:s,deps:()=>c.map(i=>{const{sharedKey:f,keyPath:l}=Mo(i),u=yi(f);return pe(u,l)}),isSimpleWatch:!0})}Hs(o,s)}function kf(e,t,n){Gs(e,{label:"useWatch",forEffect:!1,watchFn:t,watchOptions:n})}function Lf(e,t,n){Gs(e,{label:"useWatchEffect",forEffect:!0,watchFn:t,watchOptions:n})}function Nf(e){const{internal:t,setFactoryOpts:n}=e,{rawState:r,forAtom:o,stopDepth:s,sharedKey:c}=t,a=mn(n),i=C({},r),f=(p,m,g,y)=>{const E=We(m,g,{parentType:Io(p),parentKeyPath:y});cs(E,{internal:t,mutateCtx:a}),gr(i,E.fullKeyPath,g)},l=(p,m,g)=>Ge(p,{set:(y,E,v)=>(f(y,E,v,g),!0),get:(y,E)=>{const v=y[E];if(pt.includes(E))return Mt(m===1,o,c,E,v);const R=We(E,v,{isChanged:!1,parentKeyPath:g,op:"get",parentType:Io(y)});return m<s&&Se(v)?l(v,m+1,R.fullKeyPath):pe(i,R.fullKeyPath)}}),u=l(i,1,[]);Dt.set(u,o),Mn.set(a);const d=o?u.val:u;return{draftRoot:u,draftNode:d,finishMutate(p,m={}){fs(a,m);const g=C({state:{},mutateCtx:a},e);us(g,u,d,p)}}}function Vf(e){let t=e;if(e){e.persist&&e.persist();const{currentTarget:n}=e;n&&e.type?n.tagName==="INPUT"&&n.type==="checkbox"?t=n.checked:t=n.value:e.nativeEvent&&e.target&&(t=e.target.value)}return t}function Uf(e){let t=[];return{target:Li(e,({fullKeyPath:r})=>{t=r}),getPath:()=>t}}function js(e,t,n){return o=>{let s=Vf(o);e(c=>{const{isAtom:a,draftRoot:i}=Dt.current(),f={draft:c,draftRoot:i,path:t,isAtom:a,UNDEFINED:Ca},l=n==null?void 0:n(s,f);gr(i,t,l!==void 0?l:s)},{from:G.SYNC})}}function cr(e,t){const{sharedKey:n,innerSetState:r}=t;let o=$(e,n),s=$s.get(o);return s||(s=js(r,e),$s.set(o,s)),s}var $s=new Map;function Ws(e){const{forAtom:t,rawState:n}=e;return t?yr(n.val)?Ge(n.val,{get:(r,o)=>cr(["val",o],e)}):cr(["val"],e):Ge(n,{get:(r,o)=>cr([o],e)})}var Xs=new Map;function zs(e){const{forAtom:t,sharedKey:n,innerSetState:r,rawState:o}=e,s=Uf(o);return(c,a)=>{let i=[];if(Array.isArray(c))i=t?["val",...c]:c;else{const{target:u,getPath:d}=s;c(t?u.val:u),i=d()}let f=$(i,n);a&&(f+=`${a.toString()}`);let l=Xs.get(f);return l||(l=js(r,i,a),Xs.set(f,l)),l}}function Bf(e,t,n){const{deep:r,forAtom:o,sharedKey:s}=n,c=qu(n),a=Ht(r),i=(E={})=>{const v={internal:y,setFactoryOpts:E},{finishMutate:R,draftRoot:T,draftNode:w}=a?Wu(v):Nf(v);return{finish:(_,b={})=>{const K=y.snap;if(_===K)return K;const h=Vi(o,_,w);return R(h,b),y.snap},draftRoot:T,draftNode:w}},f=(E={})=>i(E),l=(E,v={})=>i().finish(E,v),u=(E,v)=>{const[R,T,w]=v;return Un(e,ze.current(s)),i({handleCbReturn:R,enableDep:T}).finish(E,zu(w))},y=mo(n,{sharedRoot:e,sharedState:t,setState:(E,v)=>u(E,[!0,!0,v]),setDraft:(E,v)=>u(E,[!1,!0,v]),insSetState:(E,v)=>u(E,[!0,!1,v]),insSetDraft:(E,v)=>u(E,[!1,!1,v]),setStateFactory:f,innerSetState:l,ruleConf:c,isDeep:a});return y.sync=zs(y),y.syncer=Ws(y),fi(e,y),y}function Yf(e,t){const n=Zu(e,t),{sharedRoot:r,sharedState:o}=$i(n),s=Bf(r,o,n);hi(r,n),Ci(),qn({target:r,dict:n.mutateFnDict});const{draft:c,draftRoot:a}=Bn(s,{isTop:!0});return s.reactive=c,s.reactiveRoot=a,ui(n.moduleName,s.loc),Fu(s.usefulName),ni(s),{sharedRoot:r,sharedState:o,internal:s,parsedOptions:n}}var{USER_STATE:Js}=ee,{MUTATE:Hf,ACTION:Zs}=G;function ar(e,t){Js===(t||Js)&&!Nn()&&(Wi(e,ue),Mu(e,ue))}function qs(e,t){const{createFn:n,ldAction:r,actionDict:o,actionCreator:s,internal:c,apiCtx:a,forTp:i=!1}=e;et(n,{internal:c,from:Zs,apiCtx:a});const f={},l={};return Object.keys(o).forEach(u=>{const d=o[u],p=i?d.__task:d,m=s(!1)(p,u,t);m.__fnName=u,l[u]=m;const g=(...y)=>{const E=m(...y);return of(p)?Promise.resolve(E).then(v=>v.result):E.result};g.__fnName=u,f[u]=g}),{actions:f,eActions:l,getLoading:()=>r.getLoading(f),useLoading:()=>r.useLoading(f)[0],useLoadingInfo:()=>r.useLoading(f)}}function Qs(e,t,n){const{state:r,stateRoot:o,isAtom:s}=e,c=yn(n);return x(t)?t({state:r,stateRoot:o,isAtom:s,extraBound:c}):t}function ec(e){const{common:t,ldMutate:n,mutateFnDict:r,extra:o}=e,s=Qs(t,r,o),c=tr(t.stateRoot,o)(s);return{witnessDict:c,getLoading:()=>n.getLoading(c),useLoading:()=>n.useLoading(c)[0],useLoadingInfo:()=>n.useLoading(c)}}function Gf(e){const{common:t,ldMutate:n,inital:r,mutateFnDict:o}=e,{stateRoot:s,useState:c,state:a,isAtom:i}=nc(t.apiCtx,r),f=H(C({},t),{stateRoot:s,state:a,isAtom:i,internal:B(s)}),l=ec({common:f,ldMutate:n,mutateFnDict:o,extra:t.stateRoot});return C({derivedState:s,useDerivedState:c},l)}function jf(e){const{common:t,deriveFnDict:n,throwErr:r}=e,o=Qs(t,n),{apiCtx:s,stateRoot:c}=t,a={},i={};return Object.keys(o).forEach(l=>{const u=Ks(o[l],c);a[l]=u,i[l]={runDerive:d=>Uu(u,d!=null?d:r),runDeriveTask:d=>Bu(u,d!=null?d:r),useDerived:d=>rr(s,u,d)[0],useDerivedInfo:d=>rr(s,u,d)}}),{result:new Proxy(a,{get:(l,u)=>a[u].val}),helper:i}}function $f(e,t){if(t.enableMutate=e,e){const{mutateFnDict:n}=t,r={};Object.keys(n).forEach(o=>{const s=n[o];s.enabled||(s.enabled=!0,r[o]=s)}),tr(t.sharedState)(r)}}function Wf(e){const{moduleName:t,deep:n,recordLoading:r,stopDepth:o,stopArrDep:s,alertDeadCycleErr:c,checkDeadCycle:a,enableMutate:i}=e;return{moduleName:t,deep:n,recordLoading:r,stopDepth:o,stopArrDep:s,alertDeadCycleErr:c,checkDeadCycle:a,enableMutate:i}}function ue(e,t){const{stateType:n,apiCtx:r}=e;ar(r,n);const{sharedRoot:o,sharedState:s,internal:c}=Yf(e,t),{syncer:a,sync:i,forAtom:f,setState:l,setDraft:u,sharedKey:d,sharedKeyStr:p,rootValKey:m,reactive:g,reactiveRoot:y}=c,E=Ss(o),v=E(),R={internal:c,from:Hf,apiCtx:r},T=ue,w=es(T,H(C({},R),{from:Zs})),_=es(T,R),b={createFn:T,internal:c,apiCtx:r,state:s,stateRoot:o,isAtom:f},K=H(C({},b),{ldAction:w,actionCreator:E});return{state:s,stateVal:s,stateRoot:o,setState:l,setDraft:u,setEnableMutate:h=>$f(h,c),getOptions:()=>Wf(c),setOnReadHook:h=>c.onRead=h,defineActions:h=>S=>qs(H(C({},K),{actionDict:S}),h),defineTpActions:h=>S=>qs(H(C({},K),{actionDict:S,forTp:!0}),h),defineMutateDerive:h=>S=>Gf({common:b,ldMutate:_,inital:h,mutateFnDict:S}),defineMutateSelf:()=>h=>ec({common:b,ldMutate:_,mutateFnDict:h}),defineFullDerive:h=>S=>jf({common:b,deriveFnDict:S,throwErr:h}),mutate:ws(o),runMutate:h=>Ms(o,h),runMutateTask:h=>bs(o,h),action:E,call:(h,S,D,A)=>v(h,D,A)(S),useState:h=>Is(r,o,h),useStateX:h=>Fs(r,o,h),useForceUpdate:h=>xs(r,o,h),useLocalState:h=>Us(r,h),useLocalForceUpdate:()=>Vs(r),getMutateLoading:_.getLoading,useMutateLoading:_.useLoading,getActionLoading:w.getLoading,useActionLoading:w.useLoading,getSnap:h=>ho(o,h),sync:i,syncer:a,sharedKey:d,sharedKeyStr:p,rootValKey:m,reactive:g,reactiveRoot:y,reactiveDesc:h=>Uo(o,h),useReactive:h=>sr(r,o,h),useReactiveX:h=>Bs(r,o,h),flush:h=>Un(o,h),isAtom:f}}function tc(e,t,n){const r=ue({apiCtx:e,rawState:t},n);return[r.stateRoot,r.setState,r]}function nc(e,t,n){return ue({apiCtx:e,rawState:t},n)}function Xf(e,t,n){const r=ue({apiCtx:e,rawState:t,forAtom:!0},n);return[r.stateRoot,r.setState,r]}function zf(e,t,n){return ue({apiCtx:e,rawState:t,forAtom:!0},n)}function rc(e,t){const{label:n,isSyncer:r}=t,o=Ae(e,{label:n});return(r?Ws:zs)(o)}function Jf(e){return rc(e,{label:"sync"})}function Zf(e){return rc(e,{label:"syncer",isSyncer:!0})}var qf=100,Qf=5e3;function el(e,t){return{key:e,results:[],depKeys:[],enableStatus:t,collected:!1,mounted:!1,renderAtomOnce:!1,time:0,status:{loading:!1,err:null,ok:!0}}}function tl(e,t=!1){const n=te();e&&(n.initCount+=1);const r=vi(),o=el(r,t);return ko(e).set(r,o),o}function nl(e){const t=te();e.mounted=!0,e.time=Date.now(),t.mountedCount+=1}function rl(e,t){const n=te(),r=ko(t);if(r.delete(e),t&&r.size===qf&&n.initCount-n.mountedCount>2){n.initCount=0,n.mountedCount=0;const o=Date.now();r.forEach((s,c)=>{!s.mounted&&o-s.time>Qf&&r.delete(c)})}}function ol(e,t){const n=te();n.runningKey=e.key,n.isDynamic=t}function sl(e){const t=te();t.runningKey="",t.isDynamic=!1,e.collected=!0}function cl(e,t,n){xf(e,n,{manualDepKeys:t.depKeys})}function oc(e,t,n){let r={loading:!1,err:null,ok:!0};return cl(e,t,n),t.results.forEach(o=>{const s=nr(e,{result:o,forAtom:ge(o),showLoading:t.enableStatus});s.status.ok||(r=s.status)}),r}function sc(e,t,n){e.react.useEffect(()=>(t.mounted||nl(t),()=>{rl(t.key,n)}),[t])}var al=()=>!0,ir=e=>e;function il(e){const t=[];for(let n=1;n<=e.length;n++)t.push(e.slice(0,n));return t}function ur(e,t,n,r,o){const s=t;return s.displayName=n,r?e.react.memo(s,o):s}function cc(e,t){const{sharedState:n,depKey:r,keyPath:o,compare:s,sharedKey:c,format:a=ir}=t;return ur(e,function(){const f=Hn(e,n,{arrDep:!0});f.isFirstRender&&(o.length>=2?il(o).forEach(d=>{f.recordDep({sharedKey:c,depKey:$(d,c),keyPath:d,parentKeyPath:d.slice(0,d.length-1)},Et)}):f.recordDep({sharedKey:c,depKey:r,keyPath:o}));const l=pe(f.internal.rawState,o);return a(l)},"HeluxSignal",!0,s)}function fr(e,t){return ur(e,function(){const{result:r,format:o=ir}=t,s=nr(e,{result:r,forAtom:!0});return o(s.proxyResult.val)},"HeluxDerivedAtomSignal",!0,t.compare)}function ul(e,t){return ur(e,function(){const{result:r,keyPath:o,format:s=ir}=t;return nr(e,{result:r,forAtom:!1}),s(pe(r,o))},"HeluxDerivedSignal",!0,t.compare)}function ac(e,t){const{isDynamic:n,cb:r,props:o,ref:s}=t,{collected:c,status:a}=e;c||ol(e,n);const f=r(o,{props:o,status:a,read:_c,ref:s})||"";return c||sl(e),f}function ic(e,t,n){const r=ge(n);if(t.renderAtomOnce&&!r)throw new Error("block cb once returned derived atom but not keep to return it in new render period!");if(r){t.renderAtomOnce=!0;const o=fr(e,{result:n});return e.react.createElement(o,{status:{loading:!1,err:null,ok:!0}})}return Qr(n)}function uc(e,t,n,r){const{memo:o=!0,compare:s}=r||{},{key:c}=t,{react:a}=e,i=a.forwardRef||O,f=n();let l=i(f);le()&&(f.displayName="HeluxKeyedBlockForHMR",l=i((d,p)=>(p&&Mc(p,"current")&&(t.ref=p),a.createElement(f,H(C({},d),{key:c})))));const u=o?a.memo(l,s):l;return u.displayName="HeluxBlock",u[fn]=!0,u}function fl(e,t){const{cb:n,isDynamic:r,apiCtx:o,blockCtx:s}=e,{useForceUpdate:c}=o.hookImpl,a=r?sc:O;return uc(o,s,()=>(i,f)=>{const l=s.ref||f,u=ac(s,{isDynamic:r,cb:n,props:i,ref:l}),d=c();return oc(o,s,d),a(o,s,r),ic(o,s,u)},t)}function ll(e,t){const{cb:n,isDynamic:r,apiCtx:o,blockCtx:s}=e,c=r?sc:O,{useForceUpdate:a}=o.hookImpl,{useEffect:i}=o.react;return uc(o,s,()=>(f,l)=>{const u=s.ref||l,d=ac(s,{isDynamic:r,cb:n,props:f,ref:u}),p=a(),m=oc(o,s,p);c(o,s,r);const g=s.status.loading,y=m.loading;return i(()=>{g!==y&&p()},[g,y]),s.status=m,ic(o,s,d)},t)}function fc(e,t){const n=ef(t),{enableStatus:r}=n,o=H(C({},e),{blockCtx:tl(e.isDynamic,r)});return r?ll(o,n):fl(o,n)}function dl(e,t,n){return fc({apiCtx:e,isDynamic:!1,cb:t},n)}function lc(e,t,n){return fc({apiCtx:e,isDynamic:!0,cb:t},n)}function dc(e,t,n){const{react:r}=e;if(t&&t[fn])return r.createElement(t);const o=al;if(x(t)){const d=lc(e,t,{compare:o});return r.createElement(d)}if(ge(t)){const d=fr(e,{result:t,compare:o,format:n});return r.createElement(d)}if(Pe(t)){const d=ae(t),p=Yt("val",d),g=cc(e,{sharedKey:d,sharedState:t,depKey:p,keyPath:["val"],compare:o,format:n});return r.createElement(g)}const s=ji(),{sharedKey:c,val:a,stateOrResult:i,depKey:f,keyPath:l,isDerivedResult:u}=s;if(t===a&&i){if(s.isDerivedAtom){const p=fr(e,{result:i,compare:o,format:n});return r.createElement(p)}if(u){const p=ul(e,{result:i,keyPath:l,compare:o,format:n});return r.createElement(p)}const d=cc(e,{sharedKey:c,sharedState:i,depKey:f,keyPath:l,compare:o,format:n});return r.createElement(d)}return t}var{shallowCompare:pl,isDiff:yl}=Ur,hl=tc,ml=dc,gl={EVENT_NAME:an,RECORD_LOADING:un,VER:jr,LIMU_VER:ba};function pc(e,t,n){return t(e,n)}function El(e,t){return pc(e,t)}function vl(e,t){return{build:n=>pc(e,t,n)}}var Sl=["atom","atomx","share","sharex","getMutateLoading","getActionLoading","$","signal","block","blockStatus","dynamicBlock","dynamicBlockStatus"];function Al(e){return e.startsWith("use")||Sl.includes(e)}function _l(e){return Object.assign({useSyncExternalStore:O},e)}function Dl(e,t){const n=kc(e),r=C({},n),o={react:_l(e),hookImpl:n,act:t};t&&(n.useForceUpdate=()=>{const[,a]=e.useState({});return()=>t(()=>a({}))});const s=Gr;return Object.keys(s).forEach(a=>{const i=s[a];Al(a)?r[a]=i.bind(null,o):r[a]=i}),Object.assign({model:a=>El(r,a),modelFactory:a=>vl(r,a)},r)}function Kl(e){const{inited:t,API:n}=Xa();if(t)return n;const{heluxCtxKey:r,standalone:o,transfer:s,reactLib:c,act:a}=e,i=q[r],f=(l,u)=>{const d=u||to(),p=Dl(c,a);return so({ROOT:d,inited:!0,api:p}),q[l]=d,p};if(!i)return f(r);if(o)return f(`${String(r)}_${Date.now()}`);if(s){const l=to();so({ROOT:l,inited:!0}),s(i,l)}return f(r,i)}var Rl=k(70079),Tl=k.t(Rl,2),yc=Kl({heluxCtxKey:"__HELUX__",reactLib:Tl}),Ml=yc.share,{atom:bl,atomx:wl,share:Il,sharex:Fl,derive:Cl,deriveDict:Ol,defineDeriveTask:Pl,defineDeriveFnItem:xl,runDerive:kl,runDeriveTask:Ll,watch:Nl,watchEffect:Vl,useAtom:Ul,useAtomX:Bl,useReactive:Yl,useReactiveX:Hl,useDerived:Gl,useWatch:jl,useWatchEffect:$l,useGlobalId:Wl,useService:Xl,useOnEvent:zl,useMutable:Jl,useMutateLoading:Zl,useActionLoading:ql,useEffect:Ql,useLayoutEffect:ed,useStable:td,useObject:nd,useLocalForceUpdate:rd,useGlobalForceUpdate:od,action:sd,signal:cd,block:ad,dynamicBlock:id,$:ud,mutate:fd,mutateDict:ld,runMutate:dd,runMutateTask:pd,defineMutateFnItem:yd,sync:hd,syncer:md,model:gd,modelFactory:Ed,emit:vd,on:Sd,init:Ad,reactiveDesc:_d,flush:Dd,isAtom:Kd,isSharedState:Rd,isDerivedAtom:Td,isDerivedResult:Md,storeSrv:bd,shallowCompare:wd,markRaw:Id,isDiff:Fd,produce:Cd,getMutateLoading:Od,getActionLoading:Pd,getDeriveLoading:xd,getRawState:kd,getSnap:Ld,getAtom:Nd,addMiddleware:Vd,addPlugin:Ud,cst:Bd}=yc}}]);
}());