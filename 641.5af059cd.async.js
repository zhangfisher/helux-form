(self.webpackChunkspeedform_docs=self.webpackChunkspeedform_docs||[]).push([[641],{59664:function(ce,K,p){"use strict";p.r(K),p.d(K,{$:function(){return R.$},ComputedObjects:function(){return we},ComputedScopeRef:function(){return A},OBJECT_PATH_DELIMITER:function(){return b},WatchObjects:function(){return Ve},computed:function(){return at},createAction:function(){return me},createActions:function(){return ye},createStore:function(){return ht},createUseWatch:function(){return De},createWatch:function(){return ue},getSnap:function(){return R.getSnap},getVal:function(){return V},getValueByPath:function(){return P},installComputed:function(){return We},installWatch:function(){return Me},isIncludePath:function(){return He},isSkipComputed:function(){return fe},markRaw:function(){return R.markRaw},setVal:function(){return $},skipComputed:function(){return _},watch:function(){return pt}});var q=p(39114),re=p.n(q),Ke=p(70125),Y=p.n(Ke),R=p(14102),$e=p(26851),Ue=p.n($e),Ge=p(79664),T=p.n(Ge),b="/";function P(e,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:b,n=[];try{return typeof r=="function"&&(r=r.call(e,e)),n=Array.isArray(r)?r:typeof r=="string"?r.split(a):[],n.length>0?V(e,n):e}catch(t){return e}}var le=Symbol("SKIP_COMPUTED");function _(e){return e[le]=!0,e}function fe(e){return e[le]===!0}function Ne(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log",a=typeof e=="function"?e():e instanceof Error?e.stack:e;try{var n;(n=console)[r].apply(n,["[@speedform/reactive] "].concat(T()(Array.isArray(a)?a:[a])))}catch(t){}}function pe(e,r){if(!Array.isArray(e))throw new Error("path must be an array");return r==="self"?e:r==="root"?[]:r==="parent"?e.slice(0,-2):r==="current"?e.slice(0,-1):typeof r=="string"?r.startsWith("./")?[].concat(T()(e.slice(0,-1)),T()(r.slice(2).split(b))):r.startsWith("../")?pe(e.slice(0,-1),r.slice(3)):(r.includes(".")&&(console.warn('[@speedform/reactive] The dependency path uses "/" as the separator, and will automatically convert'),r=r.replaceAll(".","/")),[].concat(T()(e.slice(0,-1)),T()(r.split(b)))):Array.isArray(r)?r:e}function de(e){return e.map(function(r){return Array.isArray(r)?r.join("."):r}).join("_")}function Le(e){return e instanceof Error?e:new Error(e)}function Fe(e,r){return(e||[]).map(function(a){return Array.isArray(a)?a:typeof a=="string"?a.startsWith("./")||a.startsWith("../")?a:a.includes(b)?a.split(b):a.split("."):[]})}function Be(e,r,a){return e.map(function(n){return V(r,pe(a,n))})}function He(e,r){return e.length>r.length?!1:e.every(function(a,n){return a===r[n]})}function ve(e){return toString.call(e)==="[object Map]"}function he(e,r){var a=e.get(r);if(a!==void 0)return a;var n=e.get(Number(r)||r);if(n!==void 0)return n}function V(e,r){if(r.length===0)return e;var a,n=e;return r.forEach(function(t){a=ve(n)?he(n,t):n[t],n=a}),a}function $(e,r,a){var n=e,t=r.length-1;r.forEach(function(u,i){var s=ve(n);if(i===t){s?n.set(u,a):n[u]=a;return}var c=s?he(n,u):n[u];n=c})}function Je(e){return typeof e=="function"&&e.then&&typeof e.then=="function"||e&&e instanceof Promise}function yt(e){return _typeof(e)=="object"&&["result","loading","timeout","retry","run"].every(function(r){return e.hasOwnProperty(r)})}function mt(e){return _typeof(e)=="object"&&e.hasOwnProperty("__COMPUTED__")&&["async","sync"].includes(e.__COMPUTED__)&&e.hasOwnProperty("fn")&&typeof e.fn=="function"&&e.hasOwnProperty("options")&&_typeof(e.options)=="object"}function ye(e,r,a,n){return Object.entries(e||{}).reduce(function(t,u){var i=Y()(u,2),s=i[0],c=i[1];return t[s]=me(c,r.setState,a),t},{})}function me(e,r,a){var n=function(u){typeof u=="function"&&r(function(i){u(i)})};return function(){var t=e.apply(void 0,arguments);if(Je(t))return t.then(function(u){n(u)});n(t)}}var ze=p(71698),ee=p.n(ze),Ye=p(77937),ge=p.n(Ye),Qe=p(41176),Ce=p.n(Qe),Xe=p(65523),Oe=p.n(Xe),Ze=p(7122),be=p.n(Ze),qe=p(19108),Ae=p.n(qe),_e=p(90393),M=p.n(_e),et=p(7392),te=p.n(et),je=p(96820),tt=p(71660),nt=p(45727);function rt(e,r,a){var n=r==null?a:r;if(typeof n=="function")try{n=n.call(e,e)}catch(t){}return n==null?a==null?A.Root:a:n}function Te(e,r){var a=r.input,n=r.type,t=r.valuePath,u=r.funcOptions,i=r.storeOptions,s=r.computedType,c=e;if(typeof i.onComputedContext=="function"){var l=i.onComputedContext.call(e,e,{computedType:s,contextType:n,valuePath:t});l!==void 0&&(c=l)}var o=t.length>=1?t.slice(0,t.length-1):[],f=rt(e,n=="context"?u.context:u.scope,n=="context"?i.computedThis&&i.computedThis(s):i.computedScope&&i.computedScope(s));try{if(f===A.Current)return P(e,o);if(f===A.Parent)return P(e,t.slice(0,t.length-2));if(f===A.Root)return c;if(f===A.Depends)return Array.isArray(a)?a.map(function(C){return typeof C=="function"?C():C}):[];if(typeof f=="string")return P(e,[].concat(T()(o),T()(f.split(b))));if(Array.isArray(f))if(f.length>0&&f[0].startsWith("@")){var d=P(e,[].concat(T()(f[0].substring(1).split(b)),T()(f.slice(1))));return P(e,d)}else return P(e,f);else if(typeof f=="number"){var y=f>t.length-2?t.length-f-1:0;return P(e,t.slice(0,y))}else return e}catch(C){return e}}function ne(e,r){var a=r.input,n=r.type,t=r.computedContext,u=r.computedOptions,i=r.storeOptions;return Te(e,{input:a,type:n,valuePath:t.fullKeyPath,funcOptions:u,storeOptions:i,computedType:"Computed"})}function at(e,r,a){if(typeof e!="function")throw new Error("computed getter must be a function");var n=[],t={async:!1,enable:!0,timeout:0,depends:[],toComputedResult:A.Self,immediate:!0};if(arguments.length==1)n=[];else if(arguments.length==2)if(Array.isArray(arguments[1]))n=arguments[1];else if(Ue()(arguments[1])=="object")Object.assign(t,arguments[1]);else throw new Error("invalid arguments");else arguments.length>=3&&(n=arguments[1],Object.assign(t,arguments[2]));var u=t.async===!0||(0,je.$)(e)||arguments.length>=2&&Array.isArray(r);t.async=u,t.depends=n;var i=function(){return{fn:e,options:t}};return i.__COMPUTED__=u?"async":"sync",i}function gt(e,r,a){var n=r==null?a:r;if(typeof n=="function")try{n=n.call(e,e)}catch(t){}return n==null?a==null?ComputedScopeRef.Root:a:n}function Se(e,r){var a="";return typeof r=="function"?a=r(e):typeof r=="string"?a=r:a=de(e),a}function Re(e,r,a,n){var t=r.fullKeyPath,u=r.parent,i=r.value,s=n.onCreateComputed,c=i(),l=c.fn,o=c.options;if(!(u&&!Object.hasOwn(u,t[t.length-1]))){if(typeof s=="function"&&typeof l=="function"){var f=s.call(e,t,l,o);o.scope||(o.scope=A.Current),o.context||(o.context=A.Root),typeof f=="function"&&(l=f)}var d=t.join(b);n.log("Create sync computed: ".concat(d));var y=Se(t,o.id),C=e.mutate({fn:function(O,D){if(!o.enable){n.log("Async computed <".concat(d,"> is disabled"),"warn");return}n.log("Run sync computed for : ".concat(d));var E=D.input,v=ne(O,{input:E,computedOptions:o,computedContext:r,storeOptions:n,type:"context"}),U=ne(O,{input:E,computedOptions:o,computedContext:r,storeOptions:n,type:"scope"}),W=o.initial;try{W=l.call(v,U)}catch(I){if(typeof o.onError=="function")try{var S;(S=o.onError)===null||S===void 0||S.call(v,I)}catch(z){}}$(O,t,W)},desc:y,checkDeadCycle:!1});r.replaceValue(V(e.state,t)),a.set(d,{mutate:C,group:o.group,async:!1,options:o,run:function(O){return e.runMutateTask({desc:y,extraArgs:O})}})}}function xe(e,r,a){return Object.assign({loading:!1,timeout:0,retry:0,error:null,progress:0,run:(0,R.markRaw)(_(function(n){return e.runMutateTask({desc:r,extraArgs:n})})),cancel:(0,R.markRaw)(_(function(){console.log("cancel")}))},a)}function ut(e,r,a,n,t){var u=xe(e,n,t),i=V(r,a);Object.assign(i,u,t)}function it(e,r,a){var n=Object.assign({},a),t=n.max,u=t===void 0?100:t,i=n.min,s=i===void 0?0:i,c=n.value,l=c===void 0?0:c;return e(function(o){return $(o,[].concat(T()(r),["progress"]),l)}),{value:function(f){f>u&&(f=u),f<s&&(f=s),e(function(d){return $(d,[].concat(T()(r),["progress"]),f)})},end:function(){this.value(u)}}}function Q(e,r,a){e(function(n){Object.entries(a).forEach(function(t){var u=Y()(t,2),i=u[0],s=u[1];$(n,[].concat(T()(r),[i]),s)})})}function ot(e,r,a){return ae.apply(this,arguments)}function ae(){return ae=te()(M()().mark(function e(r,a,n){var t,u,i,s,c,l,o,f,d,y,C,j,O,D,E,v,U,W,S,I,z,N,m;return M()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:t=n.input,u=n.computedOptions,i=n.computedContext,s=n.storeOptions,c=n.computedResultPath,l=n.setState,o=ne(r,{input:t,computedOptions:u,computedContext:i,storeOptions:s,type:"context"}),f=ne(r,{input:t,computedOptions:u,computedContext:i,storeOptions:s,type:"scope"}),d=i.fullKeyPath,y=u.timeout,C=y===void 0?0:y,j=u.retry,O=j===void 0?[0,0]:j,D=Array.isArray(O)?O:[Number(O),0],E=Y()(D,2),v=E[0],U=E[1],S=new AbortController,I={onTimeout:function(w){return W=w},getProgressbar:function(w){return it(l,d,w)},getSnap:function(w){return(0,R.getSnap)(w,!1)},abortSignal:S.signal,cancel:S.abort},z=!1,Q(l,c,{cancel:(0,R.markRaw)(_(function(){return S.abort()}))}),S.signal.addEventListener("abort",function(){z=!0}),N=M()().mark(function L(){var w,F,k,G,Ie,h,Pe,ie,oe,Z,se,B,ke;return M()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(k=!1,G=!1,Ie=m>0,h={},g.prev=2,Pe=Array.isArray(C)?C:[C,0],ie=Y()(Pe,2),oe=ie[0],Z=oe===void 0?0:oe,se=ie[1],B=se===void 0?0:se,Q(l,c,{loading:!0,error:null,retry:m>0?v-m:0,timeout:B>1?B:Z,progress:0}),!z){g.next=7;break}throw new Error("Aborted");case 7:return Z>0&&(w=setTimeout(function(){G=!0,typeof W=="function"&&W(),k||(clearInterval(F),Q(l,c,{loading:!1,error:"TIMEOUT",timeout:0}))},Z),B>1&&(F=setInterval(function(){Q(l,c,{timeout:B--}),B===0&&clearInterval(F)},Z/B))),g.next=10,a.call(o,f,I);case 10:ke=g.sent,G||Object.assign(h,{result:ke,error:null,timeout:0}),g.next=20;break;case 14:if(g.prev=14,g.t0=g.catch(2),k=!0,typeof u.onError=="function")try{u.onError.call(o,g.t0)}catch(Ot){}G||Object.assign(h,{error:Le(g.t0).message,timeout:0}),v>0&&Object.assign(h,{retry:v-m});case 20:return g.prev=20,clearTimeout(w),clearInterval(F),(!k||m==v)&&Object.assign(h,{loading:!1}),!k&&!G&&Object.assign(h,{error:null}),Q(l,c,h),g.finish(20);case 27:if(!k){g.next=31;break}if(!(v>0&&U>0&&m<v)){g.next=31;break}return g.next=31,(0,nt.g)(U);case 31:case"end":return g.stop()}},L,null,[[2,14,20,27]])}),m=0;case 13:if(!(m<v+1)){x.next=18;break}return x.delegateYield(N(),"t0",15);case 15:m++,x.next=13;break;case 18:case"end":return x.stop()}},e)})),ae.apply(this,arguments)}function Ee(e,r,a,n){var t=r.fullKeyPath,u=r.parent,i=r.value,s=n.onCreateComputed;if(!(u&&!Object.hasOwn(u,t[t.length-1]))){var c=i(),l=c.fn,o=c.options;if(o.async=!0,typeof s=="function"&&typeof l=="function"){var f=s.call(e,t,l,o);o.scope||(o.scope=A.Current),o.context||(o.context=A.Root),typeof f=="function"&&(l=f)}var d=o.depends,y=o.initial,C=o.toComputedResult,j=C===void 0?"self":C,O=o.immediate,D=o.noReentry,E=D===void 0?!1:D,v=!1,U=(0,tt.d)(j,{self:t,root:[],parent:t.slice(0,t.length-2),current:t.slice(0,t.length-1),Array:j,String:[].concat(T()(t.slice(0,t.length-1)),[String(j).split(b)])},{defaultValue:t}),W=Fe(d);W.length==0&&n.log("async computed <".concat(t.join("."),"> should specify depends"),"warn");var S=Se(t,o.id),I=t.join(b);n.log("Create async computed: ".concat(I," (depends=").concat(W.length==0?"None":de(W),")"));var z=e.mutate({deps:function(m){return Be(W,m,t)},fn:function(m,X){if(X.isFirstCall)if(j=="self")$(m,t,xe(e,S,{result:y}));else{ut(e,m,U,S,{result:y});var x=V(m,t.slice(0,t.length-1));delete x[t[t.length-1]]}},task:function(){var N=te()(M()().mark(function X(x){var L,w,F,k,G;return M()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(L=x.draft,w=x.setState,F=x.input,k=x.extraArgs,o.enable){h.next=4;break}return n.log("Async computed <".concat(I,"> is disabled"),"warn"),h.abrupt("return");case 4:if(n.log("Run async computed for : ".concat(I)),G=Object.assign({},o,k),!(E&&v&&n.debug)){h.next=9;break}return n.log("Reentry async computed: ".concat(I),"warn"),h.abrupt("return");case 9:return v=!0,h.prev=10,h.next=13,ot(L,l,{input:F,computedResultPath:U,computedOptions:G,computedContext:r,storeOptions:n,setState:w});case 13:return h.abrupt("return",h.sent);case 14:return h.prev=14,v=!1,h.finish(14);case 17:case"end":return h.stop()}},X,null,[[10,,14,17]])}));function m(X){return N.apply(this,arguments)}return m}(),immediate:O,desc:S,checkDeadCycle:!1});r.replaceValue(V(e.state,t)),a.set(I,{mutate:z,group:o.group,async:!0,options:o,run:function(m){return e.runMutateTask({desc:S,extraArgs:m})}})}}function We(e){var r=e.stateCtx,a=e.params,n=e.storeOptions,t=e.extendObjects,u=a.value;u.__COMPUTED__=="async"?Ee(r,a,t.computedObjects,n):u.__COMPUTED__=="sync"?Re(r,a,t.computedObjects,n):(0,je.$)(u)?(a.value=function(){return{fn:u,options:{depends:[],initial:void 0,immediate:!0,enable:!0,context:n.computedThis&&n.computedThis("Computed")}}},Ee(r,a,t.computedObjects,n)):(a.value=function(){return{fn:u,options:{initial:void 0,enable:!0,context:n.computedThis&&n.computedThis("Computed")}}},Re(r,a,t.computedObjects,n))}var we=function(e){Oe()(a,e);var r=be()(a);function a(){return ge()(this,a),r.apply(this,arguments)}return Ce()(a,[{key:"runGroup",value:function(){var n=te()(M()().mark(function u(i){return M()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Promise.all(T()(this.values()).filter(function(l){return l.group==i}).map(function(l){return l.async?l.mutate.runTask():l.mutate.run()})));case 1:case"end":return c.stop()}},u,this)}));function t(u){return n.apply(this,arguments)}return t}()},{key:"enableGroup",value:function(){var n=te()(M()().mark(function u(i){var s,c,l;return M()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:s=ee()(this.values());try{for(s.s();!(c=s.n()).done;)l=c.value,l.enable=i}catch(d){s.e(d)}finally{s.f()}case 2:case"end":return f.stop()}},u,this)}));function t(u){return n.apply(this,arguments)}return t}()}]),a}(Ae()(Map)),st=p(20458),ct=p(44114),H=p.n(ct),lt=p(79862),J=p.n(lt),ft=p(70079);function pt(e,r,a){var n=Object.assign({on:r,enable:!0,scope:A.Depends},a),t=function(){return{fn:e,options:n}};return t.__COMPUTED__="watch",t}var Ve=function(e){Oe()(a,e);var r=be()(a);function a(n){var t;return ge()(this,a),t=r.call(this),J()(H()(t),"_off",void 0),J()(H()(t),"_ctx",void 0),J()(H()(t),"_storeOptions",void 0),J()(H()(t),"_enable",!0),J()(H()(t),"cache",new Map),J()(H()(t),"watcherCache",void 0),t._storeOptions=n,t}return Ce()(a,[{key:"bind",value:function(t){this._ctx||(this._ctx=t,this.createWacher())}},{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"getValueKey",value:function(t){return JSON.stringify(t)}},{key:"createWacher",value:function(){var t=this,u=(0,R.watch)(function(s){var c=s.triggerReasons;if(t._enable){var l=c.map(function(o){return o.keyPath});l.forEach(function(o){var f=t.getCachedWatchers(o),d=V(t._ctx.state,o);if(f.length===0){var y=ee()(t.values()),C;try{for(y.s();!(C=y.n()).done;){var j=C.value;t.isMatchWatcher(o,d,j)&&(t.addWatcherToCache(o,j.path,j),f.push(j))}}catch(v){y.e(v)}finally{y.f()}}var O=ee()(f),D;try{for(O.s();!(D=O.n()).done;){var E=D.value;try{E.run(o)}catch(v){console.warn("Error while run watchLisenter("+o.join(b)+"->"+E.path.join(b)+")",v.stack)}}}catch(v){O.e(v)}finally{O.f()}})}},function(){return[t._ctx.state]}),i=u.unwatch;this._off=i}},{key:"reset",value:function(){var t;this.cache.clear(),this._off&&this._off(),(t=this.watcherCache)===null||t===void 0||t.clear(),this.createWacher()}},{key:"getCachedWatchers",value:function(t){var u=this.getValueKey(t);return this.cache.has(u)?this.cache.get(u):[]}},{key:"addWatcherToCache",value:function(t,u,i){var s=this.getValueKey(t);this.cache.has(s)||this.cache.set(s,[]);var c=this.cache.get(s);c.push(i)}},{key:"getWatcherCache",value:function(t){this.watcherCache||(this.watcherCache=new Map);var u=t.join(".");return this.watcherCache.has(u)||this.watcherCache.set(u,{}),this.watcherCache.get(u)}},{key:"isMatchWatcher",value:function(t,u,i){if(!(this._enable===!1||i.enable===!1)&&typeof i.on=="function")return i.on(t,u)}},{key:"executeListener",value:function(t,u,i,s){var c=this;if(!s.enable){this._storeOptions.log("watcher <".concat(u.join(b),"> is disabled"));return}var l={getSelfValue:function(){return V((0,R.getSnap)(c._ctx.state),u)},getCache:function(){return c.getWatcherCache(u)},triggerPath:t,selfPath:u,state:this._ctx.state},o=Te(this._ctx.state,{computedType:"Watch",input:[function(){return V(c._ctx.state,t)}],type:"scope",valuePath:u,funcOptions:{scope:s.scope},storeOptions:this._storeOptions}),f=s.scope==A.Depends&&Array.isArray(o)?o[0]:o,d=i.call(this._ctx.state,f,l);d!==void 0&&this._ctx.setState(function(y){$(y,u,d)})}},{key:"add",value:function(t,u,i){var s=this,c=re()({path:t,listener:u},i);c.run=function(l){return s.executeListener(l,t,u,c)},this.set(this.getValueKey(t),c)}},{key:"remove",value:function(t){this.delete(this.getValueKey(t))}},{key:"enableGroup",value:function(t){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=ee()(this.values()),s;try{for(i.s();!(s=i.n()).done;){var c=s.value;c.group==t&&(c.enable=u)}}catch(l){i.e(l)}finally{i.f()}}}]),a}(Ae()(Map));function Me(e){var r=e.stateCtx,a=e.params,n=e.storeOptions,t=e.extendObjects,u=t.watchObjects;u==null||u.bind(r),n.log("install watch for <".concat(a.fullKeyPath.join(b),">"));var i=a.value();u.add(a.fullKeyPath,i.fn,i.options),a.replaceValue(i.options.initial),r.setState(function(s){$(s,a.fullKeyPath,i.options.initial)}),(0,R.flush)(r.state)}function ue(e,r){return function(a,n){var t=(0,R.watch)(function(i){var s=i.triggerReasons,c=s.map(function(l){return l.keyPath});a(c)},function(){return n==null?void 0:n.map(function(i){return P(e.state,i)})}),u=t.unwatch;return u}}function De(e,r){return function(a,n){(0,ft.useEffect)(function(){return ue(e,r)(a,n)},[])}}function dt(e,r,a,n){var t=e.fullKeyPath,u=e.value,i=t.join(".");if(typeof u=="function"&&!a._replacedKey[i]&&!fe(u)){a._replacedKey[i]=!0;var s={stateCtx:r,extendObjects:a,storeOptions:n,params:e};u.__COMPUTED__=="watch"?Me(s):We(s)}}var A=function(e){return e.Root="root",e.Current="current",e.Parent="parent",e.Depends="depends",e.Self="self",e}({});function vt(e){return function(r,a){var n=e.useState;if(r==null)return n();var t=n(),u=Y()(t,2),i=u[0],s=u[1],c=r(i),l=s;return typeof a=="function"&&(l=function(f){s(function(d){a.call(d,d,f)})}),[c,l]}}function ht(e,r){var a=Object.assign({id:Math.random().toString(16).substring(2),debug:!0,computedThis:function(){return A.Root},computedScope:function(){return A.Current},singleton:!1},r);a.log=function(){a.debug&&Ne.apply(void 0,arguments)};var n=a.singleton?e:(0,st.I)(e),t={computedObjects:new we,watchObjects:new Ve(a),_replacedKey:{}};return(0,R.model)(function(u){var i=u.sharex(n.state,{stopArrDep:!1,moduleName:a.id,onRead:function(o){dt(o,i,t,a)}}),s=ye(n.actions,i,u,a),c=vt(i);return re()(re()({actions:s},i),{},{state:i.reactive,useState:c,watch:ue(i,a),useWatch:De(i,a),flush:function(){return(0,R.flush)(i.state)}},t)})}},2109:function(ce){function K(p){var q=new Error("Cannot find module '"+p+"'");throw q.code="MODULE_NOT_FOUND",q}K.keys=function(){return[]},K.resolve=K,K.id=2109,ce.exports=K}}]);
