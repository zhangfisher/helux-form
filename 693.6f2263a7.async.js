(self.webpackChunkspeedform_docs=self.webpackChunkspeedform_docs||[]).push([[693],{40058:function(oe,$,p){"use strict";p.r($),p.d($,{$:function(){return S.$},ComputedScopeRef:function(){return R},OBJECT_PATH_DELIMITER:function(){return g},computed:function(){return Je},createAction:function(){return le},createActions:function(){return ce},createAsyncAction:function(){return fe},createStore:function(){return nt},getSnap:function(){return S.getSnap},getVal:function(){return v.Jy},getValueByPath:function(){return D},installComputed:function(){return Oe},installWatch:function(){return be},isIncludePath:function(){return Ve},isSkipComputed:function(){return de},markRaw:function(){return S.markRaw},setVal:function(){return v.Y6},skipComputed:function(){return _},watch:function(){return Ze}});var Z=p(39114),se=p.n(Z),we=p(70125),J=p.n(we),S=p(14102),Re=p(90393),k=p.n(Re),xe=p(79664),h=p.n(xe),Ee=p(7392),q=p.n(Ee),te=p(96820);function ce(e,t,n,r){return Object.entries(e||{}).reduce(function(a,i){var u=J()(i,2),c=u[0],s=u[1];return(0,te.$)(s)?a[c]=fe(s,t.state,n):a[c]=le(s,t.state,n),a},{})}function le(e,t,n){return n.action(t)()(function(){var r=q()(k()().mark(function a(i){var u,c,s;return k()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:u=i.payload,c=i.draft,s=e.apply(void 0,h()(u)),s instanceof Function&&s(c);case 3:case"end":return o.stop()}},a)}));return function(a){return r.apply(this,arguments)}}())}function fe(e,t,n){return n.action(t)()(function(){var r=q()(k()().mark(function a(i){var u,c,s;return k()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return u=i.setState,c=i.payload,o.next=3,e.apply(void 0,h()(c));case 3:s=o.sent,s instanceof Function&&u(s);case 5:case"end":return o.stop()}},a)}));return function(a){return r.apply(this,arguments)}}())}var ke=p(20458),v=p(51703),g="/";function D(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g,r=[];try{return typeof t=="function"&&(t=t.call(e,e)),r=Array.isArray(t)?t:typeof t=="string"?t.split(n):[],r.length>0?(0,v.Jy)(e,r):e}catch(a){return e}}var pe=Symbol("SKIP_COMPUTED");function _(e){return e[pe]=!0,e}function de(e){return e[pe]===!0}function Te(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log",n=typeof e=="function"?e():e instanceof Error?e.stack:e;try{var r;(r=console)[t].apply(r,["[@speedform/reactive] "].concat(h()(Array.isArray(n)?n:[n])))}catch(a){}}function ve(e,t){if(!Array.isArray(e))throw new Error("path must be an array");return t==="self"?e:t==="root"?[]:t==="parent"?e.slice(0,-2):t==="current"?e.slice(0,-1):typeof t=="string"?t.startsWith("./")?[].concat(h()(e.slice(0,-1)),h()(t.slice(2).split(g))):t.startsWith("../")?ve(e.slice(0,-1),t.slice(3)):(t.includes(".")&&(console.warn('[@speedform/reactive] The dependency path uses "/" as the separator, and will automatically convert'),t=t.replaceAll(".","/")),[].concat(h()(e.slice(0,-1)),h()(t.split(g)))):Array.isArray(t)?t:e}function ye(e){return e.map(function(t){return Array.isArray(t)?t.join("."):t}).join("_")}function De(e){return e instanceof Error?e:new Error(e)}function Ke(e,t){return(e||[]).map(function(n){return Array.isArray(n)?n:typeof n=="string"?n.startsWith("./")||n.startsWith("../")?n:n.includes(g)?n.split(g):n.split("."):[]})}function Ie(e,t,n){return e.map(function(r){return(0,v.Jy)(t,ve(n,r))})}function Ve(e,t){return e.length>t.length?!1:e.every(function(n,r){return n===t[r]})}var $e=p(26851),Me=p.n($e),We=p(71660),Le=p(45727);function ee(e,t){var n=t.input,r=t.type,a=t.computedContext,i=t.computedOptions,u=t.storeOptions,c=e;if(typeof u.onComputedContext=="function"){var s=u.onComputedContext.call(e,e,{type:r,valuePath:a.fullKeyPath});s!==void 0&&(c=s)}var f=a.keyPath,o=a.fullKeyPath,l=Pe(e,r=="context"?i.context:i.scope,r=="context"?u.computedThis:u.computedScope);try{if(l===R.Current)return D(e,f);if(l===R.Parent)return D(e,o.slice(0,o.length-2));if(l===R.Root)return c;if(l===R.Depends)return Array.isArray(n)?n:[];if(typeof l=="string")return D(e,[].concat(h()(f),h()(l.split(g))));if(Array.isArray(l))if(l.length>0&&l[0].startsWith("@")){var d=D(e,[].concat(h()(l[0].substring(1).split(g)),h()(l.slice(1))));return D(e,d)}else return D(e,l);else if(typeof l=="number"){var m=l>o.length-2?o.length-l-1:0;return D(e,o.slice(0,m))}else return e}catch(b){return e}}function Je(e,t,n){var r;if(typeof e!="function")throw new Error("getter must be a function");var a=[],i={async:!1,timeout:0,depends:[],toComputedResult:R.Self,immediate:!0};if(arguments.length==1)a=[];else if(arguments.length==2)if(Array.isArray(arguments[1]))a=arguments[1];else if(Me()(arguments[1])=="object")Object.assign(i,arguments[1]);else throw new Error("invalid arguments");else arguments.length>=3&&(a=arguments[1],Object.assign(i,arguments[2]));var u=i.async===!0||(0,te.$)(e)||arguments.length>=2&&Array.isArray(t);i.async=u,i.depends=a,u&&((r=i.depends)===null||r===void 0?void 0:r.length)==0&&console.warn("async computed function should specify depends");var c=function(){return{fn:e,options:i}};return c.__COMPUTED__=u?"async":"sync",c}function Pe(e,t,n){var r=t==null?n:t;if(typeof r=="function")try{r=r.call(e,e)}catch(a){}return r==null?n==null?R.Root:n:r}function he(e,t){var n="";return typeof t=="function"?n=t(e):typeof t=="string"?n=t:n=ye(e),n}function ge(e,t,n,r){var a=t.fullKeyPath,i=t.parent,u=t.value,c=r.onCreateComputed,s=u(),f=s.fn,o=s.options;if(!(i&&!Object.hasOwn(i,a[a.length-1]))){if(typeof c=="function"&&typeof f=="function"){var l=c.call(e,a,f,o);typeof l=="function"&&(f=l)}r.log("Create sync computed: ".concat(a.join(g)));var d=he(a,o.id),m=e.mutate({fn:function(w,M){r.log("Run sync mutate for : ".concat(a.join(g)));var W=M.input,L=ee(w,{input:W,computedOptions:o,computedContext:t,storeOptions:r,type:"context"}),C=ee(w,{input:W,computedOptions:o,computedContext:t,storeOptions:r,type:"scope"}),K=o.initial;try{K=f.call(L,C)}catch(A){if(typeof o.onError=="function")try{var x;(x=o.onError)===null||x===void 0||x.call(L,A)}catch(G){}}(0,v.Y6)(w,a,K)},desc:d,checkDeadCycle:!1});return t.replaceValue((0,v.Jy)(m.snap,a)),n[d]}}function me(e,t,n){return Object.assign({value:void 0,loading:!1,timeout:0,retry:0,error:null,progress:0,run:(0,S.markRaw)(_(function(r){return e.runMutateTask({desc:t,extraArgs:r})})),cancel:(0,S.markRaw)(_(function(){console.log("cancel")}))},n)}function Ue(e,t,n,r,a){var i=me(e,r,a),u=(0,v.Jy)(t,n);Object.assign(u,i,a)}function Fe(e,t,n){var r=Object.assign({},n),a=r.max,i=a===void 0?100:a,u=r.min,c=u===void 0?0:u,s=r.value,f=s===void 0?0:s;return e(function(o){return(0,v.Y6)(o,[].concat(h()(t),["progress"]),f)}),{value:function(l){l>i&&(l=i),l<c&&(l=c),e(function(d){return(0,v.Y6)(d,[].concat(h()(t),["progress"]),l)})},end:function(){this.value(i)}}}function Q(e,t,n){e(function(r){Object.entries(n).forEach(function(a){var i=J()(a,2),u=i[0],c=i[1];(0,v.Y6)(r,[].concat(h()(t),[u]),c)})})}function Ye(e,t,n){return ne.apply(this,arguments)}function ne(){return ne=q()(k()().mark(function e(t,n,r){var a,i,u,c,s,f,o,l,d,m,b,w,M,W,L,C,K,x,A,G,P,T,O;return k()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:a=r.input,i=r.computedOptions,u=r.computedContext,c=r.storeOptions,s=r.computedResultPath,f=r.setState,o=ee(t,{input:a,computedOptions:i,computedContext:u,storeOptions:c,type:"context"}),l=ee(t,{input:a,computedOptions:i,computedContext:u,storeOptions:c,type:"scope"}),d=u.fullKeyPath,m=i.timeout,b=m===void 0?0:m,w=i.retry,M=w===void 0?[0,0]:w,W=Array.isArray(M)?M:[Number(M),0],L=J()(W,2),C=L[0],K=L[1],A=new AbortController,G={onTimeout:function(E){return x=E},getProgressbar:function(E){return Fe(f,d,E)},getSnap:function(E){return(0,S.getSnap)(E,!1)},abortSignal:A.signal,cancel:A.abort},P=!1,Q(f,s,{cancel:(0,S.markRaw)(_(function(){return A.abort()}))}),A.signal.addEventListener("abort",function(){P=!0}),T=k()().mark(function F(){var E,Y,V,z,j,N,je,ae,ie,X,ue,B,Se;return k()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(V=!1,z=!1,j=O>0,N={},y.prev=2,je=Array.isArray(b)?b:[b,0],ae=J()(je,2),ie=ae[0],X=ie===void 0?0:ie,ue=ae[1],B=ue===void 0?0:ue,Q(f,s,{loading:!0,error:null,retry:O>0?C-O:0,timeout:B>1?B:X,progress:0}),!P){y.next=7;break}throw new Error("Aborted");case 7:return X>0&&(E=setTimeout(function(){z=!0,typeof x=="function"&&x(),V||(clearInterval(Y),Q(f,s,{loading:!1,error:"TIMEOUT",timeout:0}))},X),B>1&&(Y=setInterval(function(){Q(f,s,{timeout:B--}),B===0&&clearInterval(Y)},X/B))),y.next=10,n.call(o,l,G);case 10:Se=y.sent,z||Object.assign(N,{result:Se,error:null,timeout:0}),y.next=20;break;case 14:if(y.prev=14,y.t0=y.catch(2),V=!0,typeof i.onError=="function")try{i.onError.call(o,y.t0)}catch(at){}z||Object.assign(N,{error:De(y.t0).message,timeout:0}),C>0&&Object.assign(N,{retry:C-O});case 20:return y.prev=20,clearTimeout(E),clearInterval(Y),(!V||O==C)&&Object.assign(N,{loading:!1}),!V&&!z&&Object.assign(N,{error:null}),Q(f,s,N),y.finish(20);case 27:if(!V){y.next=31;break}if(!(C>0&&K>0&&O<C)){y.next=31;break}return y.next=31,(0,Le.g)(K);case 31:case"end":return y.stop()}},F,null,[[2,14,20,27]])}),O=0;case 13:if(!(O<C+1)){I.next=18;break}return I.delegateYield(T(),"t0",15);case 15:O++,I.next=13;break;case 18:case"end":return I.stop()}},e)})),ne.apply(this,arguments)}function Ce(e,t,n,r){var a=t.fullKeyPath,i=t.parent,u=t.value,c=r.onCreateComputed;if(!(i&&!Object.hasOwn(i,a[a.length-1]))){var s=u(),f=s.fn,o=s.options;if(o.async=!0,typeof c=="function"&&typeof f=="function"){var l=c.call(e,a,f,o);o.scope||(o.scope=R.Current),o.context||(o.context=R.Root),typeof l=="function"&&(f=l)}var d=o.depends,m=o.initial,b=o.toComputedResult,w=b===void 0?"self":b,M=o.immediate,W=o.noReentry,L=W===void 0?!1:W,C=!1,K=(0,We.d)(w,{self:a,root:[],parent:a.slice(0,a.length-2),current:a.slice(0,a.length-1),Array:w,String:[].concat(h()(a.slice(0,a.length-1)),[String(w).split(g)])},{defaultValue:a}),x=Ke(d),A=he(a,o.id);r.log("Create async computed: ".concat(a.join(g)," (depends=").concat(x.length==0?"None":ye(x),")"));var G=e.mutate({deps:function(T){return Ie(x,T,a)},fn:function(T,O){if(O.isFirstCall)if(w=="self")(0,v.Y6)(T,a,me(e,A,{result:m}));else{Ue(e,T,K,A,{result:m});var U=(0,v.Jy)(T,a.slice(0,a.length-1));delete U[a[a.length-1]]}},task:function(){var P=q()(k()().mark(function O(U){var I,F,E,Y,V;return k()().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(I=U.draft,F=U.setState,E=U.input,Y=U.extraArgs,r.log("Run async mutate for : ".concat(a.join(g))),V=Object.assign({},o,Y),!(L&&C&&r.debug)){j.next=6;break}return r.log("Reentry async computed: ".concat(a.join(g)),"warn"),j.abrupt("return");case 6:return C=!0,j.prev=7,j.next=10,Ye(I,f,{input:E,computedResultPath:K,computedOptions:V,computedContext:t,storeOptions:r,setState:F});case 10:return j.abrupt("return",j.sent);case 11:return j.prev=11,C=!1,j.finish(11);case 14:case"end":return j.stop()}},O,null,[[7,,11,14]])}));function T(O){return P.apply(this,arguments)}return T}(),immediate:M,desc:A,checkDeadCycle:!1});return t.replaceValue((0,v.Jy)(G.snap,a)),n[A]=G,n[A]}}function Oe(e){var t=e.stateCtx,n=e.params,r=e.storeOptions,a=e.extendObjects,i=n.value;i.__COMPUTED__=="async"?Ce(t,n,a.computedObjects,r):i.__COMPUTED__=="sync"?ge(t,n,a.computedObjects,r):(0,te.$)(i)?(n.value=function(){return{fn:i,options:{depends:[],initial:void 0,immediate:!0,context:r.computedThis}}},Ce(t,n,a.computedObjects,r)):(n.value=function(){return{fn:i,options:{initial:void 0,context:r.computedThis}}},ge(t,n,a.computedObjects,r))}var Ne=p(71698),Be=p.n(Ne),He=p(77937),Ge=p.n(He),ze=p(41176),Qe=p.n(ze),Xe=p(79862),H=p.n(Xe);function Ze(e,t,n){var r=Object.assign({on:t},n),a=function(){return{fn:e,options:r}};return a.__COMPUTED__="watch",a}var qe=function(){function e(t){Ge()(this,e),H()(this,"listeners",new Map),H()(this,"_off",function(){}),H()(this,"_wacher",{off:function(){}}),H()(this,"_enable",!0),H()(this,"cache",new Map),H()(this,"listenerCache",void 0),this.options=t,this.createWacher()}return Qe()(e,[{key:"stateCtx",get:function(){return this.options.stateCtx}},{key:"storeOptions",get:function(){return this.options.storeOptions}},{key:"extendObjects",get:function(){return this.options.extendObjects}},{key:"enable",get:function(){return this._enable},set:function(n){this._enable=n}},{key:"createWacher",value:function(){var n=this,r=(0,S.watch)(function(i){var u=i.triggerReasons,c=u.map(function(s){return s.keyPath});c.forEach(function(s){if(!n.hitListenerFromCache(s)){var f=Be()(n.listeners),o;try{for(f.s();!(o=f.n()).done;){var l=J()(o.value,2),d=l[0],m=l[1];try{n.executeListener(s,JSON.parse(d),m)}catch(b){console.warn("Error while run watchLisenter("+s+"->"+d+")",b.stack)}}}catch(b){f.e(b)}finally{f.f()}}})},function(){return[n.stateCtx.state]}),a=r.unwatch;this._wacher={off:a}}},{key:"addListenerToCache",value:function(n,r,a,i){var u=this.getValueKey(n);this.cache.has(u)||this.cache.set(u,[]);var c=this.cache.get(u);c.push([r,a,i])}},{key:"getValueKey",value:function(n){return JSON.stringify(n)}},{key:"hitListenerFromCache",value:function(n){var r=this,a=this.getValueKey(n);if(this.cache.has(a)){var i=(0,v.Jy)(this.stateCtx.state,n),u=this.cache.get(a);return u.forEach(function(c){var s=J()(c,3),f=s[0],o=s[1],l=s[2],d=o(i,l);d!==void 0&&r.stateCtx.setState(function(m){(0,v.Y6)(m,f,d)})}),u.length>0}return!1}},{key:"getListenerCache",value:function(n){this.listenerCache||(this.listenerCache=new Map);var r=n.join(".");return this.listenerCache.has(r)||this.listenerCache.set(r,{}),this.listenerCache.get(r)}},{key:"executeListener",value:function(n,r,a){var i=this,u=a.fn,c=a.options,s=c.on;if(typeof s=="function"){var f=(0,v.Jy)(this.stateCtx.state,n);try{if(s(n,f)==!0){var o={getSelfValue:function(){return(0,v.Jy)((0,S.getSnap)(i.stateCtx.state),r)},getCache:function(){return i.getListenerCache(r)},srcPath:n,selfPath:r};this.addListenerToCache(n,r,u,o);var l=u(f,o);l!==void 0&&this.stateCtx.setState(function(d){(0,v.Y6)(d,r,l)})}}catch(d){this.storeOptions.log("Error while run watchLisenter(".concat(n,"->").concat(r,")")+d.stack,"error")}}}},{key:"off",value:function(){this._off()}},{key:"on",value:function(){}},{key:"add",value:function(n,r){var a=r.fullKeyPath;this.listeners.set(this.getValueKey(a),{fn:n.fn,options:n.options})}},{key:"remove",value:function(n){this.listeners.delete(this.getValueKey(n))}}]),e}(),re;function be(e){var t=e.stateCtx,n=e.params,r=e.storeOptions,a=e.extendObjects;re||(re=new qe({stateCtx:t,storeOptions:r,extendObjects:a})),r.log("install watch for <".concat(n.fullKeyPath.join(g),">"));var i=n.value();re.add(i,n),t.setState(function(u){(0,v.Y6)(u,n.fullKeyPath,i.options.initial)})}function _e(e,t,n,r){var a=e.fullKeyPath,i=e.value,u=a.join(".");if(typeof i=="function"&&!n._replacedKey[u]&&!de(i)){n._replacedKey[u]=!0;var c={stateCtx:t,extendObjects:n,storeOptions:r,params:e};i.__COMPUTED__=="watch"?be(c):Oe(c)}}var R=function(e){return e.Root="root",e.Current="current",e.Parent="parent",e.Depends="depends",e.Self="self",e}({});function et(e){return function(t,n){var r=e.useState;if(t==null)return r();var a=r(),i=J()(a,2),u=i[0],c=i[1],s=t(u),f=c;return typeof n=="function"&&(f=function(l){c(function(d){n.call(d,d,l)})}),[s,f]}}function Ae(e){return function(t,n){var r=(0,S.watch)(function(i){var u=i.triggerReasons,c=u.map(function(s){return s.keyPath});t(c)},function(){return n==null?void 0:n.map(function(i){return D(e.state,i)})}),a=r.unwatch;return a}}function tt(e){return function(t,n){(0,S.useEffect)(function(){return Ae(e)(t,n)},[])}}function nt(e,t){var n=Object.assign({id:Math.random().toString(16).substring(2),debug:!0,computedThis:R.Root,computedScope:R.Current,singleton:!0},t);n.log=function(){n.debug&&Te.apply(void 0,arguments)};var r=n.singleton?e:(0,ke.I)(e),a={computedObjects:{},watchObjects:{},_replacedKey:{}};return(0,S.model)(function(i){var u=i.sharex(r.state,{stopArrDep:!1,moduleName:n.id,onRead:function(o){_e(o,u,a,n)}}),c=ce(r.actions,u,i,n),s=et(u);return se()(se()({actions:c},u),{},{state:u.reactive,useState:s,watch:Ae(u),useWatch:tt(u)},a)})}},2109:function(oe){function $(p){var Z=new Error("Cannot find module '"+p+"'");throw Z.code="MODULE_NOT_FOUND",Z}$.keys=function(){return[]},$.resolve=$,$.id=2109,oe.exports=$}}]);
