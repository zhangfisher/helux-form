(self.webpackChunkspeedform_docs=self.webpackChunkspeedform_docs||[]).push([[641],{59664:function(ce,$,f){"use strict";f.r($),f.d($,{$:function(){return R.$},ComputedObjects:function(){return Ve},ComputedScopeRef:function(){return j},OBJECT_PATH_DELIMITER:function(){return b},WatchObjects:function(){return we},computed:function(){return rt},createAction:function(){return me},createActions:function(){return ye},createStore:function(){return ht},createUseWatch:function(){return Me},createWatch:function(){return ue},getSnap:function(){return R.getSnap},getVal:function(){return w},getValueByPath:function(){return I},installComputed:function(){return We},installWatch:function(){return De},isIncludePath:function(){return Fe},isSkipComputed:function(){return fe},markRaw:function(){return R.markRaw},setVal:function(){return k},skipComputed:function(){return _},watch:function(){return pt}});var q=f(39114),te=f.n(q),ke=f(70125),Y=f.n(ke),R=f(14102),Pe=f(79664),S=f.n(Pe),b="/";function I(t,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:b,r=[];try{return typeof n=="function"&&(n=n.call(t,t)),r=Array.isArray(n)?n:typeof n=="string"?n.split(a):[],r.length>0?w(t,r):t}catch(e){return t}}var le=Symbol("SKIP_COMPUTED");function _(t){return t[le]=!0,t}function fe(t){return t[le]===!0}function Ue(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log",a=typeof t=="function"?t():t instanceof Error?t.stack:t;try{var r;(r=console)[n].apply(r,["[@speedform/reactive] "].concat(S()(Array.isArray(a)?a:[a])))}catch(e){}}function pe(t,n){if(!Array.isArray(t))throw new Error("path must be an array");return n==="self"?t:n==="root"?[]:n==="parent"?t.slice(0,-2):n==="current"?t.slice(0,-1):typeof n=="string"?n.startsWith("./")?[].concat(S()(t.slice(0,-1)),S()(n.slice(2).split(b))):n.startsWith("../")?pe(t.slice(0,-1),n.slice(3)):(n.includes(".")&&(console.warn('[@speedform/reactive] The dependency path uses "/" as the separator, and will automatically convert'),n=n.replaceAll(".","/")),[].concat(S()(t.slice(0,-1)),S()(n.split(b)))):Array.isArray(n)?n:t}function de(t){return t.map(function(n){return Array.isArray(n)?n.join("."):n}).join("_")}function Ne(t){return t instanceof Error?t:new Error(t)}function Le(t,n){return(t||[]).map(function(a){return Array.isArray(a)?a:typeof a=="string"?a.startsWith("./")||a.startsWith("../")?a:a.includes(b)?a.split(b):a.split("."):[]})}function Ge(t,n,a){return t.map(function(r){return w(n,pe(a,r))})}function Fe(t,n){return t.length>n.length?!1:t.every(function(a,r){return a===n[r]})}function ve(t){return toString.call(t)==="[object Map]"}function he(t,n){var a=t.get(n);if(a!==void 0)return a;var r=t.get(Number(n)||n);if(r!==void 0)return r}function w(t,n){if(n.length===0)return t;var a,r=t;return n.forEach(function(e){a=ve(r)?he(r,e):r[e],r=a}),a}function k(t,n,a){var r=t,e=n.length-1;n.forEach(function(u,i){var s=ve(r);if(i===e){s?r.set(u,a):r[u]=a;return}var c=s?he(r,u):r[u];r=c})}function Be(t){return typeof t=="function"&&t.then&&typeof t.then=="function"||t&&t instanceof Promise}function ye(t,n,a,r){return Object.entries(t||{}).reduce(function(e,u){var i=Y()(u,2),s=i[0],c=i[1];return e[s]=me(c,n.setState,a),e},{})}function me(t,n,a){var r=function(u){typeof u=="function"&&n(function(i){u(i)})};return function(){var e=t.apply(void 0,arguments);if(Be(e))return e.then(function(u){r(u)});r(e)}}var He=f(77937),ge=f.n(He),Je=f(41176),Ce=f.n(Je),ze=f(65523),Oe=f.n(ze),Ye=f(7122),be=f.n(Ye),Qe=f(19108),je=f.n(Qe),Xe=f(90393),P=f.n(Xe),Ze=f(7392),ne=f.n(Ze),qe=f(26851),_e=f.n(qe),Ae=f(96820),et=f(71660),tt=f(45727);function nt(t,n,a){var r=n==null?a:n;if(typeof r=="function")try{r=r.call(t,t)}catch(e){}return r==null?a==null?j.Root:a:r}function Se(t,n){var a=n.input,r=n.type,e=n.valuePath,u=n.funcOptions,i=n.storeOptions,s=n.computedType,c=t;if(typeof i.onComputedContext=="function"){var l=i.onComputedContext.call(t,t,{computedType:s,contextType:r,valuePath:e});l!==void 0&&(c=l)}var o=e.length>=1?e.slice(0,e.length-1):[],p=nt(t,r=="context"?u.context:u.scope,r=="context"?i.computedThis&&i.computedThis(s):i.computedScope&&i.computedScope(s));try{if(p===j.Current)return I(t,o);if(p===j.Parent)return I(t,e.slice(0,e.length-2));if(p===j.Root)return c;if(p===j.Depends)return Array.isArray(a)?a.map(function(m){return typeof m=="function"?m():m}):[];if(typeof p=="string")return I(t,[].concat(S()(o),S()(p.split(b))));if(Array.isArray(p))if(p.length>0&&p[0].startsWith("@")){var d=I(t,[].concat(S()(p[0].substring(1).split(b)),S()(p.slice(1))));return I(t,d)}else return I(t,p);else if(typeof p=="number"){var y=p>e.length-2?e.length-p-1:0;return I(t,e.slice(0,y))}else return t}catch(m){return t}}function ee(t,n){var a=n.input,r=n.type,e=n.computedContext,u=n.computedOptions,i=n.storeOptions;return Se(t,{input:a,type:r,valuePath:e.fullKeyPath,funcOptions:u,storeOptions:i,computedType:"Computed"})}function rt(t,n,a){if(typeof t!="function")throw new Error("getter must be a function");var r=[],e={async:!1,enable:!0,timeout:0,depends:[],toComputedResult:j.Self,immediate:!0};if(arguments.length==1)r=[];else if(arguments.length==2)if(Array.isArray(arguments[1]))r=arguments[1];else if(_e()(arguments[1])=="object")Object.assign(e,arguments[1]);else throw new Error("invalid arguments");else arguments.length>=3&&(r=arguments[1],Object.assign(e,arguments[2]));var u=e.async===!0||(0,Ae.$)(t)||arguments.length>=2&&Array.isArray(n);e.async=u,e.depends=r;var i=function(){return{fn:t,options:e}};return i.__COMPUTED__=u?"async":"sync",i}function yt(t,n,a){var r=n==null?a:n;if(typeof r=="function")try{r=r.call(t,t)}catch(e){}return r==null?a==null?ComputedScopeRef.Root:a:r}function Te(t,n){var a="";return typeof n=="function"?a=n(t):typeof n=="string"?a=n:a=de(t),a}function xe(t,n,a,r){var e=n.fullKeyPath,u=n.parent,i=n.value,s=r.onCreateComputed,c=i(),l=c.fn,o=c.options;if(!(u&&!Object.hasOwn(u,e[e.length-1]))){if(typeof s=="function"&&typeof l=="function"){var p=s.call(t,e,l,o);o.scope||(o.scope=j.Current),o.context||(o.context=j.Root),typeof p=="function"&&(l=p)}var d=e.join(b);r.log("Create sync computed: ".concat(d));var y=Te(e,o.id),m=t.mutate({fn:function(O,D){if(!o.enable){r.log("Async computed <".concat(d,"> is disabled"),"warn");return}r.log("Run sync computed for : ".concat(d));var E=D.input,v=ee(O,{input:E,computedOptions:o,computedContext:n,storeOptions:r,type:"context"}),U=ee(O,{input:E,computedOptions:o,computedContext:n,storeOptions:r,type:"scope"}),W=o.initial;try{W=l.call(v,U)}catch(M){if(typeof o.onError=="function")try{var T;(T=o.onError)===null||T===void 0||T.call(v,M)}catch(N){}}k(O,e,W)},desc:y,checkDeadCycle:!1});n.replaceValue(w(m.snap,e)),a.set(d,{mutate:m,group:o.group,async:!1,run:function(O){return m.run(O)}})}}function Re(t,n,a){return Object.assign({value:void 0,loading:!1,timeout:0,retry:0,error:null,progress:0,run:(0,R.markRaw)(_(function(r){return t.runMutateTask({desc:n,extraArgs:r})})),cancel:(0,R.markRaw)(_(function(){console.log("cancel")}))},a)}function at(t,n,a,r,e){var u=Re(t,r,e),i=w(n,a);Object.assign(i,u,e)}function ut(t,n,a){var r=Object.assign({},a),e=r.max,u=e===void 0?100:e,i=r.min,s=i===void 0?0:i,c=r.value,l=c===void 0?0:c;return t(function(o){return k(o,[].concat(S()(n),["progress"]),l)}),{value:function(p){p>u&&(p=u),p<s&&(p=s),t(function(d){return k(d,[].concat(S()(n),["progress"]),p)})},end:function(){this.value(u)}}}function Q(t,n,a){t(function(r){Object.entries(a).forEach(function(e){var u=Y()(e,2),i=u[0],s=u[1];k(r,[].concat(S()(n),[i]),s)})})}function it(t,n,a){return re.apply(this,arguments)}function re(){return re=ne()(P()().mark(function t(n,a,r){var e,u,i,s,c,l,o,p,d,y,m,A,O,D,E,v,U,W,T,M,N,G,g;return P()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:e=r.input,u=r.computedOptions,i=r.computedContext,s=r.storeOptions,c=r.computedResultPath,l=r.setState,o=ee(n,{input:e,computedOptions:u,computedContext:i,storeOptions:s,type:"context"}),p=ee(n,{input:e,computedOptions:u,computedContext:i,storeOptions:s,type:"scope"}),d=i.fullKeyPath,y=u.timeout,m=y===void 0?0:y,A=u.retry,O=A===void 0?[0,0]:A,D=Array.isArray(O)?O:[Number(O),0],E=Y()(D,2),v=E[0],U=E[1],T=new AbortController,M={onTimeout:function(V){return W=V},getProgressbar:function(V){return ut(l,d,V)},getSnap:function(V){return(0,R.getSnap)(V,!1)},abortSignal:T.signal,cancel:T.abort},N=!1,Q(l,c,{cancel:(0,R.markRaw)(_(function(){return T.abort()}))}),T.signal.addEventListener("abort",function(){N=!0}),G=P()().mark(function F(){var V,B,K,L,Ie,h,Ke,ie,oe,Z,se,H,$e;return P()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(K=!1,L=!1,Ie=g>0,h={},C.prev=2,Ke=Array.isArray(m)?m:[m,0],ie=Y()(Ke,2),oe=ie[0],Z=oe===void 0?0:oe,se=ie[1],H=se===void 0?0:se,Q(l,c,{loading:!0,error:null,retry:g>0?v-g:0,timeout:H>1?H:Z,progress:0}),!N){C.next=7;break}throw new Error("Aborted");case 7:return Z>0&&(V=setTimeout(function(){L=!0,typeof W=="function"&&W(),K||(clearInterval(B),Q(l,c,{loading:!1,error:"TIMEOUT",timeout:0}))},Z),H>1&&(B=setInterval(function(){Q(l,c,{timeout:H--}),H===0&&clearInterval(B)},Z/H))),C.next=10,a.call(o,p,M);case 10:$e=C.sent,L||Object.assign(h,{result:$e,error:null,timeout:0}),C.next=20;break;case 14:if(C.prev=14,C.t0=C.catch(2),K=!0,typeof u.onError=="function")try{u.onError.call(o,C.t0)}catch(gt){}L||Object.assign(h,{error:Ne(C.t0).message,timeout:0}),v>0&&Object.assign(h,{retry:v-g});case 20:return C.prev=20,clearTimeout(V),clearInterval(B),(!K||g==v)&&Object.assign(h,{loading:!1}),!K&&!L&&Object.assign(h,{error:null}),Q(l,c,h),C.finish(20);case 27:if(!K){C.next=31;break}if(!(v>0&&U>0&&g<v)){C.next=31;break}return C.next=31,(0,tt.g)(U);case 31:case"end":return C.stop()}},F,null,[[2,14,20,27]])}),g=0;case 13:if(!(g<v+1)){x.next=18;break}return x.delegateYield(G(),"t0",15);case 15:g++,x.next=13;break;case 18:case"end":return x.stop()}},t)})),re.apply(this,arguments)}function Ee(t,n,a,r){var e=n.fullKeyPath,u=n.parent,i=n.value,s=r.onCreateComputed;if(!(u&&!Object.hasOwn(u,e[e.length-1]))){var c=i(),l=c.fn,o=c.options;if(o.async=!0,typeof s=="function"&&typeof l=="function"){var p=s.call(t,e,l,o);o.scope||(o.scope=j.Current),o.context||(o.context=j.Root),typeof p=="function"&&(l=p)}var d=o.depends,y=o.initial,m=o.toComputedResult,A=m===void 0?"self":m,O=o.immediate,D=o.noReentry,E=D===void 0?!1:D,v=!1,U=(0,et.d)(A,{self:e,root:[],parent:e.slice(0,e.length-2),current:e.slice(0,e.length-1),Array:A,String:[].concat(S()(e.slice(0,e.length-1)),[String(A).split(b)])},{defaultValue:e}),W=Le(d);W.length==0&&r.log("async computed <".concat(e.join("."),"> should specify depends"),"warn");var T=Te(e,o.id),M=e.join(b);r.log("Create async computed: ".concat(M," (depends=").concat(W.length==0?"None":de(W),")"));var N=t.mutate({deps:function(g){return Ge(W,g,e)},fn:function(g,X){if(X.isFirstCall)if(A=="self")k(g,e,Re(t,T,{result:y}));else{at(t,g,U,T,{result:y});var x=w(g,e.slice(0,e.length-1));delete x[e[e.length-1]]}},task:function(){var G=ne()(P()().mark(function X(x){var F,V,B,K,L;return P()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(F=x.draft,V=x.setState,B=x.input,K=x.extraArgs,o.enable){h.next=4;break}return r.log("Async computed <".concat(M,"> is disabled"),"warn"),h.abrupt("return");case 4:if(r.log("Run async computed for : ".concat(M)),L=Object.assign({},o,K),!(E&&v&&r.debug)){h.next=9;break}return r.log("Reentry async computed: ".concat(M),"warn"),h.abrupt("return");case 9:return v=!0,h.prev=10,h.next=13,it(F,l,{input:B,computedResultPath:U,computedOptions:L,computedContext:n,storeOptions:r,setState:V});case 13:return h.abrupt("return",h.sent);case 14:return h.prev=14,v=!1,h.finish(14);case 17:case"end":return h.stop()}},X,null,[[10,,14,17]])}));function g(X){return G.apply(this,arguments)}return g}(),immediate:O,desc:T,checkDeadCycle:!1});n.replaceValue(w(N.snap,e)),a.set(M,{mutate:N,group:o.group,async:!0,run:function(g){return N.runTask(g)}})}}function We(t){var n=t.stateCtx,a=t.params,r=t.storeOptions,e=t.extendObjects,u=a.value;u.__COMPUTED__=="async"?Ee(n,a,e.computedObjects,r):u.__COMPUTED__=="sync"?xe(n,a,e.computedObjects,r):(0,Ae.$)(u)?(a.value=function(){return{fn:u,options:{depends:[],initial:void 0,immediate:!0,enable:!0,context:r.computedThis&&r.computedThis("Computed")}}},Ee(n,a,e.computedObjects,r)):(a.value=function(){return{fn:u,options:{initial:void 0,enable:!0,context:r.computedThis&&r.computedThis("Computed")}}},xe(n,a,e.computedObjects,r))}var Ve=function(t){Oe()(a,t);var n=be()(a);function a(){return ge()(this,a),n.apply(this,arguments)}return Ce()(a,[{key:"runGroup",value:function(){var r=ne()(P()().mark(function u(i){return P()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",Promise.all(S()(this.values()).filter(function(l){return l.group==i}).map(function(l){return l.async?l.mutate.runTask():l.mutate.run()})));case 1:case"end":return c.stop()}},u,this)}));function e(u){return r.apply(this,arguments)}return e}()}]),a}(je()(Map)),ot=f(20458),st=f(71698),ae=f.n(st),ct=f(44114),J=f.n(ct),lt=f(79862),z=f.n(lt),ft=f(70079);function pt(t,n,a){var r=Object.assign({on:n,enable:!0,scope:j.Depends},a),e=function(){return{fn:t,options:r}};return e.__COMPUTED__="watch",e}var we=function(t){Oe()(a,t);var n=be()(a);function a(r){var e;return ge()(this,a),e=n.call(this),z()(J()(e),"_off",void 0),z()(J()(e),"_ctx",void 0),z()(J()(e),"_storeOptions",void 0),z()(J()(e),"_enable",!0),z()(J()(e),"cache",new Map),z()(J()(e),"watcherCache",void 0),e._storeOptions=r,e}return Ce()(a,[{key:"bind",value:function(e){this._ctx||(this._ctx=e,this.createWacher())}},{key:"enable",get:function(){return this._enable},set:function(e){this._enable=e}},{key:"getValueKey",value:function(e){return JSON.stringify(e)}},{key:"createWacher",value:function(){var e=this,u=(0,R.watch)(function(s){var c=s.triggerReasons;if(e._enable){var l=c.map(function(o){return o.keyPath});l.forEach(function(o){var p=e.getCachedWatchers(o),d=w(e._ctx.state,o);if(p.length===0){var y=ae()(e.values()),m;try{for(y.s();!(m=y.n()).done;){var A=m.value;e.isMatchWatcher(o,d,A)&&(e.addWatcherToCache(o,A.path,A),p.push(A))}}catch(v){y.e(v)}finally{y.f()}}var O=ae()(p),D;try{for(O.s();!(D=O.n()).done;){var E=D.value;try{E.run(o)}catch(v){console.warn("Error while run watchLisenter("+o.join(b)+"->"+E.path.join(b)+")",v.stack)}}}catch(v){O.e(v)}finally{O.f()}})}},function(){return[e._ctx.state]}),i=u.unwatch;this._off=i}},{key:"reset",value:function(){var e;this.cache.clear(),this._off&&this._off(),(e=this.watcherCache)===null||e===void 0||e.clear(),this.createWacher()}},{key:"getCachedWatchers",value:function(e){var u=this.getValueKey(e);return this.cache.has(u)?this.cache.get(u):[]}},{key:"addWatcherToCache",value:function(e,u,i){var s=this.getValueKey(e);this.cache.has(s)||this.cache.set(s,[]);var c=this.cache.get(s);c.push(i)}},{key:"getWatcherCache",value:function(e){this.watcherCache||(this.watcherCache=new Map);var u=e.join(".");return this.watcherCache.has(u)||this.watcherCache.set(u,{}),this.watcherCache.get(u)}},{key:"isMatchWatcher",value:function(e,u,i){if(!(this._enable===!1||i.enable===!1)&&typeof i.on=="function")return i.on(e,u)}},{key:"executeListener",value:function(e,u,i,s){var c=this;if(!s.enable){this._storeOptions.log("watcher <".concat(u.join(b),"> is disabled"));return}var l={getSelfValue:function(){return w((0,R.getSnap)(c._ctx.state),u)},getCache:function(){return c.getWatcherCache(u)},triggerPath:e,selfPath:u,state:this._ctx.state},o=Se(this._ctx.state,{computedType:"Watch",input:[function(){return w(c._ctx.state,e)}],type:"scope",valuePath:u,funcOptions:{scope:s.scope},storeOptions:this._storeOptions}),p=s.scope==j.Depends&&Array.isArray(o)?o[0]:o,d=i.call(this._ctx.state,p,l);d!==void 0&&this._ctx.setState(function(y){k(y,u,d)})}},{key:"add",value:function(e,u,i){var s=this,c=te()({path:e,listener:u},i);c.run=function(l){return s.executeListener(l,e,u,c)},this.set(this.getValueKey(e),c)}},{key:"remove",value:function(e){this.delete(this.getValueKey(e))}},{key:"enableGroup",value:function(e){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,i=ae()(this.values()),s;try{for(i.s();!(s=i.n()).done;){var c=s.value;c.group==e&&(c.enable=u)}}catch(l){i.e(l)}finally{i.f()}}}]),a}(je()(Map));function De(t){var n=t.stateCtx,a=t.params,r=t.storeOptions,e=t.extendObjects,u=e.watchObjects;u==null||u.bind(n),r.log("install watch for <".concat(a.fullKeyPath.join(b),">"));var i=a.value();u.add(a.fullKeyPath,i.fn,i.options),a.replaceValue(i.options.initial),n.setState(function(s){k(s,a.fullKeyPath,i.options.initial)}),(0,R.flush)(n.state)}function ue(t){return function(n,a){var r=(0,R.watch)(function(u){var i=u.triggerReasons,s=i.map(function(c){return c.keyPath});n(s)},function(){return a==null?void 0:a.map(function(u){return I(t.state,u)})}),e=r.unwatch;return e}}function Me(t){return function(n,a){(0,ft.useEffect)(function(){return ue(t)(n,a)},[])}}function dt(t,n,a,r){var e=t.fullKeyPath,u=t.value,i=e.join(".");if(typeof u=="function"&&!a._replacedKey[i]&&!fe(u)){a._replacedKey[i]=!0;var s={stateCtx:n,extendObjects:a,storeOptions:r,params:t};u.__COMPUTED__=="watch"?De(s):We(s)}}var j=function(t){return t.Root="root",t.Current="current",t.Parent="parent",t.Depends="depends",t.Self="self",t}({});function vt(t){return function(n,a){var r=t.useState;if(n==null)return r();var e=r(),u=Y()(e,2),i=u[0],s=u[1],c=n(i),l=s;return typeof a=="function"&&(l=function(p){s(function(d){a.call(d,d,p)})}),[c,l]}}function ht(t,n){var a=Object.assign({id:Math.random().toString(16).substring(2),debug:!0,computedThis:function(){return j.Root},computedScope:function(){return j.Current},singleton:!0},n);a.log=function(){a.debug&&Ue.apply(void 0,arguments)};var r=a.singleton?t:(0,ot.I)(t),e={computedObjects:new Ve,watchObjects:new we(a),_replacedKey:{}};return(0,R.model)(function(u){var i=u.sharex(r.state,{stopArrDep:!1,moduleName:a.id,onRead:function(o){dt(o,i,e,a)}}),s=ye(r.actions,i,u,a),c=vt(i);return te()(te()({actions:s},i),{},{state:i.reactive,useState:c,watch:ue(i),useWatch:Me(i)},e)})}},2109:function(ce){function $(f){var q=new Error("Cannot find module '"+f+"'");throw q.code="MODULE_NOT_FOUND",q}$.keys=function(){return[]},$.resolve=$,$.id=2109,ce.exports=$}}]);
